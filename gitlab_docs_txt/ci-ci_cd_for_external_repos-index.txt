Source Path: gitlab_docs_html/ci/ci_cd_for_external_repos/index.html

GitLab CI/CD for external repositories
Tier
: Premium, Ultimate
Offering
: GitLab.com, GitLab Self-Managed, GitLab Dedicated
GitLab CI/CD can be used with
GitHub
,
Bitbucket Cloud
,
or any other Git server. Some
known issues
exist.
Instead of moving your entire project to GitLab, you can connect your
external repository to get the benefits of GitLab CI/CD.
Connecting an external repository sets up
repository mirroring
and creates a lightweight project with issues, merge requests, wiki, and
snippets disabled. These features
can be re-enabled later
.
Connect to an external repository
To connect to an external repository:
On the left sidebar, at the top, select
Create new
(
plus
) and
New project/repository
. If you’ve
turned on the new navigation
, this button is in the upper-right corner.
Select
Run CI/CD for external repository
.
Select
GitHub
or
Repository by URL
.
Complete the fields.
If the
Run CI/CD for external repository
option is not available:
The GitLab instance might not have any import sources configured.
Ask an administrator to check the
import sources configuration
.
Project mirroring
might be disabled.
If disabled, only administrators can use the
Run CI/CD for external repository
option.
Ask an administrator to check the
project mirroring configuration
.
Pipelines for external pull requests
When using GitLab CI/CD with an
external repository on GitHub
,
it’s possible to run a pipeline in the context of a Pull Request.
When you push changes to a remote branch in GitHub, GitLab CI/CD can run a pipeline for
the branch. However, when you open or update a Pull Request for that branch you may want to:
Run extra jobs.
Not run specific jobs.
For example:
always-run
:
script
:
echo 'this should always run'
on-pull-requests
:
script
:
echo 'this should run on pull requests'
rules
:
-
if
:
$CI_PIPELINE_SOURCE == "external_pull_request_event"
except-pull-requests
:
script
:
echo 'This should not run for pull requests, but runs in other cases.'
rules
:
-
if
:
$CI_PIPELINE_SOURCE == "external_pull_request_event"
when
:
never
-
when
:
on_success
Pipeline execution for external pull requests
When a repository is imported from GitHub, GitLab subscribes to webhooks
for
push
and
pull_request
events. Once a
pull_request
event is received,
the Pull Request data is stored and kept as a reference. If the Pull Request
has just been created, GitLab immediately creates a pipeline for the external
pull request.
If changes are pushed to the branch referenced by the Pull Request and the
Pull Request is still open, a pipeline for the external pull request is
created.
GitLab CI/CD creates 2 pipelines in this case. One for the
branch push and one for the external pull request.
After the Pull Request is closed, no pipelines are created for the external pull
request, even if new changes are pushed to the same branch.
Additional predefined variables
By using pipelines for external pull requests, GitLab exposes additional
predefined variables
to the pipeline jobs.
The variable names are prefixed with
CI_EXTERNAL_PULL_REQUEST_
.
Known issues
This feature does not support:
The
manual connection method
required for GitHub Enterprise.
If the integration is connected manually, external pull requests
do not trigger pipelines
.
Pull requests from fork repositories.
Pull Requests from fork repositories are ignored
.
Given that GitLab creates 2 pipelines, if changes are pushed to a remote branch that
references an open Pull Request, both contribute to the status of the Pull Request
via GitHub integration. If you want to exclusively run pipelines on external pull
requests and not on branches you can add
except: [branches]
to the job specs.
Read more
.
Troubleshooting
Pull mirroring is not triggering pipelines
.
Fix hard failures when mirroring
.