<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Control how jobs run | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/jobs/job_control/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage=Verify data-group="Pipeline Authoring"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › Jobs"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/jobs/",title:"Jobs"},{path:"ci/jobs/job_control/",title:"Control how jobs run"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/jobs/job_control.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Control how jobs run</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Free, Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>Before a new pipeline starts, GitLab checks the pipeline configuration to determine
which jobs can run in that pipeline. You can configure jobs to run depending on
conditions like the value of variables or the pipeline type with <a href=/ci/jobs/job_rules/><code>rules</code></a>.
When using job rules, learn how to <a href=/ci/jobs/job_rules/#avoid-duplicate-pipelines>avoid duplicate pipelines</a>. To control pipeline creation, use <a href=/ci/yaml/workflow/><code>workflow:rules</code></a>.</p><h2 id=create-a-job-that-must-be-run-manually>Create a job that must be run manually</h2><p>You can require that a job doesn&rsquo;t run unless a user starts it. This is called a <strong>manual job</strong>.
You might want to use a manual job for something like deploying to production.</p><p>To specify a job as manual, add <a href=/ci/yaml/#when><code>when: manual</code></a> to the job
in the <code>.gitlab-ci.yml</code> file.</p><p>By default, manual jobs display as skipped when the pipeline starts.</p><p>You can use <a href=/user/project/repository/branches/protected/>protected branches</a> to more strictly
<a href=/ci/jobs/job_control/#protect-manual-jobs>protect manual deployments</a> from being run by unauthorized users.</p><p>Manual jobs that are <a href=/administration/settings/continuous_integration/#archive-pipelines>archived</a> do not run.</p><h3 id=types-of-manual-jobs>Types of manual jobs</h3><p>Manual jobs can be either optional or blocking.</p><p>In optional manual jobs:</p><ul><li><a href=/ci/yaml/#allow_failure><code>allow_failure</code></a> is <code>true</code>, which is the default
setting for jobs that have <code>when: manual</code> defined outside of <code>rules</code>.</li><li>The status does not contribute to the overall pipeline status. A pipeline can
succeed even if all of its manual jobs fail.</li></ul><p>In blocking manual jobs:</p><ul><li><code>allow_failure</code> is <code>false</code>, which is the default setting for jobs that have <code>when: manual</code>
defined inside <a href=/ci/yaml/#rules><code>rules</code></a>.</li><li>The pipeline stops at the stage where the job is defined. To let the pipeline
continue running, <a href=/ci/jobs/job_control/#run-a-manual-job>run the manual job</a>.</li><li>Merge requests in projects with <a href=/user/project/merge_requests/auto_merge/#require-a-successful-pipeline-for-merge><strong>Pipelines must succeed</strong></a>
enabled can&rsquo;t be merged with a blocked pipeline.</li><li>The pipeline shows a status of <strong>blocked</strong>.</li></ul><p>When using manual jobs in triggered pipelines with a <a href=/ci/yaml/#triggerstrategy><code>trigger:strategy</code></a>,
the type of manual job can affect the trigger job&rsquo;s status while the pipeline runs.</p><h3 id=run-a-manual-job>Run a manual job</h3><p>To run a manual job, you must have permission to merge to the assigned branch:</p><ol><li>Go to the pipeline, job, <a href=/ci/environments/deployments/#configure-manual-deployments>environment</a>,
or deployment view.</li><li>Next to the manual job, select <strong>Run</strong> (<span> <svg role="img" aria-label="play" class="gl-icon s16"><use href="/gitlab_ui/svgs-latest/icons.svg#play"/><title>play</title></svg> </span>).</li></ol><h3 id=specify-variables-when-running-manual-jobs>Specify variables when running manual jobs</h3><p>When running manual jobs you can supply additional job specific CI/CD variables.
Specify variables here when you want to alter the execution of a job that uses
<a href=/ci/variables/>CI/CD variables</a>.</p><p>To run a manual job and specify additional variables:</p><ul><li>Select the <strong>name</strong> of the manual job in the pipeline view, not <strong>Run</strong> (<span> <svg role="img" aria-label="play" class="gl-icon s16"><use href="/gitlab_ui/svgs-latest/icons.svg#play"/><title>play</title></svg> </span>).</li><li>In the form, add variable key and value pairs.</li><li>Select <strong>Run job</strong>.</li></ul><div class="alert alert-type-warning gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>Any project member with permissions to run a manual job can retry the job and view the variables
that were provided when the job was initially run. This includes:</p><ul><li>In public projects: Users with at least the Developer role.</li><li>In private or internal projects: Users with at least the Guest role.</li></ul><p>Consider this visibility when entering sensitive information as manual job variables.</p></div></div><p>If you add a variable that is already defined in the CI/CD settings or <code>.gitlab-ci.yml</code> file,
the <a href=/ci/variables/#use-pipeline-variables>variable is overridden</a> with the new value.
Any variables overridden by using this process are <a href=/ci/variables/#allow-cicd-variable-expansion>expanded</a>
and not <a href=/ci/variables/#mask-a-cicd-variable>masked</a>.</p><h4 id=retry-a-manual-job-with-updated-variables>Retry a manual job with updated variables</h4><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-4 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-4>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-4 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/merge_requests/96199>Introduced</a> in GitLab 15.7.</li></ul></div></div><p>When you retry a manual job that was previously run with manually-specified variables,
you can update the variables or use the same variables.</p><p>To retry a manual job with previously-specified variables:</p><ul><li>With the same variables:<ul><li>From the job details page, select <strong>Retry</strong> (<span> <svg role="img" aria-label="retry" class="gl-icon s16"><use href="/gitlab_ui/svgs-latest/icons.svg#retry"/><title>retry</title></svg> </span>).</li></ul></li><li>With updated variables:<ul><li>From the job details page, select <strong>Update CI/CD variables</strong> (<span> <svg role="img" aria-label="pencil-square" class="gl-icon s16"><use href="/gitlab_ui/svgs-latest/icons.svg#pencil-square"/><title>pencil-square</title></svg> </span>).</li><li>The variables that were specified in the previous run are prefilled in the form.
You can add, modify, or delete CI/CD variables from this form.</li><li>Select <strong>Run job again</strong>.</li></ul></li></ul><h3 id=require-confirmation-for-manual-jobs>Require confirmation for manual jobs</h3><p>Use <a href=/ci/yaml/#manual_confirmation><code>manual_confirmation</code></a> with <code>when: manual</code> to require confirmation for manual jobs.
This helps prevent accidental deployments or deletions for sensitive jobs like those that deploy to production.</p><p>When you trigger the job, you must confirm the action before it runs.</p><h3 id=protect-manual-jobs>Protect manual jobs</h3><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>Use <a href=/ci/environments/protected_environments/>protected environments</a>
to define a list of users authorized to run a manual job. You can authorize only
the users associated with a protected environment to trigger manual jobs, which can:</p><ul><li>More precisely limit who can deploy to an environment.</li><li>Block a pipeline until an approved user &ldquo;approves&rdquo; it.</li></ul><p>To protect a manual job:</p><ol><li><p>Add an <code>environment</code> to the job. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>deploy_prod</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;Deploy to production server&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>url</span><span class=p>:</span><span class=w> </span><span class=l>https://example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH</span></span></span></code></pre></div></div></li><li><p>In the <a href=/ci/environments/protected_environments/#protecting-environments>protected environments settings</a>,
select the environment (<code>production</code> in this example) and add the users, roles or groups
that are authorized to trigger the manual job to the <strong>Allowed to Deploy</strong> list. Only those in
this list can trigger this manual job, and GitLab administrators
who are always able to use protected environments.</p></li></ol><p>You can use protected environments with blocking manual jobs to have a list of users
allowed to approve later pipeline stages. Add <code>allow_failure: false</code> to the protected
manual job and the pipeline&rsquo;s next stages only run after the manual job is triggered
by authorized users.</p><h2 id=run-a-job-after-a-delay>Run a job after a delay</h2><p>Use <a href=/ci/yaml/#when><code>when: delayed</code></a> to execute scripts after a waiting period, or if you want to avoid
jobs immediately entering the <code>pending</code> state.</p><p>You can set the period with <code>start_in</code> keyword. The value of <code>start_in</code> is an elapsed time
in seconds, unless a unit is provided. The minimum is one second, and the maximum is one week.
Examples of valid values include:</p><ul><li><code>'5'</code> (a value with no unit must be surrounded by single quotes)</li><li><code>5 seconds</code></li><li><code>30 minutes</code></li><li><code>1 day</code></li><li><code>1 week</code></li></ul><p>When a stage includes a delayed job, the pipeline doesn&rsquo;t progress until the delayed job finishes.
You can use this keyword to insert delays between different stages.</p><p>The timer of a delayed job starts immediately after the previous stage completes.
Similar to other types of jobs, a delayed job&rsquo;s timer doesn&rsquo;t start unless the previous stage passes.</p><p>The following example creates a job named <code>timed rollout 10%</code> that is executed 30 minutes after the previous stage completes:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>timed rollout 10%</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#39;Rolling out 10% ...&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>delayed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>start_in</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w> </span><span class=l>minutes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><p>To stop the active timer of a delayed job, select <strong>Unschedule</strong> (<span> <svg role="img" aria-label="time-out" class="gl-icon s16"><use href="/gitlab_ui/svgs-latest/icons.svg#time-out"/><title>time-out</title></svg> </span>).
This job can no longer be scheduled to run automatically. You can, however, execute the job manually.</p><p>To start a delayed job manually, select <strong>Unschedule</strong> (<span> <svg role="img" aria-label="time-out" class="gl-icon s16"><use href="/gitlab_ui/svgs-latest/icons.svg#time-out"/><title>time-out</title></svg> </span>) to stop the delay timer and then select <strong>Run</strong> (<span> <svg role="img" aria-label="play" class="gl-icon s16"><use href="/gitlab_ui/svgs-latest/icons.svg#play"/><title>play</title></svg> </span>).
Soon GitLab Runner starts the job.</p><p>Delayed jobs that are <a href=/administration/settings/continuous_integration/#archive-pipelines>archived</a>
do not run.</p><h2 id=parallelize-large-jobs>Parallelize large jobs</h2><p>To split a large job into multiple smaller jobs that run in parallel, use the
<a href=/ci/yaml/#parallel><code>parallel</code></a> keyword in your <code>.gitlab-ci.yml</code> file.</p><p>Different languages and test suites have different methods to enable parallelization.
For example, use <a href=https://github.com/renderedtext/test-boosters>Semaphore Test Boosters</a>
and RSpec to run Ruby tests in parallel:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=ruby class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=c1># Gemfile</span>
</span></span><span class=line><span class=cl><span class=n>source</span> <span class=s1>&#39;https://rubygems.org&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gem</span> <span class=s1>&#39;rspec&#39;</span>
</span></span><span class=line><span class=cl><span class=n>gem</span> <span class=s1>&#39;semaphore_test_boosters&#39;</span></span></span></code></pre></div></div><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle exec rspec_booster --job $CI_NODE_INDEX/$CI_NODE_TOTAL</span></span></span></code></pre></div></div><p>You can then go to the <strong>Jobs</strong> tab of a new pipeline build and see your RSpec
job split into three separate jobs.</p><div class="alert alert-type-warning gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>Test Boosters reports usage statistics to the author.</p></div></div><h3 id=run-a-one-dimensional-matrix-of-parallel-jobs>Run a one-dimensional matrix of parallel jobs</h3><p>To run a job multiple times in parallel in a single pipeline, but with different values for each instance of the job,
use the <a href=/ci/yaml/#parallelmatrix><code>parallel:matrix</code></a> keyword:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>deploystacks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bin/deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>aws, ovh, gcp, vultr]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production/$PROVIDER</span></span></span></code></pre></div></div><p>In this example, 4 <code>deploystacks</code> jobs are created, and <code>PROVIDER</code> becomes a CI/CD variable
with a different value in each:</p><ul><li><code>deploystacks: [aws]</code></li><li><code>deploystacks: [ovh]</code></li><li><code>deploystacks: [gcp]</code></li><li><code>deploystacks: [vultr]</code></li></ul><h3 id=run-a-matrix-of-parallel-trigger-jobs>Run a matrix of parallel trigger jobs</h3><p>You can run a <a href=/ci/yaml/#trigger>trigger</a> job multiple times in parallel in a single pipeline,
but with different variables available for each instance of the job.</p><p>For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>deploystacks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>path/to/child-pipeline.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=l>aws</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>STACK</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>monitoring, app1]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=l>ovh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>STACK</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>monitoring, backup]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>gcp, vultr]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>STACK</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>data]</span></span></span></code></pre></div></div><p>This example generates 6 parallel <code>deploystacks</code> trigger jobs, each with different values
for <code>PROVIDER</code> and <code>STACK</code>, and they create 6 different child pipelines with those variables.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>deploystacks: [aws, monitoring]
</span></span><span class=line><span class=cl>deploystacks: [aws, app1]
</span></span><span class=line><span class=cl>deploystacks: [ovh, monitoring]
</span></span><span class=line><span class=cl>deploystacks: [ovh, backup]
</span></span><span class=line><span class=cl>deploystacks: [gcp, data]
</span></span><span class=line><span class=cl>deploystacks: [vultr, data]</span></span></code></pre></div></div><h3 id=select-different-runner-tags-for-each-parallel-matrix-job>Select different runner tags for each parallel matrix job</h3><p>You can use values defined in <code>parallel: matrix</code> with the <a href=/ci/yaml/#tags><code>tags</code></a>
keyword for dynamic runner selection:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>deploystacks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bin/deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=l>aws</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>STACK</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>monitoring, app1]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=l>gcp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>STACK</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>data]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tags</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>${PROVIDER}-${STACK}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>$PROVIDER/$STACK</span></span></span></code></pre></div></div><h3 id=fetch-artifacts-from-a-parallelmatrix-job>Fetch artifacts from a <code>parallel:matrix</code> job</h3><p>You can fetch artifacts from a job created with <a href=/ci/yaml/#parallelmatrix><code>parallel:matrix</code></a>
by using the <a href=/ci/yaml/#dependencies><code>dependencies</code></a> keyword. Use the job name
as the value for <code>dependencies</code> as a string in the form:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>&lt;job_name&gt; [&lt;matrix argument 1&gt;, &lt;matrix argument 2&gt;, ... &lt;matrix argument N&gt;]</span></span></code></pre></div></div><p>For example, to fetch the artifacts from the job with a <code>RUBY_VERSION</code> of <code>2.7</code> and
a <code>PROVIDER</code> of <code>aws</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>ruby</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ruby:${RUBY_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>RUBY_VERSION</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;2.5&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;2.6&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;2.7&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;3.0&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;3.1&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>aws, gcp]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>bundle install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ruby:2.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s2>&#34;ruby: [2.7, aws]&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo hello</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><p>Quotes around the <code>dependencies</code> entry are required.</p><h3 id=specify-a-parallelized-job-using-needs-with-multiple-parallelized-jobs>Specify a parallelized job using needs with multiple parallelized jobs</h3><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-12 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-12>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-12 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/254821>Introduced</a> in GitLab 16.3.</li></ul></div></div><p>You can use <a href=/ci/yaml/#needsparallelmatrix><code>needs:parallel:matrix</code></a> to create
dependencies between multiple parallelized jobs. You can use two techniques for configuration:</p><ul><li>Automatically with <a href=/ci/yaml/matrix_expressions/><code>matrix.</code> expressions</a>.</li><li>Manually, as demonstrated below.</li></ul><p>For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>linux:build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Building linux...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=l>aws</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>STACK</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>monitoring</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>app1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>app2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>mac:build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Building mac...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>gcp, vultr]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>STACK</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>data, processing]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>linux:rspec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>needs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>job</span><span class=p>:</span><span class=w> </span><span class=l>linux:build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=l>aws</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>STACK</span><span class=p>:</span><span class=w> </span><span class=l>app1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Running rspec on linux...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>mac:rspec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>needs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>job</span><span class=p>:</span><span class=w> </span><span class=l>mac:build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>PROVIDER</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>gcp, vultr]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>STACK</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>data]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Running rspec on mac...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>production</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Running production...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><p>This example generates several jobs. The parallel jobs each have different values
for <code>PROVIDER</code> and <code>STACK</code>.</p><ul><li>3 parallel <code>linux:build</code> jobs:<ul><li><code>linux:build: [aws, monitoring]</code></li><li><code>linux:build: [aws, app1]</code></li><li><code>linux:build: [aws, app2]</code></li></ul></li><li>4 parallel <code>mac:build</code> jobs:<ul><li><code>mac:build: [gcp, data]</code></li><li><code>mac:build: [gcp, processing]</code></li><li><code>mac:build: [vultr, data]</code></li><li><code>mac:build: [vultr, processing]</code></li></ul></li><li>A <code>linux:rspec</code> job.</li><li>A <code>production</code> job.</li></ul><p>The jobs have three paths of execution:</p><ul><li>Linux path: The <code>linux:rspec</code> job runs as soon as the <code>linux:build: [aws, app1]</code>
job finishes, without waiting for <code>mac:build</code> to finish.</li><li>macOS path: The <code>mac:rspec</code> job runs as soon as the <code>mac:build: [gcp, data]</code> and
<code>mac:build: [vultr, data]</code> jobs finish, without waiting for <code>linux:build</code> to finish.</li><li>The <code>production</code> job runs as soon as all previous jobs finish.</li></ul><h4 id=specify-needs-between-parallelized-jobs>Specify needs between parallelized jobs</h4><p>You can further define the order of each parallel matrix job using <a href=/ci/yaml/#needsparallelmatrix><code>needs:parallel:matrix</code></a>.</p><p>For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>build_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># ensure that other parallel job other than build_job [1, A] runs longer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s1>&#39;[[ &#34;$VERSION&#34; == &#34;1&#34; &amp;&amp; &#34;$MODE&#34; == &#34;A&#34; ]] || sleep 30&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo build $VERSION $MODE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>VERSION</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=m>1</span><span class=p>,</span><span class=m>2</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>MODE</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>A, B]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo deploy $VERSION $MODE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>parallel</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matrix</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>VERSION</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=m>3</span><span class=p>,</span><span class=m>4</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>MODE</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>C, D]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>&#39;deploy_job</span><span class=p>:</span><span class=w> </span><span class=nt>[3, D]&#39;</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo something</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>needs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>&#39;build_job</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=m>1</span><span class=p>,</span><span class=w> </span><span class=l>A]&#39;</span></span></span></code></pre></div></div><p>This example generates several jobs. The parallel jobs each have different values
for <code>VERSION</code> and <code>MODE</code>.</p><ul><li>4 parallel <code>build_job</code> jobs:<ul><li><code>build_job: [1, A]</code></li><li><code>build_job: [1, B]</code></li><li><code>build_job: [2, A]</code></li><li><code>build_job: [2, B]</code></li></ul></li><li>4 parallel <code>deploy_job</code> jobs:<ul><li><code>deploy_job: [3, C]</code></li><li><code>deploy_job: [3, D]</code></li><li><code>deploy_job: [4, C]</code></li><li><code>deploy_job: [4, D]</code></li></ul></li></ul><p>The <code>deploy_job: [3, D]</code> job runs as soon as <code>build_job: [1, A]</code> job finishes,
without waiting for the other <code>build_job</code> jobs to finish.</p><h2 id=troubleshooting>Troubleshooting</h2><h3 id=inconsistent-user-assignment-when-running-manual-jobs>Inconsistent user assignment when running manual jobs</h3><p>In some edge cases, the user that runs a manual job does not get assigned as the user for later jobs
that depend on the manual job.</p><p>If you need strict security over who is assigned as the user for jobs that depend on a manual job,
you should <a href=/ci/jobs/job_control/#protect-manual-jobs>protect the manual job</a>.</p></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/jobs/job_control.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/jobs/job_control.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>