<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>GitLab CI/CD job token | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/jobs/ci_job_token/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage="Software Supply Chain Security" data-group="Pipeline Security"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › Pipeline security"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/pipeline_security/",title:"Pipeline security"},{path:"ci/jobs/ci_job_token/",title:"CI/CD job token"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/jobs/ci_job_token.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>GitLab CI/CD job token</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Free, Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>When a CI/CD pipeline job is about to run, GitLab generates a unique token and makes it available
to the job as the <a href=/ci/variables/predefined_variables/><code>CI_JOB_TOKEN</code> predefined variable</a>.
The token is valid only while the job is running. After the job finishes, the token access
is revoked and you cannot use the token anymore.</p><p>Use a CI/CD job token to authenticate with certain GitLab features from running jobs.
The token receives the same access level as the user that triggered the pipeline,
but has <a href=/ci/jobs/ci_job_token/#job-token-access>access to fewer resources</a> than a personal access token. A user can cause a job to run
with an action like pushing a commit, triggering a manual job, or being the owner of a scheduled pipeline.
This user must have a <a href=/user/permissions/#cicd>role that has the required privileges</a>
to access the resources.</p><p>You can use a job token to authenticate with GitLab to access another group or project&rsquo;s resources (the target project).
By default, the job token&rsquo;s group or project must be <a href=/ci/jobs/ci_job_token/#add-a-group-or-project-to-the-job-token-allowlist>added to the target project&rsquo;s allowlist</a>.</p><p>If a project is public or internal, you can access some features without being on the allowlist.
For example, you can fetch artifacts from the project&rsquo;s public pipelines.
This access can also <a href=/ci/jobs/ci_job_token/#limit-job-token-scope-for-public-or-internal-projects>be restricted</a>.</p><h2 id=job-token-access>Job token access</h2><p>CI/CD job tokens can access the following resources:</p><table><thead><tr><th>Resource</th><th>Notes</th></tr></thead><tbody><tr><td><a href=/api/branches/>Branches API</a></td><td>Can access the <code>GET /projects/:id/repository/branches</code> endpoint.</td></tr><tr><td><a href=/api/commits/>Commits API</a></td><td>Can access the <code>GET /projects/:id/repository/commits/:sha</code> and <code>GET /projects/:id/repository/commits/:sha/merge_requests</code> endpoints.</td></tr><tr><td><a href=/user/packages/container_registry/build_and_push_images/#use-gitlab-cicd>Container registry</a></td><td>Used as the <code>$CI_REGISTRY_PASSWORD</code> <a href=/ci/variables/predefined_variables/>predefined variable</a> to authenticate with the container registry associated with the job&rsquo;s project.</td></tr><tr><td><a href=/user/packages/package_registry/#to-build-packages>Package registry</a></td><td>Used to authenticate with the registry.</td></tr><tr><td><a href=/user/packages/terraform_module_registry/>Terraform module registry</a></td><td>Used to authenticate with the registry.</td></tr><tr><td><a href=/ci/secure_files/#use-secure-files-in-cicd-jobs>Secure files</a></td><td>Used by the <a href=https://gitlab.com/gitlab-org/cli/-/tree/main/docs/source/securefile><code>glab securefile</code></a> command to use secure files in jobs.</td></tr><tr><td><a href=/api/container_registry/>Container registry API</a></td><td>Can authenticate only with the container registry associated with the job&rsquo;s project.</td></tr><tr><td><a href=/api/deployments/>Deployments API</a></td><td>Can access all endpoints in this API.</td></tr><tr><td><a href=/api/environments/>Environments API</a></td><td>Can access all endpoints in this API.</td></tr><tr><td><a href=/api/repository_files/>Files API</a></td><td>Can access the <code>GET /projects/:id/repository/files/:file_path/raw</code> endpoint.</td></tr><tr><td><a href=/api/jobs/#get-job-tokens-job>Jobs API</a></td><td>Can access only the <code>GET /job</code> endpoint.</td></tr><tr><td><a href=/api/job_artifacts/>Job artifacts API</a></td><td>Can access download endpoints only.</td></tr><tr><td><a href=/api/merge_requests/>Merge requests API</a></td><td>Can access the <code>GET /projects/:id/merge_requests</code> and <code>GET /projects/:id/merge_requests/:merge_request_iid</code> endpoints.</td></tr><tr><td><a href=/api/notes/>Notes API</a></td><td>Can access the <code>GET /projects/:id/merge_requests/:merge_request_iid/notes</code> and <code>GET /projects/:id/merge_requests/:merge_request_iid/notes/:note_id</code> endpoints.</td></tr><tr><td><a href=/api/packages/>Packages API</a></td><td>Can access all endpoints in this API.</td></tr><tr><td><a href=/api/pipeline_triggers/#trigger-a-pipeline-with-a-token>Pipeline trigger tokens API</a></td><td>Can access only the <code>POST /projects/:id/trigger/pipeline</code> endpoint.</td></tr><tr><td><a href=/api/pipelines/#update-pipeline-metadata>Pipelines API</a></td><td>Can access only the <code>PUT /projects/:id/pipelines/:pipeline_id/metadata</code> endpoint.</td></tr><tr><td><a href=/api/releases/links/>Release links API</a></td><td>Can access all endpoints in this API.</td></tr><tr><td><a href=/api/releases/>Releases API</a></td><td>Can access all endpoints in this API.</td></tr><tr><td><a href=/api/repositories/#generate-changelog-data>Repositories API</a></td><td>Can access only the <code>GET /projects/:id/repository/changelog</code> endpoint of public repositories.</td></tr><tr><td><a href=/api/tags/>Tags API</a></td><td>Can access the <code>GET /projects/:id/repository/tags</code> endpoint.</td></tr></tbody></table><p>An open <a href=https://gitlab.com/groups/gitlab-org/-/epics/3559>proposal</a> exists to make permissions
more granular.</p><h2 id=gitlab-cicd-job-token-security>GitLab CI/CD job token security</h2><p>If a job token is leaked, it could potentially be used to access private data accessible
to the user that triggered the CI/CD job. To help prevent leaking or misuse of this token,
GitLab:</p><ul><li>Masks the job token in job logs.</li><li>Grants permissions to the job token only when the job is running.</li></ul><p>You should also configure your <a href=/ci/runners/>runners</a> to be secure:</p><ul><li>Avoid using Docker <code>privileged</code> mode if the machines are re-used.</li><li>Avoid using the <a href=https://docs.gitlab.com/runner/executors/shell.html><code>shell</code> executor</a> when jobs
run on the same machine.</li></ul><p>An insecure GitLab Runner configuration increases the risk that someone can steal tokens from other
jobs.</p><h2 id=control-job-token-access-to-your-project>Control job token access to your project</h2><p>You can control which groups or projects can use a job token to authenticate and access some of your project&rsquo;s resources.</p><p>By default, job token access is restricted to only CI/CD jobs that run in pipelines in
your project. To allow another group or project to authenticate with a job token from the other
project&rsquo;s pipeline:</p><ul><li>You must <a href=/ci/jobs/ci_job_token/#add-a-group-or-project-to-the-job-token-allowlist>add the group or project to the job token allowlist</a>.</li><li>The user that triggers the job must be a member of your project.</li><li>The user must have the <a href=/user/permissions/>permissions</a> to perform the action.</li></ul><p>If your project is public or internal, some publicly accessible resources can be accessed
with a job token from any project. These resources can also be <a href=/ci/jobs/ci_job_token/#limit-job-token-scope-for-public-or-internal-projects>limited to only projects on the allowlist</a>.</p><p>GitLab Self-Managed administrators can <a href=/administration/settings/continuous_integration/#access-job-token-permission-settings>override and enforce this setting</a>.
When the setting is enforced, the CI/CD job token is always restricted to the project&rsquo;s allowlist.</p><h3 id=add-a-group-or-project-to-the-job-token-allowlist>Add a group or project to the job token allowlist</h3><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-1 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-1>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-1 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/346298/>Introduced</a> in GitLab 15.9. <a href=/administration/feature_flags/>Deployed behind the <code>:inbound_ci_scoped_job_token</code> feature flag</a>, enabled by default.</li><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/346298/>Feature flag removed</a> in GitLab 15.10.</li><li><strong>Allow access to this project with a CI_JOB_TOKEN</strong> setting <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/411406>renamed to <strong>Limit access to this project</strong></a> in GitLab 16.3.</li><li>Adding groups to the job token allowlist <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/415519>introduced</a> in GitLab 17.0.</li><li><strong>Token Access</strong> section renamed to <strong>Job token permissions</strong>, and <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/415519><strong>Limit access to this project</strong> setting renamed to <strong>Authorized groups and projects</strong></a> in GitLab 17.2.</li><li><strong>Add project</strong> option <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/470880/>renamed to <strong>Add</strong></a> in GitLab 17.6.</li></ul></div></div><p>You can add groups or projects to your job token allowlist to allow access to your project&rsquo;s resources
with a job token for authentication. By default, the allowlist of any project only includes itself.
Add groups or projects to the allowlist only when cross-project access is needed.</p><p>Adding a project to the allowlist does not give additional <a href=/user/permissions/>permissions</a>
to the members of the allowlisted project. They must already have permissions to access the resources
in your project to use a job token from the allowlisted project to access your project.</p><p>For example, project A can add project B to project A&rsquo;s allowlist. CI/CD jobs
in project B (the &ldquo;allowed project&rdquo;) can now use CI/CD job tokens to
authenticate API calls to access project A.</p><p>Prerequisites:</p><ul><li>You must have at least the Maintainer role for the current project. If the allowed project
is internal or private, you must have at least the Guest role in that project.</li><li>You must not have more than 200 groups and projects added to the allowlist.</li></ul><p>To add a group or project to the allowlist:</p><ol><li>On the left sidebar, select <strong>Search or go to</strong> and find your project. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</li><li>Select <strong>Settings</strong> > <strong>CI/CD</strong>.</li><li>Expand <strong>Job token permissions</strong>.</li><li>Select <strong>Add group or project</strong>.</li><li>Input the path to the group or project to add to the allowlist, and select <strong>Add</strong>.</li></ol><p>You can also add a group or project to the allowlist <a href=/api/graphql/reference/#mutationcijobtokenscopeaddgrouporproject>with the API</a>.</p><h3 id=auto-populate-a-projects-allowlist>Auto-populate a project&rsquo;s allowlist</h3><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-2 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-2>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-2 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/478540>Introduced</a> in GitLab 17.10.</li></ul></div></div><p>You can populate a project&rsquo;s allowlist using the data from the <a href=/ci/jobs/ci_job_token/#job-token-authentication-log>job token authentication log</a>
with the UI or a Rake task.</p><p>In either case, GitLab uses the authentication log to determine which projects or groups to add to the allowlist
and adds those entries for you.</p><p>This process creates at most 200 entries in the project&rsquo;s allowlist. If more than 200 entries exist in the authentication log,
it <a href=/ci/jobs/ci_job_token/#allowlist-compaction>compacts the allowlist</a> to stay under the 200 entry limit.</p><h4 id=with-the-ui>With the UI</h4><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-3 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-3>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-3 class="collapsible-list collapse" aria-hidden=true><ul><li>Introduced in <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/498125>GitLab 17.10</a>.</li></ul></div></div><p>To auto-populate the allowlist through the UI:</p><ol><li>On the left sidebar, select <strong>Search or go</strong> to and find your project.</li><li>Select <strong>Settings</strong> > <strong>CI/CD</strong>.</li><li>Expand <strong>Job token permissions</strong>.</li><li>Select <strong>Add</strong> and choose <strong>All projects in authentication log</strong> from the dropdown list.</li><li>A dialog asks you to confirm the action, select <strong>Add entries</strong>.</li></ol><p>After the process completes, the allowlist contains the entries from the authentication log.
If not already set, the <strong>Authorized groups and projects</strong> is set to <strong>Only this project and any groups and projects in the allowlist</strong>.</p><h4 id=with-a-rake-task>With a Rake task</h4><p>GitLab administrators with <a href=/administration/operations/rails_console/>rails console access</a>
can run a Rake task to auto-populate the allowlist for all or a subset of projects on an instance.
This task also sets the <strong>Authorized groups and projects</strong> setting to <strong>Only this project and any groups and projects in the allowlist</strong>.</p><p>The <code>ci:job_tokens:allowlist:autopopulate_and_enforce</code> Rake task has the following configuration options:</p><ul><li><code>PREVIEW</code>: Do a dry run and output the steps that would have been taken, but do not change any data.</li><li><code>ONLY_PROJECT_IDS</code>: Do the migration for only the supplied project IDs (maximum of 1000 IDs).</li><li><code>EXCLUDE_PROJECT_IDS</code>: Do the migration for all projects on the instance, except
for the supplied project IDs (maximum of 1000 IDs).</li></ul><p><code>ONLY_PROJECT_IDS</code> and <code>EXCLUDE_PROJECT_IDS</code> cannot be used at the same time.</p><p>For example:</p><ul><li><code>ci:job_tokens:allowlist:autopopulate_and_enforce PREVIEW=true</code></li><li><code>ci:job_tokens:allowlist:autopopulate_and_enforce PREVIEW=true ONLY_PROJECT_IDS=2,3</code></li><li><code>ci:job_tokens:allowlist:autopopulate_and_enforce PREVIEW=true EXCLUDE_PROJECT_IDS=2,3</code></li><li><code>ci:job_tokens:allowlist:autopopulate_and_enforce</code></li><li><code>ci:job_tokens:allowlist:autopopulate_and_enforce ONLY_PROJECT_IDS=2,3</code></li><li><code>ci:job_tokens:allowlist:autopopulate_and_enforce EXCLUDE_PROJECT_IDS=2,3</code></li></ul><p>To run the Rake task for:</p><div data-vue-app=docs-tabs><div class=tab><button class=tab-title>Linux package (Omnibus)</button><div class=tab-content><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo gitlab-rake ci:job_tokens:allowlist:autopopulate_and_enforce</span></span></code></pre></div></div></div></div><div class=tab><button class=tab-title>Self-compiled (source)</button><div class=tab-content><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo -u git -H bundle <span class=nb>exec</span> rake ci:job_tokens:allowlist:autopopulate_and_enforce</span></span></code></pre></div></div></div></div></div><h4 id=allowlist-compaction>Allowlist compaction</h4><p>The allowlist compaction algorithm:</p><ol><li>Scans the authorization log to identify the nearest common groups for projects.</li><li>Consolidates multiple project-level entries into single group-level entries.</li><li>Updates the allowlist with these consolidated entries.</li></ol><p>For example, with an allowlist similar to:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>group1/group2/group3/project1
</span></span><span class=line><span class=cl>group1/group2/group3/project2
</span></span><span class=line><span class=cl>group1/group2/group4/project3
</span></span><span class=line><span class=cl>group1/group2/group4/project4
</span></span><span class=line><span class=cl>group1/group5/group6/project5</span></span></code></pre></div></div><p>The compaction algorithm:</p><ol><li><p>Compacts the list to:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>group1/group2/group3
</span></span><span class=line><span class=cl>group1/group2/group4
</span></span><span class=line><span class=cl>group1/group5/group6</span></span></code></pre></div></div></li><li><p>If the allowlist is over the 200 entry limit, the algorithm compacts again:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>group1/group2
</span></span><span class=line><span class=cl>group1/group5</span></span></code></pre></div></div></li><li><p>If the allowlist is still over the 200 entry limit, the algorithm continues:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>group1</span></span></code></pre></div></div></li></ol><p>This process is performed until the number of allowlist entries is 200 or fewer.</p><h3 id=limit-job-token-scope-for-public-or-internal-projects>Limit job token scope for public or internal projects</h3><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-5 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-5>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-5 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/405369>Introduced</a> in GitLab 16.6.</li><li>Access to the repository <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/439158>introduced</a> in GitLab 17.0.</li></ul></div></div><p>Projects not in the allowlist can use a job token to authenticate with public or internal projects to:</p><ul><li>Fetch artifacts.</li><li>Access the container registry.</li><li>Access the package registry.</li><li>Access releases, deployments, and environments.</li><li>Access the repository.</li></ul><p>You can limit access to these actions to only the projects on the allowlist by setting
each feature to be only visible to project members.</p><p>Prerequisites:</p><ul><li>You must have the Maintainer role for the project.</li></ul><p>To set a feature to be only visible to project members:</p><ol><li>On the left sidebar, select <strong>Search or go to</strong> and find your project. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</li><li>Select <strong>Settings</strong> > <strong>General</strong>.</li><li>Expand <strong>Visibility, project features, permissions</strong>.</li><li>Set the visibility to <strong>Only project members</strong> for the features you want to restrict access to.<ul><li>The ability to fetch artifacts is controlled by the CI/CD visibility setting.</li></ul></li><li>Select <strong>Save changes</strong>.</li></ol><h3 id=allow-any-project-to-access-your-project>Allow any project to access your project</h3><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Offering</span>: GitLab Self-Managed, GitLab Dedicated</li></ul></div><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-7 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-7>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-7 class="collapsible-list collapse" aria-hidden=true><ul><li><strong>Allow access to this project with a CI_JOB_TOKEN</strong> setting <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/411406>renamed to <strong>Limit access to this project</strong></a> in GitLab 16.3.</li><li><strong>Token Access</strong> section renamed to <strong>Job token permissions</strong>, and <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/415519><strong>Limit access to this project</strong> setting renamed to <strong>Authorized groups and projects</strong></a> in GitLab 17.2.</li></ul></div></div><div class="alert alert-type-warning gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>It is a security risk to disable the token access limit and allowlist. A malicious user could try to compromise
a pipeline created in an unauthorized project. If the pipeline was created by one of
your maintainers, the job token could be used in an attempt to access your project.</p></div></div><p>If you disable the CI/CD job token allowlist, jobs from any project can access your project
with a job token. The user that triggers the pipeline must have permission to access your project.
You should only disable this setting for testing or a similar reason,
and you should enable it again as soon as possible.</p><p>This option is only available on GitLab Self-Managed or GitLab Dedicated instances with the
<a href=/administration/settings/continuous_integration/#enforce-job-token-allowlist><strong>Enable and enforce job token allowlist for all projects</strong> setting</a>
disabled.</p><p>Prerequisites:</p><ul><li>You must have at least the Maintainer role for the project.</li></ul><p>To disable the job token allowlist:</p><ol><li>On the left sidebar, select <strong>Search or go to</strong> and find your project. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</li><li>Select <strong>Settings</strong> > <strong>CI/CD</strong>.</li><li>Expand <strong>Job token permissions</strong>.</li><li>Under <strong>Authorized groups and projects</strong>, select <strong>All groups and projects</strong>.</li><li>Recommended. When finished testing, select <strong>This project and any groups and projects in the allowlist</strong> to re-enable the job token allowlist.</li></ol><p>You can also modify this setting with the <a href=/api/graphql/reference/#mutationprojectcicdsettingsupdate>GraphQL</a>
(<code>inboundJobTokenScopeEnabled</code>) or <a href=/api/project_job_token_scopes/#patch-a-projects-cicd-job-token-access-settings>REST</a> API.</p><h3 id=allow-git-push-requests-to-your-project-repository>Allow Git push requests to your project repository</h3><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-9 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-9>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-9 class="collapsible-list collapse" aria-hidden=true><ul><li><p><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/389060>Introduced</a> in GitLab 17.2. <a href=/administration/feature_flags/>with a flag</a> named <code>allow_push_repository_for_job_token</code>. Disabled by default.</p></li><li><p><strong>Token Access</strong> section renamed to <strong>Job token permissions</strong>, and <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/415519><strong>Limit access to this project</strong> setting renamed to <strong>Authorized groups and projects</strong></a> in GitLab 17.2.</p></li><li><p><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/468320>Enabled on GitLab.com</a> in GitLab 18.3</p></li><li><p><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/468320>Generally available</a> in GitLab 18.4. Feature flag <code>allow_push_repository_for_job_token</code> removed.</p></li></ul></div></div><p>You can configure your project to allow Git push requests that are authenticated with a CI/CD job
token. This setting is turned off by default.</p><p>When you turn on this setting, only job tokens generated by CI/CD jobs that run in the project
pipelines can push to the project. Job tokens from other
<a href=/ci/jobs/ci_job_token/#add-a-group-or-project-to-the-job-token-allowlist>projects or groups in the allowlist</a> cannot
push to your project.</p><p>When you use a job token to push to the project, no CI pipelines are triggered. The job token has
the same access permissions as the user who started the job.</p><p>If you use the tool semantic-release, with <strong>Allow Git push requests to the repository</strong> setting enabled, the tool gives precedence to CI_JOB_TOKEN embedded over a GitLab personal access token, if one is configured. There is an <a href=https://github.com/semantic-release/gitlab/issues/891>open issue</a> that tracks resolution for this edge case.</p><p>Prerequisites:</p><ul><li>You must have at least the Maintainer role for the project.</li></ul><p>To grant permission to job tokens generated in your project to push to the project&rsquo;s repository:</p><ol><li>On the left sidebar, select <strong>Search or go to</strong> and find your project. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</li><li>Select <strong>Settings</strong> > <strong>CI/CD</strong>.</li><li>Expand <strong>Job token permissions</strong>.</li><li>In the <strong>Permissions</strong> section, select <strong>Allow Git push requests to the repository</strong>.</li></ol><p>You can also control this setting with the <code>ci_push_repository_for_job_token_allowed</code> parameter in
the <a href=/api/projects/#edit-a-project>projects API</a>.</p><h2 id=fine-grained-permissions-for-job-tokens>Fine-grained permissions for job tokens</h2><p>You can use fine-grained permissions to explicitly allow access to a limited set of REST API endpoints. For more information, see <a href=/ci/jobs/fine_grained_permissions/>fine-grained permissions for CI/CD job tokens</a>. Feedback is welcome on this <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/519575>issue</a>.</p><h2 id=use-a-job-token>Use a job token</h2><h3 id=to-git-clone-a-private-projects-repository>To <code>git clone</code> a private project&rsquo;s repository</h3><p>You can use the job token to authenticate and clone a repository from a private project
in a CI/CD job. Use <code>gitlab-ci-token</code> as the user, and the value of the job token as the password. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git clone https://gitlab-ci-token:<span class=si>${</span><span class=nv>CI_JOB_TOKEN</span><span class=si>}</span>@gitlab.example.com/&lt;namespace&gt;/&lt;project&gt;</span></span></code></pre></div></div><p>You can use this job token to clone a repository even if the HTTPS protocol is <a href=/administration/settings/visibility_and_access_controls/#configure-enabled-git-access-protocols>disabled by group, project, or instance settings</a>.</p><h3 id=to-authenticate-a-rest-api-request>To authenticate a REST API request</h3><p>You can use a job token to authenticate requests for allowed REST API endpoints. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl --verbose --request POST --form <span class=s2>&#34;token=</span><span class=nv>$CI_JOB_TOKEN</span><span class=s2>&#34;</span> --form <span class=nv>ref</span><span class=o>=</span>master <span class=s2>&#34;https://gitlab.com/api/v4/projects/1234/trigger/pipeline&#34;</span></span></span></code></pre></div></div><p>Additionally, there are multiple valid methods for passing the job token in the request:</p><ul><li>Form: <code>--form "token=$CI_JOB_TOKEN"</code></li><li>Header: <code>--header "JOB-TOKEN: $CI_JOB_TOKEN"</code></li><li>Data: <code>--data "job_token=$CI_JOB_TOKEN"</code></li><li>Query string in the URL: <code>?job_token=$CI_JOB_TOKEN</code></li></ul><div class="alert alert-type-note gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>You cannot use a job token to authenticate requests to GraphQL endpoints.</p></div></div><h2 id=job-token-authentication-log>Job token authentication log</h2><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-11 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-11>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-11 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/467292/>Introduced</a> in GitLab 17.6.</li></ul></div></div><p>You can track which other projects use a CI/CD job token to authenticate with your project
in an authentication log. To check the log:</p><ol><li>On the left sidebar, select <strong>Search or go to</strong> and find your project. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</li><li>Select <strong>Settings</strong> > <strong>CI/CD</strong>.</li><li>Expand <strong>Job token permissions</strong>. The <strong>Authentication log</strong> section displays the
list of other projects that accessed your project by authenticating with a job token.</li><li>Optional. Select <strong>Download CSV</strong> to download the full authentication log, in CSV format.</li></ol><p>The authentication log displays a maximum of 100 authentication events. If the number of events
is more than 100, download the CSV file to view the log.</p><p>New authentications to a project can take up to 5 minutes to appear in the authentication log.</p><h2 id=use-legacy-format-for-cicd-tokens>Use legacy format for CI/CD tokens</h2><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-12 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-12>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-12 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/work_items/514860>Introduced</a> in GitLab 17.10.</li></ul></div></div><p>Beginning in GitLab 19.0, CI/CD job tokens use the JWT standard by default. Projects can continue to use the legacy format by configuring the top-level group for their project. This setting is only available until the GitLab 20.0 release.</p><p>To use the legacy format for your CI/CD tokens:</p><ol><li>On the left sidebar, select <strong>Search or go to</strong> and find your group. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</li><li>Select <strong>Settings</strong> > <strong>CI/CD</strong>.</li><li>Expand <strong>General pipelines</strong>.</li><li>Turn off <strong>Enable JWT format for CI/CD job tokens</strong>.</li></ol><p>Your CI/CD tokens now use the legacy format. If you want to use the JWT format again later, you can re-enable this setting.</p><h2 id=troubleshooting>Troubleshooting</h2><p>CI job token failures are usually shown as responses like <code>404 Not Found</code> or similar:</p><ul><li><p>Unauthorized Git clone:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>$ git clone https://gitlab-ci-token:$CI_JOB_TOKEN@gitlab.com/fabiopitino/test2.git
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Cloning into &#39;test2&#39;...
</span></span><span class=line><span class=cl>remote: The project you were looking for could not be found or you don&#39;t have permission to view it.
</span></span><span class=line><span class=cl>fatal: repository &#39;https://gitlab-ci-token:[MASKED]@gitlab.com/&lt;namespace&gt;/&lt;project&gt;.git/&#39; not found</span></span></code></pre></div></div></li><li><p>Unauthorized package download:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>$ wget --header=&#34;JOB-TOKEN: $CI_JOB_TOKEN&#34; ${CI_API_V4_URL}/projects/1234/packages/generic/my_package/0.0.1/file.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--2021-09-23 11:00:13--  https://gitlab.com/api/v4/projects/1234/packages/generic/my_package/0.0.1/file.txt
</span></span><span class=line><span class=cl>Resolving gitlab.com (gitlab.com)... 172.65.251.78, 2606:4700:90:0:f22e:fbec:5bed:a9b9
</span></span><span class=line><span class=cl>Connecting to gitlab.com (gitlab.com)|172.65.251.78|:443... connected.
</span></span><span class=line><span class=cl>HTTP request sent, awaiting response... 404 Not Found
</span></span><span class=line><span class=cl>2021-09-23 11:00:13 ERROR 404: Not Found.</span></span></code></pre></div></div></li><li><p>Unauthorized API request:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>$ curl --verbose --request POST --form &#34;token=$CI_JOB_TOKEN&#34; --form ref=master &#34;https://gitlab.com/api/v4/projects/1234/trigger/pipeline&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt; HTTP/2 404
</span></span><span class=line><span class=cl>&lt; date: Thu, 23 Sep 2021 11:00:12 GMT
</span></span><span class=line><span class=cl>{&#34;message&#34;:&#34;404 Not Found&#34;}
</span></span><span class=line><span class=cl>&lt; content-type: application/json</span></span></code></pre></div></div></li></ul><p>While troubleshooting CI/CD job token authentication issues, be aware that:</p><ul><li>A <a href=/api/graphql/getting_started/#update-project-settings>GraphQL example mutation</a>
is available to toggle the scope settings per project.</li><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/351740#note_1335673157>This comment</a>
demonstrates how to use GraphQL with Bash and cURL to:<ul><li>Enable the inbound token access scope.</li><li>Give access to project B from project A, or add B to A&rsquo;s allowlist.</li><li>To remove project access.</li></ul></li><li>The CI job token becomes invalid if the job is no longer running, has been erased,
or if the project is in the process of being deleted.</li></ul><h3 id=jwt-format-job-token-errors>JWT format job token errors</h3><p>There are some known issues with the JWT format for CI/CD job tokens.</p><h4 id=error-when-persisting-the-task-arn-error-with-ec2-fargate-runner-custom-executor><code>Error when persisting the task ARN.</code> error with EC2 Fargate Runner custom executor</h4><p>There is <a href=https://gitlab.com/gitlab-org/ci-cd/custom-executor-drivers/fargate/-/issues/86>a bug</a>
in version <code>0.5.0</code> and earlier of the EC2 Fargate custom executor. This issue causes this error:</p><ul><li><code>Error when persisting the task ARN. Will stop the task for cleanup</code></li></ul><p>To fix this issue, upgrade to version <code>0.5.1</code> or later of the Fargate custom executor.</p><h4 id=invalid-character-n-in-string-literal-error-with-base64-encoding><code>invalid character '\n' in string literal</code> error with <code>base64</code> encoding</h4><p>If you use <code>base64</code> to encode job tokens, you could receive an <code>invalid character '\n'</code> error.</p><p>The default behavior of the <code>base64</code> command wraps strings that are longer than 79 characters.
When <code>base64</code> encoding JWT format job tokens during job execution, for example with
<code>echo $CI_JOB_TOKEN | base64</code>, the token is rendered invalid.</p><p>To fix this issue, use <code>base64 -w0</code> to disable automatically wrapping the token.</p></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/jobs/ci_job_token.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/jobs/ci_job_token.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>