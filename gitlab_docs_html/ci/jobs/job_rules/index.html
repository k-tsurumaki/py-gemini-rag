<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Specify when jobs run with `rules` | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/jobs/job_rules/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage=Verify data-group="Pipeline Authoring"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › Jobs › Control how jobs run"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/jobs/",title:"Jobs"},{path:"ci/jobs/job_control/",title:"Control how jobs run"},{path:"ci/jobs/job_rules/",title:"Specify when jobs run with rules"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/jobs/job_rules.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Specify when jobs run with <code>rules</code></h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Free, Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>Use the <a href=/ci/yaml/#rules><code>rules</code></a> keyword to include or exclude jobs in pipelines.</p><p>Rules are evaluated in order until the first match. When a match is found, the job
is either included or excluded from the pipeline, depending on the configuration.</p><p>You cannot use dotenv variables created in job scripts in rules, because rules are evaluated before any jobs run.</p><h2 id=rules-examples><code>rules</code> examples</h2><p>The following example uses <code>if</code> to define that the job runs in only two specific cases:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Hello, Rules!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;merge_request_event&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>allow_failure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;schedule&#34;</span></span></span></code></pre></div></div><ul><li>If the pipeline is for a merge request, the first rule matches, and the job
is added to the merge request pipeline with attributes of:<ul><li><code>when: manual</code> (manual job)</li><li><code>allow_failure: true</code> (the pipeline continues running even if the manual job is not run)</li></ul></li><li>If the pipeline is not for a merge request, the first rule doesn&rsquo;t match, and the
second rule is evaluated.</li><li>If the pipeline is a scheduled pipeline, the second rule matches, and the job
is added to the scheduled pipeline. No attributes were defined, so it is added
with:<ul><li><code>when: on_success</code> (default)</li><li><code>allow_failure: false</code> (default)</li></ul></li><li>In all other cases, no rules match, so the job is not added to any other pipeline.</li></ul><p>Alternatively, you can define a set of rules to exclude jobs in a few cases, but
run them in all other cases:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Hello, Rules!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;merge_request_event&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;schedule&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>on_success</span></span></span></code></pre></div></div><ul><li>If the pipeline is for a merge request, the job is not added to the pipeline.</li><li>If the pipeline is a scheduled pipeline, the job is not added to the pipeline.</li><li>In all other cases, the job is added to the pipeline, with <code>when: on_success</code>.</li></ul><div class="alert alert-type-warning gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>If you use a <code>when</code> clause as the final rule (not including <code>when: never</code>), two
simultaneous pipelines may start. Both push pipelines and merge request pipelines can
be triggered by the same event (a push to the source branch for an open merge request).
See how to <a href=/ci/jobs/job_rules/#avoid-duplicate-pipelines>avoid duplicate pipelines</a> for more details.</p></div></div><h3 id=run-jobs-for-scheduled-pipelines>Run jobs for scheduled pipelines</h3><p>You can configure a job to be executed only when the pipeline has been
scheduled. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job:on-schedule</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;schedule&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>make world</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;push&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>make build</span></span></span></code></pre></div></div><p>In this example, <code>make world</code> runs in scheduled pipelines, and <code>make build</code>
runs in branch and tag pipelines.</p><h3 id=skip-jobs-if-the-branch-is-empty>Skip jobs if the branch is empty</h3><p>Use <a href=/ci/yaml/#ruleschangescompare_to><code>rules:changes:compare_to</code></a> to
skip a job when the branch is empty, which saves CI/CD resources. The configuration compares the
branch to the default branch, and if the branch:</p><ul><li>Doesn&rsquo;t have changed files, the job doesn&rsquo;t run.</li><li>Has changed files, the job runs.</li></ul><p>For example, in a project with <code>main</code> as the default branch:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;This job only runs for branches that are not empty&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>changes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>compare_to</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;refs/heads/main&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s1>&#39;**/*&#39;</span></span></span></code></pre></div></div><p>The rule for this job compares all files and paths in the current branch
recursively (<code>**/*</code>) against the <code>main</code> branch. The rule matches and the
job runs only when there are changes to the files in the branch.</p><h2 id=common-if-clauses-with-predefined-variables>Common <code>if</code> clauses with predefined variables</h2><p><code>rules:if</code> clauses are commonly used with <a href=/ci/variables/predefined_variables/>predefined CI/CD variables</a>,
especially <code>CI_PIPELINE_SOURCE</code>.</p><p>The following example runs the job as a manual job in scheduled pipelines or in push
pipelines (to branches or tags), with <code>when: on_success</code> (default). It does not
add the job to any other pipeline type.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Hello, Rules!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;schedule&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>allow_failure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;push&#34;</span></span></span></code></pre></div></div><p>The following example runs the job as a <code>when: on_success</code> job in merge request pipelines
and scheduled pipelines. It does not run in any other pipeline type.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Hello, Rules!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;merge_request_event&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;schedule&#34;</span></span></span></code></pre></div></div><p>Other commonly used <code>if</code> clauses:</p><ul><li><code>if: $CI_COMMIT_TAG</code>: If changes are pushed for a tag.</li><li><code>if: $CI_COMMIT_BRANCH</code>: If changes are pushed to any branch.</li><li><code>if: $CI_COMMIT_BRANCH == "main"</code>: If changes are pushed to <code>main</code>.</li><li><code>if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH</code>: If changes are pushed to the default branch.</li><li><code>if: $CI_COMMIT_BRANCH =~ /regex-expression/</code>: If the commit branch matches a regular expression.</li><li><code>if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH && $CI_COMMIT_TITLE =~ /Merge branch.*/</code>:
If the commit branch is the default branch and the commit message title matches a regular expression.</li><li><code>if: $CUSTOM_VARIABLE == "value1"</code>: If the custom variable <code>CUSTOM_VARIABLE</code> is exactly <code>value1</code>.</li></ul><h3 id=run-jobs-only-in-specific-pipeline-types>Run jobs only in specific pipeline types</h3><p>You can use predefined CI/CD variables with <code>rules</code> to choose which pipeline types jobs should run for.</p><p>The following table lists some of the variables that you can use, and the pipeline
types the variables can control for:</p><ul><li>Branch pipelines that run for Git <code>push</code> events to a branch, like new commits or tags.</li><li>Tag pipelines that run only when a new Git tag is pushed to a branch.</li><li>Merge request pipelines that run for changes to a merge request, like new commits or
selecting <strong>Run pipeline</strong> in a merge request&rsquo;s pipelines tab.</li><li>Scheduled pipelines.</li></ul><table><thead><tr><th>Variables</th><th>Branch</th><th>Tag</th><th>Merge request</th><th>Scheduled</th></tr></thead><tbody><tr><td><code>CI_COMMIT_BRANCH</code></td><td>Yes</td><td></td><td></td><td>Yes</td></tr><tr><td><code>CI_COMMIT_TAG</code></td><td></td><td>Yes</td><td></td><td>Yes, if the scheduled pipeline is configured to run on a tag.</td></tr><tr><td><code>CI_PIPELINE_SOURCE = push</code></td><td>Yes</td><td>Yes</td><td></td><td></td></tr><tr><td><code>CI_PIPELINE_SOURCE = schedule</code></td><td></td><td></td><td></td><td>Yes</td></tr><tr><td><code>CI_PIPELINE_SOURCE = merge_request_event</code></td><td></td><td></td><td>Yes</td><td></td></tr><tr><td><code>CI_MERGE_REQUEST_IID</code></td><td></td><td></td><td>Yes</td><td></td></tr></tbody></table><p>For example, to configure a job to run for merge request pipelines and scheduled pipelines,
but not branch or tag pipelines:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;merge_request_event&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;schedule&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;push&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>never</span></span></span></code></pre></div></div><h3 id=ci_pipeline_source-predefined-variable><code>CI_PIPELINE_SOURCE</code> predefined variable</h3><p>Use the <code>CI_PIPELINE_SOURCE</code> variable to control when to add jobs for these pipeline types:</p><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>api</code></td><td>For pipelines triggered by the <a href=/api/pipelines/#create-a-new-pipeline>pipelines API</a>.</td></tr><tr><td><code>chat</code></td><td>For pipelines created by using a <a href=/ci/chatops/>GitLab ChatOps</a> command.</td></tr><tr><td><code>external</code></td><td>When you use CI services other than GitLab.</td></tr><tr><td><code>external_pull_request_event</code></td><td>When an <a href=/ci/ci_cd_for_external_repos/#pipelines-for-external-pull-requests>external pull request on GitHub</a> is created or updated.</td></tr><tr><td><code>merge_request_event</code></td><td>For pipelines created when a merge request is created or updated. Required to enable <a href=/ci/pipelines/merge_request_pipelines/>merge request pipelines</a>, <a href=/ci/pipelines/merged_results_pipelines/>merged results pipelines</a>, and <a href=/ci/pipelines/merge_trains/>merge trains</a>.</td></tr><tr><td><code>ondemand_dast_scan</code></td><td>For <a href=/user/application_security/dast/on-demand_scan/>DAST on-demand scan</a> pipelines.</td></tr><tr><td><code>ondemand_dast_validation</code></td><td>For <a href=/user/application_security/dast/profiles/#site-profile-validation>DAST on-demand validation</a> pipelines</td></tr><tr><td><code>parent_pipeline</code></td><td>For pipelines triggered by a <a href=/ci/pipelines/downstream_pipelines/#parent-child-pipelines>parent/child pipeline</a>. Use this pipeline source in the child pipeline configuration so that it can be triggered by the parent pipeline.</td></tr><tr><td><code>pipeline</code></td><td>For <a href=/ci/pipelines/downstream_pipelines/#multi-project-pipelines>multi-project pipelines</a>.</td></tr><tr><td><code>push</code></td><td>For pipelines triggered by a Git push event, including for branches and tags.</td></tr><tr><td><code>schedule</code></td><td>For <a href=/ci/pipelines/schedules/>scheduled pipelines</a>.</td></tr><tr><td><code>security_orchestration_policy</code></td><td>For <a href=/user/application_security/policies/scan_execution_policies/>scheduled scan execution policies</a> pipelines.</td></tr><tr><td><code>trigger</code></td><td>For pipelines created by using a <a href=/ci/triggers/#configure-cicd-jobs-to-run-in-triggered-pipelines>trigger token</a>.</td></tr><tr><td><code>web</code></td><td>For pipelines created by selecting <strong>New pipeline</strong> in the GitLab UI, from the project&rsquo;s <strong>Build</strong> > <strong>Pipelines</strong> section.</td></tr><tr><td><code>webide</code></td><td>For pipelines created by using the <a href=/user/project/web_ide/>Web IDE</a>.</td></tr></tbody></table><p>These values are the same as returned for the <code>source</code> parameter when using the
<a href=/api/pipelines/#list-project-pipelines>pipelines API endpoint</a>.</p><h2 id=complex-rules>Complex rules</h2><p>You can use all <code>rules</code> keywords, like <code>if</code>, <code>changes</code>, and <code>exists</code>, in the same
rule. The rule evaluates to true only when all included keywords evaluate to true.</p><p>For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>docker build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>docker build -t my-image:$CI_COMMIT_REF_SLUG .</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$VAR == &#34;string value&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>changes</span><span class=p>:</span><span class=w>  </span><span class=c># Include the job and set to when:manual if any of the follow paths match a modified file.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>Dockerfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>docker/scripts/**/*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>allow_failure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div></div><p>If the <code>Dockerfile</code> file or any file in <code>/docker/scripts</code> has changed and <code>$VAR == "string value"</code>,
then the job runs manually and is allowed to fail.</p><p>You can use parentheses with <code>&&</code> and <code>||</code> to build more complicated variable expressions.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo This rule uses parentheses.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>($CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH || $CI_COMMIT_BRANCH == &#34;develop&#34;) &amp;&amp; $MY_VARIABLE</span></span></span></code></pre></div></div><h2 id=avoid-duplicate-pipelines>Avoid duplicate pipelines</h2><p>If a job uses <code>rules</code>, a single action, like pushing a commit to a branch, can trigger
multiple pipelines. You don&rsquo;t have to explicitly configure rules for multiple types
of pipeline to trigger them accidentally.</p><p>For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job creates double pipelines!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CUSTOM_VARIABLE == &#34;false&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>always</span></span></span></code></pre></div></div><p>This job does not run when <code>$CUSTOM_VARIABLE</code> is false, but it does run in all
other pipelines, including <strong>both</strong> push (branch) and merge request pipelines. With
this configuration, every push to an open merge request&rsquo;s source branch
causes duplicated pipelines.</p><p>To avoid duplicate pipelines, you can:</p><ul><li><p>Use <a href=/ci/yaml/#workflow><code>workflow</code></a> to specify which types of pipelines
can run.</p></li><li><p>Rewrite the rules to run the job only in very specific cases,
and avoid a final <code>when</code> rule:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job does NOT create double pipelines!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CUSTOM_VARIABLE == &#34;true&#34; &amp;&amp; $CI_PIPELINE_SOURCE == &#34;merge_request_event&#34;</span></span></span></code></pre></div></div></li></ul><p>You can also avoid duplicate pipelines by changing the job rules to avoid either push (branch)
pipelines or merge request pipelines. However, if you use a <code>- when: always</code> rule without
<code>workflow: rules</code>, GitLab displays a <a href=/ci/debugging/#pipeline-warnings>pipeline warning</a>.</p><p>For example, the following does not trigger double pipelines, but is not recommended
without <code>workflow: rules</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job does NOT create double pipelines!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;push&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>always</span></span></span></code></pre></div></div><p>You should not include both push and merge request pipelines in the same job without
<a href=/ci/yaml/workflow/#switch-between-branch-pipelines-and-merge-request-pipelines><code>workflow:rules</code> that prevent duplicate pipelines</a>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job creates double pipelines!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;push&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;merge_request_event&#34;</span></span></span></code></pre></div></div><p>Also, do not mix <code>only/except</code> jobs with <code>rules</code> jobs in the same pipeline.
It may not cause YAML errors, but the different default behaviors of <code>only/except</code>
and <code>rules</code> can cause issues that are difficult to troubleshoot:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job-with-no-rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job runs in branch pipelines.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job-with-rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job runs in merge request pipelines.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;merge_request_event&#34;</span></span></span></code></pre></div></div><p>For every change pushed to the branch with an open merge request, duplicate pipelines run.
One branch pipeline runs a single job (<code>job-with-no-rules</code>), and one merge request pipeline
runs the other job (<code>job-with-rules</code>). Jobs with no rules default
to <a href=/ci/yaml/deprecated_keywords/#only--except><code>except: merge_requests</code></a>, so <code>job-with-no-rules</code>
runs in all cases except merge requests.</p><h2 id=reuse-rules-in-different-jobs>Reuse rules in different jobs</h2><p>Use <a href=/ci/yaml/yaml_optimization/#reference-tags><code>!reference</code> tags</a> to reuse rules in different
jobs. You can combine <code>!reference</code> rules with regular job-defined rules. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>.default_rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;schedule&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- !<span class=l>reference [.default_rules, rules]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;This job runs for the default branch, but not schedules.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- !<span class=l>reference [.default_rules, rules]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#34;merge_request_event&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;This job runs for the default branch, but not schedules.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;It also runs for merge requests.&#34;</span></span></span></code></pre></div></div><h2 id=cicd-variable-expressions>CI/CD variable expressions</h2><p>Use variable expressions with <a href=/ci/yaml/#rulesif><code>rules:if</code></a> to control
when jobs should be added to a pipeline.</p><p>You can use the equality operators <code>==</code> and <code>!=</code> to compare a variable with a
string. Both single quotes and double quotes are valid. The variable has to be on the left side of the comparison. For example:</p><ul><li><code>if: $VARIABLE == "some value"</code></li><li><code>if: $VARIABLE != "some value"</code></li></ul><p>You can compare the values of two variables. For example:</p><ul><li><code>if: $VARIABLE_1 == $VARIABLE_2</code></li><li><code>if: $VARIABLE_1 != $VARIABLE_2</code></li></ul><p>You can compare a variable to the <code>null</code> keyword to see if it is defined. For example:</p><ul><li><code>if: $VARIABLE == null</code></li><li><code>if: $VARIABLE != null</code></li></ul><p>You can check if a variable is defined but empty. For example:</p><ul><li><code>if: $VARIABLE == ""</code></li><li><code>if: $VARIABLE != ""</code></li></ul><p>You can check if a variable is both defined and not empty by using just the variable name in
the expression. For example:</p><ul><li><code>if: $VARIABLE</code></li></ul><p>You can also <a href=/ci/inputs/examples/#use-cicd-inputs-in-variable-expressions>use CI/CD inputs in variable expressions</a>.</p><h3 id=compare-a-variable-to-a-regular-expression>Compare a variable to a regular expression</h3><p>You can do regular expression matching on variable values with the <code>=~</code> and <code>!~</code> operators.</p><p>Expressions evaluate as <code>true</code> if:</p><ul><li>Matches are found when using <code>=~</code>.</li><li>Matches are not found when using <code>!~</code>.</li></ul><p>For example:</p><ul><li><code>if: $VARIABLE =~ /^content.*/</code></li><li><code>if: $VARIABLE !~ /^content.*/</code></li></ul><p>Additionally:</p><ul><li>Single-character regular expressions, like <code>/./</code>, are not supported and
produce an <code>invalid expression syntax</code> error.</li><li>Pattern matching is case-sensitive by default. Use the <code>i</code> flag modifier to make a
pattern case-insensitive. For example: <code>/pattern/i</code>.</li><li>Only the tag or branch name can be matched by a regular expression.
The repository path, if given, is always matched literally.</li><li>The entire pattern must be surrounded by <code>/</code>. For example, you can&rsquo;t use <code>issue-/.*/</code>
to match all tag names or branch names that begin with <code>issue-</code>, but you can use <code>/issue-.*/</code>.</li><li>The <code>@</code> symbol denotes the beginning of a ref&rsquo;s repository path.
To match a ref name that contains the <code>@</code> character in a regular expression,
you must use the hex character code match <code>\x40</code>.</li><li>Use anchors <code>^</code> and <code>$</code> to avoid the regular expression matching only a substring
of the tag name or branch name. For example, <code>/^issue-.*$/</code> is equivalent to <code>/^issue-/</code>,
while just <code>/issue/</code> would also match a branch called <code>severe-issues</code>.</li><li>Variable pattern matching with regular expressions uses the
<a href=https://github.com/google/re2/wiki/Syntax>RE2 regular expression syntax</a>.</li></ul><h3 id=store-a-regular-expression-in-a-variable>Store a regular expression in a variable</h3><p>Variables on the right side of <code>=~</code> and <code>!~</code> expressions are evaluated as regular expressions.
The regular expression must be enclosed in forward slashes (<code>/</code>). For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;/^ab.*/&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>regex-job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>teststring</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;abcde&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job will run, because &#39;abcde&#39; matches the /^ab.*/ pattern.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;$teststring =~ $pattern&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>regex-job2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>teststring</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;fghij&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job will not run, because &#39;fghi&#39; does not match the /^ab.*/ pattern.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;$teststring =~ $pattern&#39;</span></span></span></code></pre></div></div><p>Variables in a regular expression are not expanded. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>string1</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;regex-job1&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>string2</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;regex-job2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pattern</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;/$string2/&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>regex-job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job will NOT run, because the &#39;string1&#39; variable inside the regex pattern is not expanded.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;$CI_JOB_NAME =~ /$string1/&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>regex-job2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;This job will NOT run, because the &#39;string2&#39; variable inside the &#39;pattern&#39; variable is not expanded.&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;$CI_JOB_NAME =~ $pattern&#39;</span></span></span></code></pre></div></div><h3 id=join-variable-expressions-together>Join variable expressions together</h3><p>You can join multiple expressions using <code>&&</code> (and) or <code>||</code> (or), for example:</p><ul><li><code>$VARIABLE1 =~ /^content.*/ && $VARIABLE2 == "something"</code></li><li><code>$VARIABLE1 =~ /^content.*/ && $VARIABLE2 =~ /thing$/ && $VARIABLE3</code></li><li><code>$VARIABLE1 =~ /^content.*/ || $VARIABLE2 =~ /thing$/ && $VARIABLE3</code></li></ul><p>You can use parentheses to group expressions together. Parentheses take precedence over
<code>&&</code> and <code>||</code>, so expressions enclosed in parentheses evaluate first, and the
result is used for the rest of the expression. For the precedence of operators,
<code>&&</code> evaluates before <code>||</code>.</p><p>Nest parentheses to create complex conditions, and the inner-most expressions
in parentheses evaluate first. For example:</p><ul><li><code>($VARIABLE1 =~ /^content.*/ || $VARIABLE2) && ($VARIABLE3 =~ /thing$/ || $VARIABLE4)</code></li><li><code>($VARIABLE1 =~ /^content.*/ || $VARIABLE2 =~ /thing$/) && $VARIABLE3</code></li><li><code>$CI_COMMIT_BRANCH == "my-branch" || (($VARIABLE1 == "thing" || $VARIABLE2 == "thing") && $VARIABLE3)</code></li></ul><h2 id=troubleshooting>Troubleshooting</h2><h3 id=unexpected-behavior-from-regular-expression-matching-with->Unexpected behavior from regular expression matching with <code>=~</code></h3><p>When using the <code>=~</code> character, make sure the right side of the comparison always contains
a valid regular expression.</p><p>If the right side of the comparison is not a valid regular expression enclosed with <code>/</code> characters,
the expression evaluates in an unexpected way. In that case, the comparison checks
if the left side is a substring of the right side. For example, <code>"23" =~ "1234"</code> evaluates to true,
which is the opposite of <code>"23" =~ /1234/</code>, which evaluates to false.</p><p>You should not configure your pipeline to rely on this behavior.</p></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/jobs/job_rules.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/jobs/job_rules.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>