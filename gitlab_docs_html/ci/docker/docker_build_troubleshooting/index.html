<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Troubleshooting Docker Build | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/docker/docker_build_troubleshooting/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage=Verify data-group="Pipeline Execution"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › Jobs › Docker › Use Docker to build Docker images"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/jobs/",title:"Jobs"},{path:"ci/docker/",title:"Docker"},{path:"ci/docker/using_docker_build/",title:"Use Docker to build Docker images"},{path:"ci/docker/docker_build_troubleshooting/",title:"Troubleshooting"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/docker/docker_build_troubleshooting.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Troubleshooting Docker Build</h1></div><div data-elastic-include><h2 id=error-docker-cannot-connect-to-the-docker-daemon-at-tcpdocker2375>Error: <code>docker: Cannot connect to the Docker daemon at tcp://docker:2375</code></h2><p>This error is common when you are using <a href=/ci/docker/using_docker_build/#use-docker-in-docker>Docker-in-Docker</a>
v19.03 or later:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>docker: Cannot connect to the Docker daemon at tcp://docker:2375. Is the docker daemon running?</span></span></code></pre></div></div><p>This error occurs because Docker starts on TLS automatically.</p><ul><li>If this is your first time setting it up, see
<a href=/ci/docker/using_docker_build/#use-docker-in-docker>use the Docker executor with the Docker image</a>.</li><li>If you are upgrading from v18.09 or earlier, see the
<a href=https://about.gitlab.com/blog/2019/07/31/docker-in-docker-with-docker-19-dot-03/>upgrade guide</a>.</li></ul><p>This error can also occur with the <a href=https://docs.gitlab.com/runner/executors/kubernetes/#using-dockerdind>Kubernetes executor</a> when attempts are made to access the Docker-in-Docker service before it has fully started up. For a more detailed explanation, see <a href=https://gitlab.com/gitlab-org/gitlab-runner/-/issues/27215>issue 27215</a>.</p><h2 id=docker-no-such-host-error>Docker <code>no such host</code> error</h2><p>You might get an error that says
<code>docker: error during connect: Post https://docker:2376/v1.40/containers/create: dial tcp: lookup docker on x.x.x.x:53: no such host</code>.</p><p>This issue can occur when the service&rsquo;s image name
<a href=/ci/services/#available-settings-for-services>includes a registry hostname</a>. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker:24.0.5-cli</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>registry.hub.docker.com/library/docker:24.0.5-dind</span></span></span></code></pre></div></div><p>A service&rsquo;s hostname is <a href=/ci/services/#accessing-the-services>derived from the full image name</a>.
However, the shorter service hostname <code>docker</code> is expected.
To allow service resolution and access, add an explicit alias for the service name <code>docker</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker:24.0.5-cli</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>registry.hub.docker.com/library/docker:24.0.5-dind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>docker</span></span></span></code></pre></div></div><h2 id=error-cannot-connect-to-the-docker-daemon-at-unixvarrundockersock>Error: <code>Cannot connect to the Docker daemon at unix:///var/run/docker.sock</code></h2><p>You might get the following error when trying to run a <code>docker</code> command
to access a <code>dind</code> service:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ docker ps
</span></span><span class=line><span class=cl>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span></span></code></pre></div></div><p>Make sure your job has defined these environment variables:</p><ul><li><code>DOCKER_HOST</code></li><li><code>DOCKER_TLS_CERTDIR</code> (optional)</li><li><code>DOCKER_TLS_VERIFY</code> (optional)</li></ul><p>You may also want to update the image that provides the Docker
client. For example, the <a href=https://hub.docker.com/r/docker/compose><code>docker/compose</code> images are obsolete</a> and should be
replaced with <a href=https://hub.docker.com/_/docker><code>docker</code></a>.</p><p>As described in <a href=https://gitlab.com/gitlab-org/gitlab-runner/-/issues/30944#note_1514250909>runner issue 30944</a>,
this error can happen if your job previously relied on environment variables derived from the deprecated
<a href=https://docs.docker.com/network/links/#environment-variables>Docker <code>--link</code> parameter</a>,
such as <code>DOCKER_PORT_2375_TCP</code>. Your job fails with this error if:</p><ul><li>Your CI/CD image relies on a legacy variable, such as <code>DOCKER_PORT_2375_TCP</code>.</li><li>The <a href=https://docs.gitlab.com/runner/configuration/feature-flags.html>runner feature flag <code>FF_NETWORK_PER_BUILD</code></a> is set to <code>true</code>.</li><li><code>DOCKER_HOST</code> is not explicitly set.</li></ul><h2 id=error-unauthorized-incorrect-username-or-password>Error: <code>unauthorized: incorrect username or password</code></h2><p>This error appears when you use the deprecated variable, <code>CI_BUILD_TOKEN</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>Error response from daemon: Get &#34;https://registry-1.docker.io/v2/&#34;: unauthorized: incorrect username or password</span></span></code></pre></div></div><p>To prevent users from receiving this error, you should:</p><ul><li>Use <a href=/ci/jobs/ci_job_token/>CI_JOB_TOKEN</a> instead.</li><li>Change from <code>gitlab-ci-token/CI_BUILD_TOKEN</code> to <code>$CI_REGISTRY_USER/$CI_REGISTRY_PASSWORD</code>.</li></ul><h2 id=error-during-connect-no-such-host>Error during connect: <code>no such host</code></h2><p>This error appears when the <code>dind</code> service has failed to start:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>error during connect: Post &#34;https://docker:2376/v1.24/auth&#34;: dial tcp: lookup docker on 127.0.0.11:53: no such host</span></span></code></pre></div></div><p>Check the job log to see if <code>mount: permission denied (are you root?)</code>
appears. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>Service container logs:
</span></span><span class=line><span class=cl>2023-08-01T16:04:09.541703572Z Certificate request self-signature ok
</span></span><span class=line><span class=cl>2023-08-01T16:04:09.541770852Z subject=CN = docker:dind server
</span></span><span class=line><span class=cl>2023-08-01T16:04:09.556183222Z /certs/server/cert.pem: OK
</span></span><span class=line><span class=cl>2023-08-01T16:04:10.641128729Z Certificate request self-signature ok
</span></span><span class=line><span class=cl>2023-08-01T16:04:10.641173149Z subject=CN = docker:dind client
</span></span><span class=line><span class=cl>2023-08-01T16:04:10.656089908Z /certs/client/cert.pem: OK
</span></span><span class=line><span class=cl>2023-08-01T16:04:10.659571093Z ip: can&#39;t find device &#39;ip_tables&#39;
</span></span><span class=line><span class=cl>2023-08-01T16:04:10.660872131Z modprobe: can&#39;t change directory to &#39;/lib/modules&#39;: No such file or directory
</span></span><span class=line><span class=cl>2023-08-01T16:04:10.664620455Z mount: permission denied (are you root?)
</span></span><span class=line><span class=cl>2023-08-01T16:04:10.664692175Z Could not mount /sys/kernel/security.
</span></span><span class=line><span class=cl>2023-08-01T16:04:10.664703615Z AppArmor detection and --privileged mode might break.
</span></span><span class=line><span class=cl>2023-08-01T16:04:10.665952353Z mount: permission denied (are you root?)</span></span></code></pre></div></div><p>This indicates the GitLab Runner does not have permission to start the
<code>dind</code> service:</p><ol><li>Check that <code>privileged = true</code> is set in the <code>config.toml</code>.</li><li>Make sure the CI job has the right Runner tags to use these
privileged runners.</li></ol><h2 id=error-cgroups-cgroup-mountpoint-does-not-exist-unknown>Error: <code>cgroups: cgroup mountpoint does not exist: unknown</code></h2><p>There is a known incompatibility introduced by Docker Engine 20.10.</p><p>When the host uses Docker Engine 20.10 or later, then the <code>docker:dind</code> service in a version older than 20.10 does
not work as expected.</p><p>While the service itself will start without problems, trying to build the container image results in the error:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>cgroups: cgroup mountpoint does not exist: unknown</span></span></code></pre></div></div><p>To resolve this issue, update the <code>docker:dind</code> container to version at least 20.10.x,
for example <code>docker:24.0.5-dind</code>.</p><p>The opposite configuration (<code>docker:24.0.5-dind</code> service and Docker Engine on the host in version
19.06.x or older) works without problems. For the best strategy, you should to frequently test and update
job environment versions to the newest. This brings new features, improved security and - for this specific
case - makes the upgrade on the underlying Docker Engine on the runner&rsquo;s host transparent for the job.</p><h2 id=error-failed-to-verify-certificate-x509-certificate-signed-by-unknown-authority>Error: <code>failed to verify certificate: x509: certificate signed by unknown authority</code></h2><p>This error can appear when Docker commands like <code>docker build</code> or <code>docker pull</code> are executed in a Docker-in-Docker
environment where custom or private certificates are used (for example, Zscaler certificates):</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>error pulling image configuration: download failed after attempts=6: tls: failed to verify certificate: x509: certificate signed by unknown authority</span></span></code></pre></div></div><p>This error occurs because Docker commands in a Docker-in-Docker environment
use two separate containers:</p><ul><li>The <strong>build container</strong> runs the Docker client (<code>/usr/bin/docker</code>) and executes your job&rsquo;s script commands.</li><li>The <strong>service container</strong> (often named <code>svc</code>) runs the Docker daemon that processes most Docker commands.</li></ul><p>When your organization uses custom certificates, both containers need these certificates.
Without proper certificate configuration in both containers, Docker operations that connect to external
registries or services will fail with certificate errors.</p><p>To resolve this issue:</p><ol><li><p>Store your root certificate as a <a href=/ci/variables/#define-a-cicd-variable-in-the-ui>CI/CD variable</a> named <code>CA_CERTIFICATE</code>.
The certificate should be in this format:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>-----BEGIN CERTIFICATE-----
</span></span><span class=line><span class=cl>(certificate content)
</span></span><span class=line><span class=cl>-----END CERTIFICATE-----</span></span></code></pre></div></div></li><li><p>Configure your pipeline to install the certificate in the service container before starting the Docker daemon. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>image_build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>docker:19.03</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>DOCKER_HOST</span><span class=p>:</span><span class=w> </span><span class=l>tcp://localhost:2375</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>DOCKER_TLS_CERTDIR</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>CA_CERTIFICATE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;$CA_CERTIFICATE&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>docker:19.03-dind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>/bin/sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          echo &#34;$CA_CERTIFICATE&#34; &gt; /usr/local/share/ca-certificates/custom-ca.crt &amp;&amp; \
</span></span></span><span class=line><span class=cl><span class=sd>          update-ca-certificates &amp;&amp; \
</span></span></span><span class=line><span class=cl><span class=sd>          dockerd-entrypoint.sh || exit</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>docker info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD $DOCKER_REGISTRY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>docker build -t &#34;${DOCKER_REGISTRY}/my-app:${CI_COMMIT_REF_NAME}&#34; .</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>docker push &#34;${DOCKER_REGISTRY}/my-app:${CI_COMMIT_REF_NAME}&#34;</span></span></span></code></pre></div></div></li></ol></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/docker/docker_build_troubleshooting.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/docker/docker_build_troubleshooting.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>