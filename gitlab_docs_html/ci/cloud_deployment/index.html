<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Deploy to AWS from GitLab CI/CD | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/cloud_deployment/><meta name=description content="Deploy applications from GitLab CI/CD to AWS, including ECS and EC2, by using GitLab-provided Docker images and CloudFormation templates."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage=Deploy data-group=Environments><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Deploy and release your application › Deployments"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/release_your_application/",title:"Deploy and release your application"},{path:"ci/environments/deployments/",title:"Deployments"},{path:"ci/cloud_deployment/",title:"Deploy to AWS"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/cloud_deployment/index.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Deploy to AWS from GitLab CI/CD</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Free, Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>GitLab provides Docker images with the libraries and tools you need to deploy
to AWS. You can reference these images in your CI/CD pipeline.</p><p>If you&rsquo;re using GitLab.com and deploying to the <a href=https://aws.amazon.com/ecs/>Amazon Elastic Container Service</a> (ECS),
read about <a href=/ci/cloud_deployment/ecs/deploy_to_aws_ecs/>deploying to ECS</a>.</p><div class="alert alert-type-note gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>If you are comfortable configuring a deployment yourself and just need to retrieve
AWS credentials, consider using <a href=/ci/cloud_services/aws/>ID tokens and OpenID Connect</a>.
ID tokens are more secure than storing credentials in CI/CD variables, but do not
work with the guidance on this page.</p></div></div><h2 id=authenticate-gitlab-with-aws>Authenticate GitLab with AWS</h2><p>To use GitLab CI/CD to connect to AWS, you must authenticate.
After you set up authentication, you can configure CI/CD to deploy.</p><ol><li><p>Sign on to your AWS account.</p></li><li><p>Create <a href=https://console.aws.amazon.com/iam/home#/home>an IAM user</a>.</p></li><li><p>Select your user to access its details. Go to <strong>Security credentials</strong> > <strong>Create a new access key</strong>.</p></li><li><p>Note the <strong>Access key ID</strong> and <strong>Secret access key</strong>.</p></li><li><p>In your GitLab project, go to <strong>Settings</strong> > <strong>CI/CD</strong>. Set the following
<a href=/ci/variables/>CI/CD variables</a>:</p><table><thead><tr><th style=text-align:left>Environment variable name</th><th style=text-align:left>Value</th></tr></thead><tbody><tr><td style=text-align:left><code>AWS_ACCESS_KEY_ID</code></td><td style=text-align:left>Your Access key ID.</td></tr><tr><td style=text-align:left><code>AWS_SECRET_ACCESS_KEY</code></td><td style=text-align:left>Your secret access key.</td></tr><tr><td style=text-align:left><code>AWS_DEFAULT_REGION</code></td><td style=text-align:left>Your region code. You might want to confirm that the AWS service you intend to use is <a href=https://aws.amazon.com/about-aws/global-infrastructure/regional-product-services/>available in the chosen region</a>.</td></tr></tbody></table></li><li><p>Variables are <a href=/ci/variables/#protect-a-cicd-variable>protected by default</a>.
To use GitLab CI/CD with branches or tags that are not protected,
clear the <strong>Protect variable</strong> checkbox.</p></li></ol><h2 id=use-an-image-to-run-aws-commands>Use an image to run AWS commands</h2><p>If an image contains the <a href=https://aws.amazon.com/cli/>AWS Command Line Interface</a>,
you can reference the image in your project&rsquo;s <code>.gitlab-ci.yml</code> file. Then you can run
<code>aws</code> commands in your CI/CD jobs.</p><p>For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>aws s3 ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>aws create-deployment ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><p>GitLab provides a Docker image that includes the AWS CLI:</p><ul><li>Images are hosted in the GitLab container registry. The latest image is
<code>registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest</code>.</li><li><a href=https://gitlab.com/gitlab-org/cloud-deploy/-/tree/master/aws>Images are stored in a GitLab repository</a>.</li></ul><p>Alternately, you can use an <a href=https://aws.amazon.com/ecr/>Amazon Elastic Container Registry (ECR)</a> image.
<a href=https://docs.aws.amazon.com/AmazonECR/latest/userguide/docker-push-ecr-image.html>Learn how to push an image to your ECR repository</a>.</p><p>You can also use an image from any third-party registry.</p><h2 id=deploy-your-application-to-ecs>Deploy your application to ECS</h2><p>You can automate deployments of your application to your <a href=https://aws.amazon.com/ecs/>Amazon ECS</a>
cluster.</p><p>Prerequisites:</p><ul><li><a href=/ci/cloud_deployment/#authenticate-gitlab-with-aws>Authenticate AWS with GitLab</a>.</li><li>Create a cluster on Amazon ECS.</li><li>Create related components, like an ECS service or a database on Amazon RDS.</li><li>Create an ECS task definition, where the value for the <code>containerDefinitions[].name</code> attribute is
the same as the <code>Container name</code> defined in your targeted ECS service. The task definition can be:<ul><li>An existing task definition in ECS.</li><li>A JSON file in your GitLab project. Use the
<a href=https://docs.aws.amazon.com/AmazonECS/latest/developerguide/create-task-definition.html#task-definition-template>template in the AWS documentation</a>
and save the file in your project. For example <code>&lt;project-root>/ci/aws/task-definition.json</code>.</li></ul></li></ul><p>To deploy to your ECS cluster:</p><ol><li><p>In your GitLab project, go to <strong>Settings</strong> > <strong>CI/CD</strong>. Set the following
<a href=/ci/variables/>CI/CD variables</a>. You can find these names by
selecting the targeted cluster on your <a href=https://console.aws.amazon.com/ecs/home>Amazon ECS dashboard</a>.</p><table><thead><tr><th style=text-align:left>Environment variable name</th><th style=text-align:left>Value</th></tr></thead><tbody><tr><td style=text-align:left><code>CI_AWS_ECS_CLUSTER</code></td><td style=text-align:left>The name of the AWS ECS cluster that you&rsquo;re targeting for your deployments.</td></tr><tr><td style=text-align:left><code>CI_AWS_ECS_SERVICE</code></td><td style=text-align:left>The name of the targeted service tied to your AWS ECS cluster. Ensure that this variable is scoped to the appropriate environment (<code>production</code>, <code>staging</code>, <code>review/*</code>).</td></tr><tr><td style=text-align:left><code>CI_AWS_ECS_TASK_DEFINITION</code></td><td style=text-align:left>If the task definition is in ECS, the name of the task definition tied to the service.</td></tr><tr><td style=text-align:left><code>CI_AWS_ECS_TASK_DEFINITION_FILE</code></td><td style=text-align:left>If the task definition is a JSON file in GitLab, the filename, including the path. For example, <code>ci/aws/my_task_definition.json</code>. If the name of the task definition in your JSON file is the same name as an existing task definition in ECS, then a new revision is created when CI/CD runs. Otherwise, a brand new task definition is created, starting at revision 1.</td></tr></tbody></table><div class="alert alert-type-warning gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>If you define both <code>CI_AWS_ECS_TASK_DEFINITION_FILE</code> and <code>CI_AWS_ECS_TASK_DEFINITION</code>,
<code>CI_AWS_ECS_TASK_DEFINITION_FILE</code> takes precedence.</p></div></div></li><li><p>Include this template in <code>.gitlab-ci.yml</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>include</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>template</span><span class=p>:</span><span class=w> </span><span class=l>AWS/Deploy-ECS.gitlab-ci.yml</span></span></span></code></pre></div></div><p>The <code>AWS/Deploy-ECS</code> template ships with GitLab and is available
<a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/AWS/Deploy-ECS.gitlab-ci.yml>on GitLab.com</a>.</p></li><li><p>Commit and push your updated <code>.gitlab-ci.yml</code> to your project&rsquo;s repository.</p></li></ol><p>Your application Docker image is rebuilt and pushed to the GitLab container registry.
If your image is located in a private registry, make sure your task definition is
<a href=https://docs.aws.amazon.com/AmazonECS/latest/developerguide/private-auth.html>configured with a <code>repositoryCredentials</code> attribute</a>.</p><p>The targeted task definition is updated with the location of the new
Docker image, and a new revision is created in ECS as result.</p><p>Finally, your AWS ECS service is updated with the new revision of the
task definition, making the cluster pull the newest version of your
application.</p><div class="alert alert-type-note gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>ECS deploy jobs wait for the rollout to complete before exiting. To disable this behavior,
set <code>CI_AWS_ECS_WAIT_FOR_ROLLOUT_COMPLETE_DISABLED</code> to a non-empty value.</p></div></div><div class="alert alert-type-warning gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>The <a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/AWS/Deploy-ECS.gitlab-ci.yml><code>AWS/Deploy-ECS.gitlab-ci.yml</code></a>
template includes two templates: <a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Jobs/Build.gitlab-ci.yml><code>Jobs/Build.gitlab-ci.yml</code></a>
and <a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Jobs/Deploy/ECS.gitlab-ci.yml><code>Jobs/Deploy/ECS.gitlab-ci.yml</code></a>. Do not include these templates on their own. Only include the
<code>AWS/Deploy-ECS.gitlab-ci.yml</code> template. These other templates are designed to be
used only with the main template. They may move or change unexpectedly. Also, the job names in
these templates may change. Do not override these job names in your own pipeline,
because the override stops working when the name changes.</p></div></div><h2 id=deploy-your-application-to-ec2>Deploy your application to EC2</h2><p>GitLab provides a template, called <code>AWS/CF-Provision-and-Deploy-EC2</code>,
to assist you in deploying to Amazon EC2.</p><p>When you configure related JSON objects and use the template, the pipeline:</p><ol><li><strong>Creates the stack</strong>: Your infrastructure is provisioned by using
the <a href=https://aws.amazon.com/cloudformation/>AWS CloudFormation</a> API.</li><li><strong>Pushes to an S3 bucket</strong>: When your build runs, it creates an artifact.
The artifact is pushed to an <a href=https://aws.amazon.com/s3/>AWS S3</a> bucket.</li><li><strong>Deploys to EC2</strong>: The content is deployed on an <a href=https://aws.amazon.com/ec2/>AWS EC2</a> instance,
as shown in this diagram:</li></ol><p><a href=/ci/cloud_deployment/img/cf_ec2_diagram_v13_5.png target=_blank rel="noopener noreferrer"><img alt="Shows the CF-Provision-and-Deploy-EC2 pipeline, including the steps of provisioning infrastructure, pushing artifacts to S3, and deploying to EC2." height=749 src=/ci/cloud_deployment/img/cf_ec2_diagram_v13_5.png width=1357></a></p><h3 id=configure-the-template-and-json>Configure the template and JSON</h3><p>To deploy to EC2, complete the following steps.</p><ol><li><p>Create JSON for your stack. Use the <a href=https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/template-anatomy.html>AWS template</a>.</p></li><li><p>Create JSON to push to S3. Include the following details.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=json class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;applicationName&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;source&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;s3Location&#34;</span><span class=p>:</span> <span class=s2>&#34;s3://your/bucket/project_built_file...]&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>The <code>source</code> is the location where a <code>build</code> job built your application.
The build is saved to <a href=/ci/yaml/#artifactspaths><code>artifacts:paths</code></a>.</p></li><li><p>Create JSON to deploy to EC2. Use the <a href=https://docs.aws.amazon.com/codedeploy/latest/APIReference/API_CreateDeployment.html>AWS template</a>.</p></li><li><p>Make the JSON objects accessible to your pipeline:</p><ul><li><p>If you want these JSON objects saved in your repository, save the objects as three
separate files.</p><p>In your <code>.gitlab-ci.yml</code> file, add <a href=/ci/variables/>CI/CD variables</a>
that point to the file paths relative to the project root. For example,
if your JSON files are in a <code>&lt;project_root>/aws</code> folder:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>CI_AWS_CF_CREATE_STACK_FILE</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;aws/cf_create_stack.json&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>CI_AWS_S3_PUSH_FILE</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;aws/s3_push.json&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>CI_AWS_EC2_DEPLOYMENT_FILE</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;aws/create_deployment.json&#39;</span></span></span></code></pre></div></div></li><li><p>If you do not want these JSON objects saved in your repository, add each object
as a separate <a href=/ci/variables/#use-file-type-cicd-variables>file type CI/CD variable</a>
in the project settings. Use the same previous variable names.</p></li></ul></li><li><p>In your <code>.gitlab-ci.yml</code> file, create a CI/CD variable for the name of the stack. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>CI_AWS_CF_STACK_NAME</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;YourStackName&#39;</span></span></span></code></pre></div></div></li><li><p>In your <code>.gitlab-ci.yml</code> file, add the CI template:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>include</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>template</span><span class=p>:</span><span class=w> </span><span class=l>AWS/CF-Provision-and-Deploy-EC2.gitlab-ci.yml</span></span></span></code></pre></div></div></li><li><p>Run the pipeline.</p><ul><li>Your AWS CloudFormation stack is created based on the content of your
<code>CI_AWS_CF_CREATE_STACK_FILE</code> variable.
If your stack already exists, this step is skipped, but the <code>provision</code>
job it belongs to still runs.</li><li>Your built application is pushed to your S3 bucket then and deployed to your EC2 instance, based
on the related JSON object&rsquo;s content. The deployment job finishes when the deployment to EC2
is done or has failed.</li></ul></li></ol><h2 id=troubleshooting>Troubleshooting</h2><h3 id=error-ascii-codec-cant-encode-character-uxxxx>Error <code>'ascii' codec can't encode character '\uxxxx'</code></h3><p>This error can occur when the response from the <code>aws-cli</code> utility used by the Cloud Deploy images contains a Unicode character. The Cloud Deploy images do not have a defined locale and default to using ASCII. To resolve this error, add the following CI/CD variable:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>LANG</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;UTF-8&#34;</span></span></span></code></pre></div></div></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/cloud_deployment/_index.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/cloud_deployment/_index.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>