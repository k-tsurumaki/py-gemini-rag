<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Tutorial: Create a complex pipeline | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/quick_start/tutorial/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage=Verify data-group="Pipeline Authoring"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="tutorials"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › Getting started"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/",title:"Getting started"},{path:"ci/quick_start/tutorial/",title:"Tutorial: A complex pipeline"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/quick_start/tutorial.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Tutorial: Create a complex pipeline</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Free, Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>This tutorial walks you through configuring a progressively more complex CI/CD pipeline
through small, iterative steps. The pipeline is always fully functional,
but it gains more functionality with each step. The goal is to build, test, and deploy
a documentation site.</p><p>When you finish this tutorial, you will have a new project on GitLab.com and a working documentation site
using <a href=https://docusaurus.io/>Docusaurus</a>.</p><p>To complete this tutorial, you will:</p><ol><li>Create a project to hold the Docusaurus files</li><li>Create the initial pipeline configuration file</li><li>Add a job to build the site</li><li>Add a job to deploy the site</li><li>Add test jobs</li><li>Start using merge request pipelines</li><li>Reduce duplicated configuration</li></ol><h2 id=prerequisites>Prerequisites</h2><ul><li>You need an account on GitLab.com.</li><li>You should be familiar with Git.</li><li>Node.js must be installed on your local machine. For example, on macOS you can
<a href=https://formulae.brew.sh/formula/node>install node</a> with <code>brew install node</code>.</li></ul><h2 id=create-a-project-to-hold-the-docusaurus-files>Create a project to hold the Docusaurus files</h2><p>Before adding the pipeline configuration, you must first set up a Docusaurus project
on GitLab.com:</p><ol><li><p>Create a new project under your username (not a group):</p><ol><li>On the left sidebar, at the top, select <strong>Create new</strong> (<span> <svg role="img" aria-label="plus" class="gl-icon s16"><use href="/gitlab_ui/svgs-latest/icons.svg#plus"/><title>plus</title></svg> </span>) and <strong>New project/repository</strong>. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this button is in the upper-right corner.</li><li>Select <strong>Create blank project</strong>.</li><li>Enter the project details:<ul><li>In the <strong>Project name</strong> field, enter the name of your project, for example <code>My Pipeline Tutorial Project</code>.</li><li>Select <strong>Initialize repository with a README</strong>.</li></ul></li><li>Select <strong>Create project</strong>.</li></ol></li><li><p>On the project&rsquo;s overview page, in the upper-right corner, select <strong>Code</strong>
to find the clone paths for your project. Copy the SSH or HTTP path and use the path
to clone the project locally.</p><p>For example, to clone with SSH into a <code>pipeline-tutorial</code> directory on your computer:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git clone git@gitlab.com:my-username/my-pipeline-tutorial-project.git pipeline-tutorial</span></span></code></pre></div></div></li><li><p>Change to the project&rsquo;s directory, then generate a new Docusaurus site:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> pipeline-tutorial
</span></span><span class=line><span class=cl>npm init docusaurus</span></span></code></pre></div></div><p>The Docusaurus initialization wizard prompts you with questions about the site.
Use all the default options.</p></li><li><p>The initialization wizard sets up the site in <code>website/</code>, but the site should be in
the root of the project. Move the files up to the root and delete the old directory:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mv website/* .
</span></span><span class=line><span class=cl>rm -r website</span></span></code></pre></div></div></li><li><p>Update the Docusaurus configuration file with the details of your GitLab project.
In <code>docusaurus.config.js</code>:</p><ul><li>Set <code>url:</code> to a path with this format: <code>https://&lt;my-username>.gitlab.io/</code>.</li><li>Set <code>baseUrl:</code> to your project name, like <code>/my-pipeline-tutorial-project/</code>.</li></ul></li><li><p>Commit the changes, and push them to GitLab:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;Add simple generated Docusaurus site&#34;</span>
</span></span><span class=line><span class=cl>git push origin</span></span></code></pre></div></div></li></ol><h2 id=create-the-initial-cicd-configuration-file>Create the initial CI/CD configuration file</h2><p>Start with the simplest possible pipeline configuration file to ensure CI/CD is enabled
in the project and runners are available to run jobs.</p><p>This step introduces:</p><ul><li><a href=/ci/jobs/>Jobs</a>: These are self-contained parts of a pipeline that run your commands.
Jobs run on <a href=/ci/runners/>runners</a>, separate from the GitLab instance.</li><li><a href=/ci/yaml/#script><code>script</code></a>: This section of a job&rsquo;s configuration is
where you define the commands for jobs. If there are multiple commands (in an array),
they run in order. Each command executes as if it was run as a CLI command.
By default, if a command fails or returns an error, the job is flagged as failed
and no more commands run.</li></ul><p>In this step, create a <code>.gitlab-ci.yml</code> file in the root of the project with this configuration:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>test-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;This is my first job!&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>date</span></span></span></code></pre></div></div><p>Commit and push this change to GitLab, then:</p><ol><li>Go to <strong>Build</strong> > <strong>Pipelines</strong> and make sure a pipeline runs in GitLab with this single job.</li><li>Select the pipeline, then select the job to view the job&rsquo;s log and see the <code>This is my first job!</code> message
followed by the date.</li></ol><p>Now that you have a <code>.gitlab-ci.yml</code> file in your project, you can make all future changes
to pipeline configuration with the <a href=/ci/pipeline_editor/>pipeline editor</a>.</p><h2 id=add-a-job-to-build-the-site>Add a job to build the site</h2><p>A common task for a CI/CD pipeline is to build the code in the project then deploy it.
Start by adding a job that builds the site.</p><p>This step introduces:</p><ul><li><a href=/ci/yaml/#image><code>image</code></a>: Tell the runner which Docker
container to use to run the job in. The runner:<ol><li>Downloads the container image and starts it.</li><li>Clones your GitLab project into the running container.</li><li>Runs the <code>script</code> commands, one at a time.</li></ol></li><li><a href=/ci/yaml/#artifacts><code>artifacts</code></a>: Jobs are self-contained and do not share
resources with each other. If you want files generated in one job to be used in
another job, you must save them as artifacts first. Then later jobs can retrieve the
artifacts and use the generated files.</li></ul><p>In this step, replace <code>test-job</code> with <code>build-job</code>:</p><ul><li>Use <code>image</code> to configure the job to run with the latest <code>node</code> image. Docusaurus
is a Node.js project and the <code>node</code> image has the needed <code>npm</code> commands built in.</li><li>Run <code>npm install</code> to install Docusaurus into the running <code>node</code> container, then run
<code>npm run build</code> to build the site.</li><li>Docusaurus saves the built site in <code>build/</code>, so save these files with <code>artifacts</code>.</li></ul><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>build-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm run build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;build/&#34;</span></span></span></code></pre></div></div><p>Use the pipeline editor to commit this pipeline configuration to the default branch,
and check the job log. You can:</p><ul><li>See the <code>npm</code> commands run and build the site.</li><li>Verify that the artifacts are saved at the end.</li><li>Browse the contents of the artifacts file by selecting <strong>Browse</strong> to the right of the job log
after the job completes.</li></ul><h2 id=add-a-job-to-deploy-the-site>Add a job to deploy the site</h2><p>After verifying the Docusaurus site builds in <code>build-job</code>, you can add a job that deploys it.</p><p>This step introduces:</p><ul><li><a href=/ci/yaml/#stage><code>stage</code></a> and <a href=/ci/yaml/#stage><code>stages</code></a>: The most common
pipeline configurations group jobs into stages. Jobs in the same stage can run in parallel,
while jobs in later stages wait for jobs in earlier stages to complete. If a job fails,
the whole stage is considered failed and jobs in later stages do not start running.</li><li><a href=/user/project/pages/>GitLab Pages</a>: To host your static site, you
will use GitLab Pages.</li></ul><p>In this step:</p><ul><li>Add a job that fetches the built site and deploys it. When using GitLab Pages,
the job is always named <code>pages</code>. The artifacts from the <code>build-job</code> are fetched automatically
and extracted into the job. Pages looks for the site in the <code>public/</code> directory though,
so add a <code>script</code> command to move the site to that directory.</li><li>Add a <code>stages</code> section, and define the stages for each job. <code>build-job</code> runs first
in the <code>build</code> stage, and <code>pages</code> runs after in the <code>deploy</code> stage.</li></ul><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>stages</span><span class=p>:</span><span class=w>          </span><span class=c># List of stages for jobs and their order of execution</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>build-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build  </span><span class=w> </span><span class=c># Set this job to run in the `build` stage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm run build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;build/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>pages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy </span><span class=w> </span><span class=c># Set this new job to run in the `deploy` stage</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mv build/ public/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;public/&#34;</span></span></span></code></pre></div></div><p>Use the pipeline editor to commit this pipeline configuration to the default branch,
and view the pipeline details from the <strong>Pipelines</strong> list. Verify that:</p><ul><li>The two jobs run in different stages, <code>build</code> and <code>deploy</code>.</li><li>After the <code>pages</code> job completes a <code>pages:deploy</code> job appears, which is the GitLab process
that deploys the Pages site. When that job completes, you can visit your new Docusaurus
site.</li></ul><p>To view your site:</p><ul><li>On the left sidebar, select <strong>Deploy</strong> > <strong>Pages</strong>.</li><li>Make sure <strong>Use unique domain</strong> is off.</li><li>Under <strong>Access pages</strong>, select the link. The URL format should be similar to: <code>https://&lt;my-username>.gitlab.io/&lt;project-name></code>. For more information, see <a href=/user/project/pages/getting_started_part_one/#gitlab-pages-default-domain-names>GitLab Pages default domain names</a>.</li></ul><div class="alert alert-type-note gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>If you need to <a href=/user/project/pages/#unique-domains>use unique domains</a>, in <code>docusaurus.config.js</code>, set <code>baseUrl</code>: to <code>/</code>.</p></div></div><h2 id=add-test-jobs>Add test jobs</h2><p>Now that the site builds and deploys as expected, you can add tests and linting.
For example, a Ruby project might run RSpec test jobs. Docusaurus is a static site
that uses Markdown and generated HTML, so this tutorial adds jobs to test the Markdown and HTML.</p><p>This step introduces:</p><ul><li><a href=/ci/yaml/#allow_failure><code>allow_failure</code></a>: Jobs that fail intermittently,
or are expected to fail, can slow down productivity or be difficult to troubleshoot.
Use <code>allow_failure</code> to let jobs fail without halting pipeline execution.</li><li><a href=/ci/yaml/#dependencies><code>dependencies</code></a>: Use <code>dependencies</code> to control
artifact downloads in individual jobs by listing which jobs to fetch artifacts from.</li></ul><p>In this step:</p><ul><li>Add a new <code>test</code> stage that runs between <code>build</code> and <code>deploy</code>. These three stages
are the default stages when <code>stages</code> is undefined in the configuration.</li><li>Add a <code>lint-markdown</code> job to run <a href=https://github.com/DavidAnson/markdownlint>markdownlint</a>
and check the Markdown in your project. markdownlint is a static analysis tool that
checks that your Markdown files follow formatting standards.<ul><li>The sample Markdown files Docusaurus generates are in <code>blog/</code> and <code>docs/</code>.</li><li>This tool scans the original Markdown files only, and does not need the generated HTML
saved in the <code>build-job</code> artifacts. Speed up the job with <code>dependencies: []</code>
so that it fetches no artifacts.</li><li>A few of the sample Markdown files violate default markdownlint rules, so add
<code>allow_failure: true</code> to let the pipeline continue despite the rule violations.</li></ul></li><li>Add a <code>test-html</code> job to run <a href=https://htmlhint.com/>HTMLHint</a> and check the generated HTML.
HTMLHint is a static analysis tool that scans generated HTML for known issues.</li><li>Both <code>test-html</code> and <code>pages</code> need the generated HTML found in the <code>build-job</code> artifacts.
Jobs fetch artifacts from all jobs in earlier stages by default, but add <code>dependencies:</code>
to make sure the jobs don&rsquo;t accidentally download other artifacts after future pipeline changes.</li></ul><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test              </span><span class=w> </span><span class=c># Add a `test` stage for the test jobs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>build-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm run build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;build/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>lint-markdown</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>     </span><span class=c># Don&#39;t fetch any artifacts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install markdownlint-cli2 --global          </span><span class=w> </span><span class=c># Install markdownlint into the container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>markdownlint-cli2 -v                            </span><span class=w> </span><span class=c># Verify the version, useful for troubleshooting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>markdownlint-cli2 &#34;blog/**/*.md&#34; &#34;docs/**/*.md&#34; </span><span class=w> </span><span class=c># Lint all markdown files in blog/ and docs/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>allow_failure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># This job fails right now, but don&#39;t let it stop the pipeline.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test-html</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>build-job       </span><span class=w> </span><span class=c># Only fetch artifacts from `build-job`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install --save-dev htmlhint                 </span><span class=w> </span><span class=c># Install HTMLHint into the container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npx htmlhint --version                          </span><span class=w> </span><span class=c># Verify the version, useful for troubleshooting</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npx htmlhint build/                             </span><span class=w> </span><span class=c># Lint all markdown files in blog/ and docs/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>pages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>build-job       </span><span class=w> </span><span class=c># Only fetch artifacts from `build-job`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mv build/ public/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;public/&#34;</span></span></span></code></pre></div></div><p>Commit this pipeline configuration to the default branch, and view the pipeline details.</p><ul><li>The <code>lint-markdown</code> job fails because the sample Markdown violates the default
markdownlint rules, but is allowed to fail. You can:<ul><li>Ignore the violations for now. They do not need to be fixed as part of the tutorial.</li><li>Fix the Markdown file violations. Then you can change <code>allow_failure</code> to <code>false</code>,
or remove <code>allow_failure</code> completely because <code>allow_failure: false</code> is the default behavior
when not defined.</li><li>Add a markdownlint configuration file to limit which rule violations to alert on.</li></ul></li><li>You can also make changes to the Markdown file content and see the changes on the site
after the next deployment.</li></ul><h2 id=start-using-merge-request-pipelines>Start using merge request pipelines</h2><p>With the previous pipeline configurations, the site deploys every time a pipeline completes
successfully, but this is not an ideal development workflow. It&rsquo;s better to work from
feature branches and merge requests, and only deploy the site when changes merge
to the default branch.</p><p>This step introduces:</p><ul><li><a href=/ci/yaml/#rules><code>rules</code></a>: Add rules to each job to configure in which
pipelines they run. You can configure jobs to run in <a href=/ci/pipelines/merge_request_pipelines/>merge request pipelines</a>,
<a href=/ci/pipelines/schedules/>scheduled pipelines</a>, or other specific situations.
Rules are evaluated from top to bottom, and if a rule matches, the job is
added to the pipeline.</li><li><a href=/ci/variables/>CI/CD variables</a>: use these environment variables
to configure job behavior in the configuration file and in script commands.
<a href=/ci/variables/predefined_variables/>Predefined CI/CD variables</a> are variables
that you do not need to manually define. They are automatically injected into pipelines
so you can use them to configure your pipeline. Variables are usually formatted as <code>$VARIABLE_NAME</code>.
and predefined variables are usually prefixed with <code>$CI_</code>.</li></ul><p>In this step:</p><ul><li>Create a new feature branch and make the changes in the branch instead of the default branch.</li><li>Add <code>rules</code> to each job:<ul><li>The site should only deploy for changes to the default branch.</li><li>The other jobs should run for all changes in merge requests or the default branch.</li></ul></li><li>With this pipeline configuration, you can work from a feature branch without running any jobs,
which saves resources. When you are ready to validate your changes, create a merge request
and a pipeline runs with the jobs configured to run in merge requests.</li><li>When your merge request is accepted and the changes merge to the default branch,
a new pipeline runs which also contains the <code>pages</code> deployment job. The site deploys
if no jobs fail.</li></ul><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>build-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm run build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;build/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#39;merge_request_event&#39; </span><span class=w> </span><span class=c># Run for all changes to a merge request&#39;s source branch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH      </span><span class=w> </span><span class=c># Run for all changes to the default branch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>lint-markdown</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install markdownlint-cli2 --global</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>markdownlint-cli2 -v</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>markdownlint-cli2 &#34;blog/**/*.md&#34; &#34;docs/**/*.md&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>allow_failure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#39;merge_request_event&#39; </span><span class=w> </span><span class=c># Run for all changes to a merge request&#39;s source branch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH      </span><span class=w> </span><span class=c># Run for all changes to the default branch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test-html</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>build-job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install --save-dev htmlhint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npx htmlhint --version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npx htmlhint build/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#39;merge_request_event&#39; </span><span class=w> </span><span class=c># Run for all changes to a merge request&#39;s source branch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH      </span><span class=w> </span><span class=c># Run for all changes to the default branch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>pages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>build-job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mv build/ public/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;public/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH     </span><span class=w> </span><span class=c># Run for all changes to the default branch only</span></span></span></code></pre></div></div><p>Merge the changes in your merge request. This action updates the default branch. Verify that
the new pipeline contains the <code>pages</code> job that deploys the site.</p><p>Be sure to use feature branches and merge requests for all future changes to pipeline configuration.
Other project changes, like creating a Git tag or adding a pipeline schedule, do not
trigger pipelines unless you add rules for those cases too.</p><h2 id=reduce-duplicated-configuration>Reduce duplicated configuration</h2><p>The pipeline now contains three jobs that all have identical <code>rules</code> and <code>image</code>
configuration. Instead of repeating these rules, use <code>extends</code> and <code>default</code> to create
single sources of truth.</p><p>This step introduces:</p><ul><li><a href=/ci/jobs/#hide-a-job>Hidden jobs</a>: Jobs that start with <code>.</code> are never
added to a pipeline. Use them to hold configuration you want to reuse.</li><li><a href=/ci/yaml/#extends><code>extends</code></a>: Use extends to repeat configuration in
multiple places, often from hidden jobs. If you update the hidden job&rsquo;s configuration,
all jobs extending the hidden job use the updated configuration.</li><li><a href=/ci/yaml/#default><code>default</code></a>: Set keyword defaults that apply to all jobs
when not defined.</li><li>YAML overriding: When reusing configuration with <code>extends</code> or <code>default</code>, you can explicitly
define a keyword in the job to override the <code>extends</code> or <code>default</code> configuration.</li></ul><p>In this step:</p><ul><li>Add a <code>.standard-rules</code> hidden job to hold the rules that are repeated in <code>build-job</code>,
<code>lint-markdown</code>, and <code>test-html</code>.</li><li>Use <code>extends</code> to reuse the <code>.standard-rules</code> configuration in the three jobs.</li><li>Add a <code>default</code> section to define the <code>image</code> default as <code>node</code>.</li><li>The <code>pages</code> deployment job does not need the default <code>node</code> image, so explicitly use
<a href=https://hub.docker.com/_/busybox><code>busybox</code></a>, an extremely tiny and fast image.</li></ul><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>default</span><span class=p>:</span><span class=w>               </span><span class=c># Add a default section to define the `image` keyword&#39;s default value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>.standard-rules</span><span class=p>:</span><span class=w>       </span><span class=c># Make a hidden job to hold the common rules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PIPELINE_SOURCE == &#39;merge_request_event&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>build-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extends</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>.standard-rules </span><span class=w> </span><span class=c># Reuse the configuration in `.standard-rules` here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm run build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;build/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>lint-markdown</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extends</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>.standard-rules </span><span class=w> </span><span class=c># Reuse the configuration in `.standard-rules` here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w> </span><span class=p>[]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install markdownlint-cli2 --global</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>markdownlint-cli2 -v</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>markdownlint-cli2 &#34;blog/**/*.md&#34; &#34;docs/**/*.md&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>allow_failure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test-html</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extends</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>.standard-rules </span><span class=w> </span><span class=c># Reuse the configuration in `.standard-rules` here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>build-job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install --save-dev htmlhint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npx htmlhint --version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npx htmlhint build/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>pages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox      </span><span class=w> </span><span class=c># Override the default `image` value with `busybox`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dependencies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>build-job</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mv build/ public/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artifacts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;public/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH</span></span></span></code></pre></div></div><p>Use a merge request to commit this pipeline configuration to the default branch.
The file is simpler, but it should have the same behavior as the previous step.</p><p>You&rsquo;ve just created a full pipeline and streamlined it to be more efficient. Nice work!
Now you can take this knowledge, learn about the rest of the <code>.gitlab-ci.yml</code> keywords
in the <a href=/ci/yaml/>CI/CD YAML syntax reference</a>, and build your own pipelines.</p></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/quick_start/tutorial.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/quick_start/tutorial.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>