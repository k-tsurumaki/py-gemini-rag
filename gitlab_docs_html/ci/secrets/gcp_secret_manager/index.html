<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Use GCP Secret Manager secrets in GitLab CI/CD | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/secrets/gcp_secret_manager/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage="Software Supply Chain Security" data-group="Pipeline Security"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › External secrets"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/secrets/",title:"External secrets"},{path:"ci/secrets/gcp_secret_manager/",title:"GCP Secret Manager"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/secrets/gcp_secret_manager.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Use GCP Secret Manager secrets in GitLab CI/CD</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-1 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-1>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-1 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/groups/gitlab-org/-/epics/11739>Introduced</a> in GitLab and GitLab Runner 16.8.</li></ul></div></div><p>You can use secrets stored in the <a href=https://cloud.google.com/security/products/secret-manager>Google Cloud (GCP) Secret Manager</a>
in your GitLab CI/CD pipelines.</p><p>The flow for using GitLab with GCP Secret Manager is:</p><ol><li>GitLab issues an ID token to the CI/CD job.</li><li>The runner authenticates to GCP using the ID token.</li><li>GCP verifies the ID token with GitLab.</li><li>GCP issues a short-lived access token.</li><li>The runner accesses the secret data using the access token.</li><li>GCP checks IAM secret permission on the access token&rsquo;s principal.</li><li>GCP returns the secret data to the runner.</li></ol><p>To use GitLab with GCP Secret Manager, you must:</p><ul><li>Have secrets stored in <a href=https://cloud.google.com/security/products/secret-manager>GCP Secret Manager</a>.</li><li>Configure <a href=/ci/secrets/gcp_secret_manager/#configure-gcp-iam-workload-identity-federation-wif>GCP Workload Identity Federation</a> to include GitLab as an identity provider.</li><li>Configure <a href=/ci/secrets/gcp_secret_manager/#grant-access-to-gcp-iam-principal>GCP IAM</a> permissions to grant access to GCP Secret Manager.</li><li>Configure <a href=/ci/secrets/gcp_secret_manager/#configure-gitlab-cicd-to-use-gcp-secret-manager-secrets>GitLab CI/CD with GCP Secret Manager</a>.</li></ul><h2 id=configure-gcp-iam-workload-identity-federation-wif>Configure GCP IAM Workload Identity Federation (WIF)</h2><p>GCP IAM WIF must be configured to recognize ID tokens issued by GitLab and assign an appropriate principal to them.
The principal is used to authorize access to the Secret Manager resources:</p><ol><li><p>In GCP Console, go to <strong>IAM & Admin > Workload Identity Federation</strong>.</p></li><li><p>Select <strong>CREATE POOL</strong> and create a new identity pool with a unique name, for example <code>gitlab-pool</code>.</p></li><li><p>Select <strong>ADD PROVIDER</strong> to add a new OIDC Provider to the Identity Pool with a unique name, for example <code>gitlab-provider</code>.</p><ol><li>Set <strong>Issuer (URL)</strong> to the GitLab URL, for example <code>https://gitlab.com</code>.</li><li>Select <strong>Default audience</strong>, or select <strong>Allowed audiences</strong> for a custom audience, which is used in the <code>aud</code> for the GitLab CI/CD ID token.</li></ol></li><li><p>Under <strong>Attribute Mapping</strong>, create the following mappings, where:</p><ul><li><code>attribute.X</code> is the name of the attribute to include as a claim in the Google token.</li><li><code>assertion.X</code> is the value to extract from the <a href=/ci/cloud_services/#id-token-authentication-for-cloud-services>GitLab claim</a>.</li></ul><table><thead><tr><th>Attribute (on Google)</th><th>Assertion (from GitLab)</th></tr></thead><tbody><tr><td><code>google.subject</code></td><td><code>assertion.sub</code></td></tr><tr><td><code>attribute.gitlab_project_id</code></td><td><code>assertion.project_id</code></td></tr></tbody></table></li></ol><h2 id=grant-access-to-gcp-iam-principal>Grant access to GCP IAM principal</h2><p>After setting up WIF, you must grant the WIF principal access to the secrets in Secret Manager.</p><ol><li><p>In GCP Console, go to <strong>Security > Secret Manager</strong>.</p></li><li><p>Select the name of the secret you wish to grant access to, to view the secret&rsquo;s details.</p></li><li><p>From the <strong>PERMISSIONS</strong> tab, select <strong>GRANT ACCESS</strong> to grant access to the principal set created through the WIF provider.
The external identity format is:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>principalSet://iam.googleapis.com/projects/PROJECT_NUMBER/locations/global/workloadIdentityPools/POOL_ID/attribute.gitlab_project_id/GITLAB_PROJECT_ID</span></span></code></pre></div></div><p>In this example:</p><ul><li><code>PROJECT_NUMBER</code>: Your Google Cloud project number (not ID) which can be found in the
<a href=https://console.cloud.google.com/home/dashboard>Project&rsquo;s dashboard</a>.</li><li><code>POOL_ID</code>: The ID (not name) of the workload identity pool created in the first section,
for example <code>gitlab-pool</code>.</li><li><code>GITLAB_PROJECT_ID</code>: The GitLab project ID found on the <a href=/user/project/working_with_projects/#find-the-project-id>project overview page</a>.</li></ul></li><li><p>Assign the role <strong>Secret Manager Secret Accessor</strong>.</p></li></ol><h2 id=configure-gitlab-cicd-to-use-gcp-secret-manager-secrets>Configure GitLab CI/CD to use GCP Secret Manager secrets</h2><p>You must <a href=/ci/variables/#for-a-project>add these CI/CD variables</a> to provide details about
your GCP Secret Manager:</p><ul><li><code>GCP_PROJECT_NUMBER</code>: The GCP <a href=https://cloud.google.com/resource-manager/docs/creating-managing-projects>Project Number</a>.</li><li><code>GCP_WORKLOAD_IDENTITY_FEDERATION_POOL_ID</code>: The WIF Pool ID, for example <code>gitlab-pool</code>.</li><li><code>GCP_WORKLOAD_IDENTITY_FEDERATION_PROVIDER_ID</code>: The WIF Provider ID, for example <code>gitlab-provider</code>.</li></ul><p>Then you can use secrets stored in GCP Secret Manager in CI/CD jobs by defining them
with the <code>gcp_secret_manager</code> keyword:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job_using_gcp_sm</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>id_tokens</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>GCP_ID_TOKEN</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># `aud` must match the audience defined in the WIF Identity Pool.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>aud</span><span class=p>:</span><span class=w> </span><span class=l>https://iam.googleapis.com/projects/${GCP_PROJECT_NUMBER}/locations/global/workloadIdentityPools/${GCP_WORKLOAD_IDENTITY_FEDERATION_POOL_ID}/providers/${GCP_WORKLOAD_IDENTITY_FEDERATION_PROVIDER_ID}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>secrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>DATABASE_PASSWORD</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>gcp_secret_manager</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-project-secret </span><span class=w> </span><span class=c># This is the name of the secret defined in GCP Secret Manager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>version: 1               # optional</span><span class=p>:</span><span class=w> </span><span class=l>default to `latest`.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>$GCP_ID_TOKEN</span></span></span></code></pre></div></div><h3 id=use-secrets-from-a-different-gcp-project>Use secrets from a different GCP project</h3><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-2 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-2>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-2 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab-runner/-/issues/37487>Introduced</a> in GitLab 17.0.</li></ul></div></div><p>Secret names in GCP are per-project. By default the secret named in <code>gcp_secret_manager:name</code>
is read from the project specified in <code>GCP_PROJECT_NUMBER</code>.</p><p>To read a secret from a different project than the project containing the WIF pool, use the
fully-qualified secret name formatted as <code>projects/&lt;project-number>/secrets/&lt;secret-name></code>.</p><p>For example, if <code>my-project-secret</code> is in the GCP project number <code>123456789</code>,
then you can access the secret with:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job_using_gcp_sm</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># ... as previously configured ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>secrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>DATABASE_PASSWORD</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>gcp_secret_manager</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>projects/123456789/secrets/my-project-secret </span><span class=w> </span><span class=c># fully-qualified name of the secret defined in GCP Secret Manager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>version: 1                                          # optional</span><span class=p>:</span><span class=w> </span><span class=l>defaults to `latest`.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>$GCP_ID_TOKEN</span></span></span></code></pre></div></div><h2 id=troubleshooting>Troubleshooting</h2><h3 id=error-the-size-of-mapped-attribute-googlesubject-exceeds-the-127-bytes-limit>Error: The size of mapped attribute <code>google.subject</code> exceeds the 127 bytes limit</h3><p>Long branch paths can cause a job to fail with this error, because the
<a href=/ci/secrets/id_token_authentication/#token-payload><code>assertion.sub</code> attribute</a> becomes longer than 127 characters:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>ERROR: Job failed (system failure): resolving secrets: failed to exchange sts token: googleapi: got HTTP response code 400 with body:
</span></span><span class=line><span class=cl>{&#34;error&#34;:&#34;invalid_request&#34;,&#34;error_description&#34;:&#34;The size of mapped attribute google.subject exceeds the 127 bytes limit.
</span></span><span class=line><span class=cl>Either modify your attribute mapping or the incoming assertion to produce a mapped attribute that is less than 127 bytes.&#34;}</span></span></code></pre></div></div><p>Long branch paths can be caused by:</p><ul><li>Deeply nested subgroups.</li><li>Long group, repository, or branch names.</li></ul><p>For example, for a <code>gitlab-org/gitlab</code> branch, the payload is <code>project_path:gitlab-org/gitlab:ref_type:branch:ref:{branch_name}</code>.
For the string to remain shorter than 127 characters, the branch name must be 76 characters or fewer.
This limit is imposed by Google Cloud IAM, tracked in <a href="https://issuetracker.google.com/issues/264362370?pli=1">Google issue #264362370</a>.</p><p>The only fix for this issue is to use shorter names
<a href=https://github.com/google-github-actions/auth/blob/main/docs/TROUBLESHOOTING.md#subject-exceeds-the-127-byte-limit>for your branch and repository</a>.</p><h3 id=the-secrets-provider-can-not-be-found-check-your-cicd-variables-and-try-again-message><code>The secrets provider can not be found. Check your CI/CD variables and try again.</code> message</h3><p>You might receive this error when attempting to start a job configured to access GCP Secret Manager:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>The secrets provider can not be found. Check your CI/CD variables and try again.</span></span></code></pre></div></div><p>The job can&rsquo;t be created because one or more of the required variables are not defined:</p><ul><li><code>GCP_PROJECT_NUMBER</code></li><li><code>GCP_WORKLOAD_IDENTITY_FEDERATION_POOL_ID</code></li><li><code>GCP_WORKLOAD_IDENTITY_FEDERATION_PROVIDER_ID</code></li></ul><h3 id=warning-not-resolved-no-resolver-that-can-handle-the-secret-warning><code>WARNING: Not resolved: no resolver that can handle the secret</code> warning</h3><p>The Google Cloud Secret Manager integration requires at least GitLab 16.8 and GitLab Runner 16.8.
This warning appears if the job is executed by a runner using a version earlier than 16.8.</p><p>On GitLab.com, there is a <a href=https://gitlab.com/gitlab-org/ci-cd/shared-runners/infrastructure/-/issues/176>known issue</a>
causing SaaS runners to run an older version. As a workaround until this issue is fixed,
you can register your own GitLab Runner with version 16.8 or later.</p></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/secrets/gcp_secret_manager.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/secrets/gcp_secret_manager.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>