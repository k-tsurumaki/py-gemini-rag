<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>OpenID Connect (OIDC) Authentication Using ID Tokens | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/secrets/id_token_authentication/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage="Software Supply Chain Security" data-group="Pipeline Security"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › Pipeline security"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/pipeline_security/",title:"Pipeline security"},{path:"ci/secrets/id_token_authentication/",title:"ID token authentication"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/secrets/id_token_authentication.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>OpenID Connect (OIDC) Authentication Using ID Tokens</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Free, Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-1 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-1>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-1 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/356986>Introduced</a> in GitLab 15.7.</li></ul></div></div><p>ID tokens are <a href=https://www.rfc-editor.org/rfc/rfc7519>JSON web tokens (JWT)</a> generated by GitLab CI/CD.
CI/CD jobs can use ID tokens for OIDC authentication with third-party services, including:</p><ul><li><a href=/ci/secrets/>Secrets providers</a></li><li><a href=/ci/cloud_services/>Cloud services</a></li></ul><p>For example, the flow for using ID tokens to authenticate with HashiCorp Vault is summarized
by this diagram:</p><pre class=mermaid tabindex=0 data-elastic-exclude>sequenceDiagram
    participant GitLab as GitLab CI/CD
    participant Runner as GitLab Runner
    participant Vault as HashiCorp Vault

    GitLab-&gt;&gt;Runner: Generates an ID token (JWT) for the CI/CD job

    Runner-&gt;&gt;Vault: Runner authenticates with HashiCorp Vault using the token

    Vault-&gt;&gt;Vault: HashiCorp Vault verifies the token

    Vault-&gt;&gt;Vault: HashiCorp Vault checks bounded claims and attaches policies

    Vault-&gt;&gt;Runner: HashiCorp Vault returns the token

    Runner-&gt;&gt;Vault: Runner requests secrets from HashiCorp Vault
    Vault-&gt;&gt;Runner: Returns secrets
</pre><p>ID tokens are also used by the <a href=/ci/yaml/#secrets><code>secrets</code></a> keyword.</p><h2 id=configure-id-tokens-in-a-cicd-job>Configure ID tokens in a CI/CD job</h2><p>To use ID tokens, configure a CI/CD job with the <a href=/ci/yaml/#id_tokens><code>id_tokens</code></a> keyword.</p><p>For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job_with_id_tokens</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>id_tokens</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>FIRST_ID_TOKEN</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>aud</span><span class=p>:</span><span class=w> </span><span class=l>https://first.service.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>SECOND_ID_TOKEN</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>aud</span><span class=p>:</span><span class=w> </span><span class=l>https://second.service.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>first-service-authentication-script.sh $FIRST_ID_TOKEN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>second-service-authentication-script.sh $SECOND_ID_TOKEN</span></span></span></code></pre></div></div><p>In this example, the two tokens have different <code>aud</code> claims. Third party services can be configured to reject tokens
that do not have an <code>aud</code> claim matching their bound audience. Use this functionality to reduce the number of
services with which a token can authenticate. This reduces the severity of having a token compromised.</p><h2 id=token-payload>Token payload</h2><p>The following standard claims are included in each ID token:</p><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td><a href=https://www.rfc-editor.org/rfc/rfc7519.html#section-4.1.1><code>iss</code></a></td><td>Issuer of the token, which is the domain of the GitLab instance (&ldquo;issuer&rdquo; claim).</td></tr><tr><td><a href=https://www.rfc-editor.org/rfc/rfc7519.html#section-4.1.2><code>sub</code></a></td><td>Subject of the token (&ldquo;subject&rdquo; claim). Defaults to <code>project_path:{group}/{project}:ref_type:{type}:ref:{branch_name}</code>. Can be configured for the project with the <a href=/api/projects/#edit-a-project>projects API</a>.</td></tr><tr><td><a href=https://www.rfc-editor.org/rfc/rfc7519.html#section-4.1.3><code>aud</code></a></td><td>Intended audience for the token (&ldquo;audience&rdquo; claim). Specified in the <a href=/ci/secrets/id_token_authentication/#configure-id-tokens-in-a-cicd-job>ID tokens</a> configuration. The domain of the GitLab instance by default.</td></tr><tr><td><a href=https://www.rfc-editor.org/rfc/rfc7519.html#section-4.1.4><code>exp</code></a></td><td>The expiration time (&ldquo;expiration time&rdquo; claim).</td></tr><tr><td><a href=https://www.rfc-editor.org/rfc/rfc7519.html#section-4.1.5><code>nbf</code></a></td><td>The time after which the token becomes valid (&ldquo;not before&rdquo; claim).</td></tr><tr><td><a href=https://www.rfc-editor.org/rfc/rfc7519.html#section-4.1.6><code>iat</code></a></td><td>The time the JWT was issued (&ldquo;issued at&rdquo; claim).</td></tr><tr><td><a href=https://www.rfc-editor.org/rfc/rfc7519.html#section-4.1.7><code>jti</code></a></td><td>Unique identifier for the token (&ldquo;JWT ID&rdquo; claim).</td></tr></tbody></table><p>The token also includes custom claims provided by GitLab:</p><table><thead><tr><th>Field</th><th>When</th><th>Description</th></tr></thead><tbody><tr><td><code>project_id</code></td><td>Always</td><td>ID of the project running the job. In a merge request pipeline, this is the ID of the source project.</td></tr><tr><td><code>project_path</code></td><td>Always</td><td>Path of the project running the job. In a merge request pipeline, this is the path of the source project.</td></tr><tr><td><code>namespace_id</code></td><td>Always</td><td>Namespace ID of the project running the job. In a merge request pipeline, this is the namespace ID of the source project.</td></tr><tr><td><code>namespace_path</code></td><td>Always</td><td>Namespace path of the project running the job. In a merge request pipeline, this is the namespace path of the source project.</td></tr><tr><td><code>user_id</code></td><td>Always</td><td>ID of the user executing the job.</td></tr><tr><td><code>user_login</code></td><td>Always</td><td>Username of the user executing the job.</td></tr><tr><td><code>user_email</code></td><td>Always</td><td>Email of the user executing the job.</td></tr><tr><td><code>user_access_level</code></td><td>Always</td><td>Access level of the user executing the job. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/432052>Introduced</a> in GitLab 16.9.</td></tr><tr><td><code>job_project_id</code></td><td>Always</td><td>ID of the project running the job. Use this to scope to the project by ID. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/563038>Introduced</a> in GitLab 18.4.</td></tr><tr><td><code>job_project_path</code></td><td>Always</td><td>Path of the project running the job. Use this to scope to the project by path. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/563038>Introduced</a> in GitLab 18.4.</td></tr><tr><td><code>job_namespace_id</code></td><td>Always</td><td>Namespace ID of the project running the job. Use this to scope to group or user level namespace by ID. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/563038>Introduced</a> in GitLab 18.4.</td></tr><tr><td><code>job_namespace_path</code></td><td>Always</td><td>Namespace path of the project running the job. Use this to scope to group or user level namespace by path. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/563038>Introduced</a> in GitLab 18.4.</td></tr><tr><td><code>user_identities</code></td><td>User Preference setting</td><td>List of the user&rsquo;s external identities (<a href=https://gitlab.com/gitlab-org/gitlab/-/issues/387537>introduced</a> in GitLab 16.0).</td></tr><tr><td><code>pipeline_id</code></td><td>Always</td><td>ID of the pipeline.</td></tr><tr><td><code>pipeline_source</code></td><td>Always</td><td><a href=/ci/jobs/job_rules/#common-if-clauses-with-predefined-variables>Pipeline source</a>.</td></tr><tr><td><code>job_id</code></td><td>Always</td><td>ID of the job.</td></tr><tr><td><code>ref</code></td><td>Always</td><td>Git ref for the job. In a merge request pipeline, this is the source branch ref.</td></tr><tr><td><code>ref_type</code></td><td>Always</td><td>Git ref type, either <code>branch</code> or <code>tag</code>.</td></tr><tr><td><code>ref_path</code></td><td>Always</td><td>Fully qualified ref for the job. For example, <code>refs/heads/main</code>. In a merge request pipeline, this is the source branch ref path. <a href=https://gitlab.com/gitlab-org/gitlab/-/merge_requests/119075>Introduced</a> in GitLab 16.0.</td></tr><tr><td><code>ref_protected</code></td><td>Always</td><td><code>true</code> if the Git ref is protected, <code>false</code> otherwise.</td></tr><tr><td><code>groups_direct</code></td><td>User is a direct member of 0 to 200 groups</td><td>The paths of the user&rsquo;s direct membership groups. Omitted if the user is a direct member of more than 200 groups. (<a href=https://gitlab.com/gitlab-org/gitlab/-/issues/435848>Introduced</a> in GitLab 16.11 and put behind the <code>ci_jwt_groups_direct</code> <a href=/administration/feature_flags/>feature flag</a> in GitLab 17.3.</td></tr><tr><td><code>environment</code></td><td>Job specifies an environment</td><td>Environment this job deploys to.</td></tr><tr><td><code>environment_protected</code></td><td>Job specifies an environment</td><td><code>true</code> if deployed environment is protected, <code>false</code> otherwise.</td></tr><tr><td><code>deployment_tier</code></td><td>Job specifies an environment</td><td><a href=/ci/environments/#deployment-tier-of-environments>Deployment tier</a> of the environment the job specifies. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/363590>Introduced</a> in GitLab 15.2.</td></tr><tr><td><code>environment_action</code></td><td>Job specifies an environment</td><td><a href=/ci/environments/>Environment action (<code>environment:action</code>)</a> specified in the job. (<a href=https://gitlab.com/gitlab-org/gitlab/-/>Introduced</a> in GitLab 16.5)</td></tr><tr><td><code>runner_id</code></td><td>Always</td><td>ID of the runner executing the job. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/404722>Introduced</a> in GitLab 16.0.</td></tr><tr><td><code>runner_environment</code></td><td>Always</td><td>The type of runner used by the job. Can be either <code>gitlab-hosted</code> or <code>self-hosted</code>. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/404722>Introduced</a> in GitLab 16.0.</td></tr><tr><td><code>sha</code></td><td>Always</td><td>The commit SHA for the job. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/404722>Introduced</a> in GitLab 16.0.</td></tr><tr><td><code>ci_config_ref_uri</code></td><td>Always</td><td>The ref path to the top-level pipeline definition, for example, <code>gitlab.example.com/my-group/my-project//.gitlab-ci.yml@refs/heads/main</code>. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/404722>Introduced</a> in GitLab 16.2. This claim is <code>null</code> unless the pipeline definition is located in the same project.</td></tr><tr><td><code>ci_config_sha</code></td><td>Always</td><td>Git commit SHA for the <code>ci_config_ref_uri</code>. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/404722>Introduced</a> in GitLab 16.2. This claim is <code>null</code> unless the pipeline definition is located in the same project.</td></tr><tr><td><code>project_visibility</code></td><td>Always</td><td>The <a href=/user/public_access/>visibility</a> of the project where the pipeline is running. Can be <code>internal</code>, <code>private</code>, or <code>public</code>. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/418810>Introduced</a> in GitLab 16.3.</td></tr></tbody></table><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=json class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;namespace_id&#34;</span><span class=p>:</span> <span class=s2>&#34;72&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;namespace_path&#34;</span><span class=p>:</span> <span class=s2>&#34;my-group&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;project_id&#34;</span><span class=p>:</span> <span class=s2>&#34;20&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;project_path&#34;</span><span class=p>:</span> <span class=s2>&#34;my-group/my-project&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;user_id&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;user_login&#34;</span><span class=p>:</span> <span class=s2>&#34;sample-user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;user_email&#34;</span><span class=p>:</span> <span class=s2>&#34;sample-user@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;user_identities&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;provider&#34;</span><span class=p>:</span> <span class=s2>&#34;github&#34;</span><span class=p>,</span> <span class=nt>&#34;extern_uid&#34;</span><span class=p>:</span> <span class=s2>&#34;2435223452345&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=nt>&#34;provider&#34;</span><span class=p>:</span> <span class=s2>&#34;bitbucket&#34;</span><span class=p>,</span> <span class=nt>&#34;extern_uid&#34;</span><span class=p>:</span> <span class=s2>&#34;john.smith&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pipeline_id&#34;</span><span class=p>:</span> <span class=s2>&#34;574&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;pipeline_source&#34;</span><span class=p>:</span> <span class=s2>&#34;push&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;job_id&#34;</span><span class=p>:</span> <span class=s2>&#34;302&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=s2>&#34;feature-branch-1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ref_type&#34;</span><span class=p>:</span> <span class=s2>&#34;branch&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ref_path&#34;</span><span class=p>:</span> <span class=s2>&#34;refs/heads/feature-branch-1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ref_protected&#34;</span><span class=p>:</span> <span class=s2>&#34;false&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;groups_direct&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;mygroup/mysubgroup&#34;</span><span class=p>,</span> <span class=s2>&#34;myothergroup/myothersubgroup&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;environment&#34;</span><span class=p>:</span> <span class=s2>&#34;test-environment2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;environment_protected&#34;</span><span class=p>:</span> <span class=s2>&#34;false&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;deployment_tier&#34;</span><span class=p>:</span> <span class=s2>&#34;testing&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;environment_action&#34;</span><span class=p>:</span> <span class=s2>&#34;start&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;runner_id&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;runner_environment&#34;</span><span class=p>:</span> <span class=s2>&#34;self-hosted&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;sha&#34;</span><span class=p>:</span> <span class=s2>&#34;714a629c0b401fdce83e847fc9589983fc6f46bc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;project_visibility&#34;</span><span class=p>:</span> <span class=s2>&#34;public&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ci_config_ref_uri&#34;</span><span class=p>:</span> <span class=s2>&#34;gitlab.example.com/my-group/my-project//.gitlab-ci.yml@refs/heads/main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;ci_config_sha&#34;</span><span class=p>:</span> <span class=s2>&#34;714a629c0b401fdce83e847fc9589983fc6f46bc&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;jti&#34;</span><span class=p>:</span> <span class=s2>&#34;235b3a54-b797-45c7-ae9a-f72d7bc6ef5b&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;iss&#34;</span><span class=p>:</span> <span class=s2>&#34;https://gitlab.example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;iat&#34;</span><span class=p>:</span> <span class=mi>1681395193</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;nbf&#34;</span><span class=p>:</span> <span class=mi>1681395188</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;exp&#34;</span><span class=p>:</span> <span class=mi>1681398793</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;sub&#34;</span><span class=p>:</span> <span class=s2>&#34;project_path:my-group/my-project:ref_type:branch:ref:feature-branch-1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;aud&#34;</span><span class=p>:</span> <span class=s2>&#34;https://vault.example.com&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>The ID token is encoded by using RS256 and signed with a dedicated private key.
The expiry time for the token is set to the job&rsquo;s timeout if specified, or 5 minutes if no timeout is specified.</p><h2 id=troubleshooting>Troubleshooting</h2><h3 id=400-missing-token-status-code><code>400: missing token</code> status code</h3><p>This error indicates that one or more basic components necessary for ID tokens are
either missing or not configured as expected.</p><p>To find the problem, an administrator can look for more details in the instance&rsquo;s
<code>exceptions_json.log</code> for the specific method that failed.</p><h3 id=gitlabcijwtnosigningkeyerror><code>GitLab::Ci::Jwt::NoSigningKeyError</code></h3><p>This error in the <code>exceptions_json.log</code> file is likely because the signing key is
missing from the database and the token could not be generated. To verify this is the issue,
run the following query on the instance&rsquo;s PostgreSQL terminal:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=sql class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>encrypted_ci_jwt_signing_key</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>application_settings</span><span class=p>;</span></span></span></code></pre></div></div><p>If the returned value is empty, use the following Rails snippet to generate a new key
and replace it internally:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=ruby class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl>  <span class=n>key</span> <span class=o>=</span> <span class=no>OpenSSL</span><span class=o>::</span><span class=no>PKey</span><span class=o>::</span><span class=no>RSA</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=mi>2048</span><span class=p>)</span><span class=o>.</span><span class=n>to_pem</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=no>ApplicationSetting</span><span class=o>.</span><span class=n>find_each</span> <span class=k>do</span> <span class=o>|</span><span class=n>application_setting</span><span class=o>|</span>
</span></span><span class=line><span class=cl>    <span class=n>application_setting</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=ss>ci_jwt_signing_key</span><span class=p>:</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span></span></span></code></pre></div></div><h3 id=401-unauthorized-status-code><code>401: unauthorized</code> status code</h3><p>This error indicates that the authentication request failed. When using OpenID Connect (OIDC) authentication from GitLab pipelines to external services, <code>401 Unauthorized</code> errors can occur due to several common reasons:</p><ul><li>You used a deprecated token, such as <code>$CI_JOB_JWT_V2</code>, instead of an <a href=/ci/secrets/id_token_authentication/#configure-id-tokens-in-a-cicd-job>ID token</a>. For more information, see <a href=/update/deprecations/#old-versions-of-json-web-tokens-are-deprecated>old versions of JSON Web Tokens are deprecated</a>.</li><li>You mismatched <code>provider_name</code> values between your <code>.gitlab-ci.yml</code> file and the OIDC Identity Provider configuration on the external service.</li><li>You missed or mismatched the <code>aud</code> (audience) claim between the ID token issued by GitLab and what the external service expects.</li><li>You did not enable or configure the <code>id_tokens:</code> block in the GitLab CI/CD job.</li></ul><p>To resolve the error, decode the token inside your job:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$OIDC_TOKEN</span> <span class=p>|</span> cut -d <span class=s1>&#39;.&#39;</span> -f2 <span class=p>|</span> base64 -d <span class=p>|</span> jq .</span></span></code></pre></div></div><p>Make sure that:</p><ul><li><code>aud</code> (audience) matches the expected audience (for example, the external service&rsquo;s URL).</li><li><code>sub</code> (subject) is mapped in the service&rsquo;s Identity Provider settings.</li><li><code>preferred_username</code> is not present by default in GitLab ID tokens.</li></ul></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/secrets/id_token_authentication.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/secrets/id_token_authentication.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script src=/vite/mermaid.min.js></script><script>document.addEventListener("DOMContentLoaded",()=>{const e=localStorage?.getItem("gitlab-docs-theme")==="dark"?"dark":"neutral";mermaid.initialize({startOnLoad:!0,theme:e})})</script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>