<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Use HashiCorp Vault secrets in GitLab CI/CD | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/secrets/hashicorp_vault/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage="Software Supply Chain Security" data-group="Pipeline Security"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › External secrets"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/secrets/",title:"External secrets"},{path:"ci/secrets/hashicorp_vault/",title:"HashiCorp Vault"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/secrets/hashicorp_vault.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Use HashiCorp Vault secrets in GitLab CI/CD</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>You can use HashiCorp Vault secrets in GitLab CI/CD. Use <a href=/ci/secrets/id_token_authentication/>ID tokens</a>
to <a href=https://developer.hashicorp.com/vault/docs/auth/jwt#jwt-authentication>authenticate with HashiCorp Vault</a>.</p><p>You must configure your Vault server before you can use Vault secrets in a CI/CD job.
The <a href=/ci/secrets/hashicorp_vault_tutorial/>Authenticating and reading secrets with HashiCorp Vault</a>
tutorial has more details about configuring Vault and authenticating with ID tokens.</p><p>In the following examples, replace <code>vault.example.com</code> with the URL of your Vault server,
and <code>gitlab.example.com</code> with the URL of your GitLab instance.</p><h2 id=configure-your-vault-server>Configure your Vault server</h2><p>To configure your Vault server:</p><ol><li><p>Enable the authentication method by running these commands. They provide your Vault
server the <a href=https://openid.net/specs/openid-connect-discovery-1_0.html>OIDC Discovery URL</a>
for your GitLab instance, so Vault can fetch the public signing key and verify
the JSON Web Token (JWT) when authenticating:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ vault auth <span class=nb>enable</span> jwt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ vault write auth/jwt/config <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=nv>oidc_discovery_url</span><span class=o>=</span><span class=s2>&#34;https://gitlab.example.com&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=nv>bound_issuer</span><span class=o>=</span><span class=s2>&#34;gitlab.example.com&#34;</span></span></span></code></pre></div></div></li><li><p>Configure policies on your Vault server to grant or forbid access to certain
paths and operations. This example grants read access to the set of secrets
required by your production environment:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vault policy write myproject-production - <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s># Read-only permission on &#39;ops/data/production/*&#39; path
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>path &#34;ops/data/production/*&#34; {
</span></span></span><span class=line><span class=cl><span class=s>  capabilities = [ &#34;read&#34; ]
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></div></div></li><li><p>Configure <a href=/ci/secrets/hashicorp_vault/#configure-server-roles>roles on your Vault server</a>, restricting roles to a project or namespace.</p></li><li><p>Create the following <a href=/ci/variables/#for-a-project>CI/CD variables</a>
to provide details about your Vault server:</p><ul><li><code>VAULT_SERVER_URL</code>: The URL of your Vault server, such as <code>https://vault.example.com:8200</code>.</li><li><code>VAULT_AUTH_ROLE</code>: Optional. The role to use when attempting to authenticate.
If no role is specified, Vault uses the <a href=https://developer.hashicorp.com/vault/api-docs/auth/jwt#default_role>default role</a>
specified when the authentication method was configured.</li><li><code>VAULT_AUTH_PATH</code>: Optional. The path where the authentication method is mounted, default is <code>jwt</code>.</li><li><code>VAULT_NAMESPACE</code>: Optional. The <a href=https://developer.hashicorp.com/vault/docs/enterprise/namespaces>Vault Enterprise namespace</a>
to use for reading secrets and authentication. With:<ul><li>Vault, the <code>root</code> ("<code>/</code>") namespace is used when no namespace is specified.</li><li>Vault Open source, the setting is ignored.</li><li><a href=https://www.hashicorp.com/cloud>HashiCorp Cloud Platform (HCP)</a> Vault, a namespace
is required. HCP Vault uses the <code>admin</code> namespace as the root namespace by default.
For example, <code>VAULT_NAMESPACE=admin</code>.</li></ul></li></ul></li></ol><h3 id=configure-server-roles>Configure server roles</h3><p>When a CI/CD job attempts to authenticate, it specifies a role. You can use roles to group
different policies together. If authentication is successful, these policies are
attached to the resulting Vault token.</p><p><a href=https://developer.hashicorp.com/vault/docs/auth/jwt#bound-claims>Bound claims</a> are predefined
values that are matched to the JWT claims. With bounded claims, you can restrict access
to specific GitLab users, specific projects, or even jobs running for specific Git
references. You can have as many bounded claims you need, but they must all match
for authentication to be successful.</p><p>Combining bounded claims with GitLab features like <a href=/user/permissions/>user roles</a>
and <a href=/user/project/repository/branches/protected/>protected branches</a>, you can tailor
these rules to fit your specific use case. In this example, authentication is allowed
only for jobs running for protected tags with names matching the pattern used for
production releases:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=json class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>$</span> <span class=err>vault</span> <span class=err>write</span> <span class=err>auth/jwt/role/myproject-production</span> <span class=err>-</span> <span class=err>&lt;&lt;EOF</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;role_type&#34;</span><span class=p>:</span> <span class=s2>&#34;jwt&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;policies&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;myproject-production&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;token_explicit_max_ttl&#34;</span><span class=p>:</span> <span class=mi>60</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;user_claim&#34;</span><span class=p>:</span> <span class=s2>&#34;user_email&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;bound_audiences&#34;</span><span class=p>:</span> <span class=s2>&#34;https://vault.example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;bound_claims_type&#34;</span><span class=p>:</span> <span class=s2>&#34;glob&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;bound_claims&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;project_id&#34;</span><span class=p>:</span> <span class=s2>&#34;42&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref_protected&#34;</span><span class=p>:</span> <span class=s2>&#34;true&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref_type&#34;</span><span class=p>:</span> <span class=s2>&#34;tag&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ref&#34;</span><span class=p>:</span> <span class=s2>&#34;auto-deploy-*&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>EOF</span></span></span></code></pre></div></div><div class="alert alert-type-warning gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>Always restrict your roles to a project or namespace by using one of the provided
claims like <code>project_id</code> or <code>namespace_id</code>. Without these restrictions, any JWT
generated by this GitLab instance may be allowed to authenticate using this role.</p></div></div><p>For a full list of ID token JWT claims, review the
<a href=/ci/secrets/hashicorp_vault_tutorial/>Use HashiCorp Vault secrets in GitLab CI/CD</a> tutorial.</p><p>You can also specify some attributes for the resulting Vault tokens, such as time-to-live,
IP address range, and number of uses. The full list of options is available in
<a href=https://developer.hashicorp.com/vault/api-docs/auth/jwt#create-role>Vault&rsquo;s documentation on creating roles</a>
for the JSON web token method.</p><h2 id=use-vault-secrets-in-a-cicd-job>Use Vault secrets in a CI/CD job</h2><p>When a job has at least one ID token defined, the <a href=/ci/yaml/#secrets><code>secrets</code></a>
keyword automatically uses that token to authenticate with Vault.</p><p>After <a href=/ci/secrets/hashicorp_vault/#configure-your-vault-server>configuring your Vault server</a>, use the <a href=/ci/yaml/#secretsvault><code>secrets:vault</code></a>
keyword to use the secrets stored in Vault:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job_using_vault</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>id_tokens</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>VAULT_ID_TOKEN</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>aud</span><span class=p>:</span><span class=w> </span><span class=l>https://vault.example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>secrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>DATABASE_PASSWORD</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>vault</span><span class=p>:</span><span class=w> </span><span class=l>production/db/password@ops</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>$VAULT_ID_TOKEN</span></span></span></code></pre></div></div><p>In this example:</p><ul><li><code>production/db</code> is the path to the secret.</li><li><code>password</code> is the field.</li><li><code>ops</code> is the path where the secrets engine is mounted.</li><li><code>production/db/password@ops</code> translates to a path of <code>ops/data/production/db</code>.</li><li>Authentication is with <code>$VAULT_ID_TOKEN</code>.</li></ul><p>After GitLab fetches the secret from Vault, the value is saved in a temporary file.
The path to this file is stored in a CI/CD variable named <code>DATABASE_PASSWORD</code>,
similar to <a href=/ci/variables/#use-file-type-cicd-variables>variables of type <code>file</code></a>.</p><p>To overwrite the default behavior, set the <code>file</code> option explicitly:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>secrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>id_tokens</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>VAULT_ID_TOKEN</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>aud</span><span class=p>:</span><span class=w> </span><span class=l>https://vault.example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>DATABASE_PASSWORD</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>vault</span><span class=p>:</span><span class=w> </span><span class=l>production/db/password@ops</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>$VAULT_ID_TOKEN</span></span></span></code></pre></div></div><p>In this example, the secret value is put directly in the <code>DATABASE_PASSWORD</code> variable
instead of pointing to a file that holds it.</p><h2 id=secrets-engines>Secrets engines</h2><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-2 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-2>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-2 class="collapsible-list collapse" aria-hidden=true><ul><li><code>generic</code> option <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/366492>introduced</a> in GitLab Runner 16.11.</li></ul></div></div><p>GitLab Runner supports different secrets engines with the <a href=/ci/yaml/#secretsvault><code>secrets:engine:name</code></a> keyword:</p><table><thead><tr><th>Secrets engine</th><th><code>secrets:engine:name</code> value</th><th>Runner version</th><th>Details</th></tr></thead><tbody><tr><td><a href=https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v2>KV secrets engine - version 2</a></td><td><code>kv-v2</code></td><td>13.4</td><td><code>kv-v2</code> is the default engine GitLab Runner uses when no engine type is explicitly specified.</td></tr><tr><td><a href=https://developer.hashicorp.com/vault/docs/secrets/kv/kv-v1>KV secrets engine - version 1</a></td><td><code>kv-v1</code> or <code>generic</code></td><td>13.4</td><td>Support for the <code>generic</code> keyword <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/366492>introduced</a> in GitLab 15.11.</td></tr><tr><td><a href=https://developer.hashicorp.com/vault/docs/secrets/aws>AWS secrets engine</a></td><td><code>generic</code></td><td>16.11</td><td></td></tr><tr><td><a href=https://jfrog.com/help/r/jfrog-integrations-documentation/hashicorp-vault-artifactory-secrets-plugin>HashiCorp Vault Artifactory Secrets Plugin</a></td><td><code>generic</code></td><td>16.11</td><td>This secrets backend talks to JFrog Artifactory server (5.0.0 or later) and dynamically provisions access tokens with specified scopes.</td></tr></tbody></table><h3 id=use-a-different-secrets-engine>Use a different secrets engine</h3><p>The <code>kv-v2</code> secrets engine is used by default. To use a different engine, add an <code>engine</code> section
under <code>vault</code> in the configuration.</p><p>For example, to set the secret engine and path for Artifactory:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job_using_vault</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>id_tokens</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>VAULT_ID_TOKEN</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>aud</span><span class=p>:</span><span class=w> </span><span class=l>https://vault.example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>secrets</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>JFROG_TOKEN</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>vault</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>engine</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>generic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>artifactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>production/jfrog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>field</span><span class=p>:</span><span class=w> </span><span class=l>access_token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=kc>false</span></span></span></code></pre></div></div><p>In this example, the secret value is obtained from <code>artifactory/production/jfrog</code> with a field of <code>access_token</code>.</p><h2 id=troubleshooting>Troubleshooting</h2><h3 id=self-signed-certificate-error-certificate-signed-by-unknown-authority>Self-signed certificate error: <code>certificate signed by unknown authority</code></h3><p>When the Vault server is using a self-signed certificate, you see the following error in the job logs:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>ERROR: Job failed (system failure): resolving secrets: initializing Vault service: preparing authenticated client: checking Vault server health: Get https://vault.example.com:8000/v1/sys/health?drsecondarycode=299&amp;performancestandbycode=299&amp;sealedcode=299&amp;standbycode=299&amp;uninitcode=299: x509: certificate signed by unknown authority</span></span></code></pre></div></div><p>You have two options to solve this error:</p><ul><li>Add the self-signed certificate to the GitLab Runner server&rsquo;s CA store.
If you deployed GitLab Runner using the <a href=https://docs.gitlab.com/runner/install/kubernetes.html>Helm chart</a>, you have to create your own GitLab Runner image.</li><li>Use the <code>VAULT_CACERT</code> environment variable to configure GitLab Runner to trust the certificate:<ul><li>If you are using systemd to manage GitLab Runner, see <a href=https://docs.gitlab.com/runner/configuration/init.html#setting-custom-environment-variables>how to add an environment variable for GitLab Runner</a>.</li><li>If you deployed GitLab Runner using the <a href=https://docs.gitlab.com/runner/install/kubernetes.html>Helm chart</a>:<ol><li><p><a href=https://docs.gitlab.com/runner/install/kubernetes_helm_chart_configuration.html#access-gitlab-with-a-custom-certificate>Provide a custom certificate for accessing GitLab</a>,
and make sure to add the certificate for the Vault server instead of the certificate for GitLab.
If your GitLab instance is also using a self-signed certificate, you should be able to
add both in the same <code>Secret</code>.</p></li><li><p>Add the following lines in your <code>values.yaml</code> file:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>## Replace both the &lt;SECRET_NAME&gt; and the &lt;VAULT_CERTIFICATE&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>## with the actual values you used to create the secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>certsSecretName</span><span class=p>:</span><span class=w> </span><span class=l>&lt;SECRET_NAME&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>envVars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>VAULT_CACERT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/home/gitlab-runner/.gitlab-runner/certs/&lt;VAULT_CERTIFICATE&gt;&#34;</span></span></span></code></pre></div></div></li></ol></li></ul></li></ul><p>If you are running vault server in development mode locally with <a href=https://gitlab.com/gitlab-org/gitlab-development-kit>GitLab Development Kit (GDK)</a>,
you might also get this error. You can manually ask the system to trust the self signed certificate of Vault server.
This <a href=https://iboysoft.com/tips/how-to-trust-a-certificate-on-mac.html>sample tutorial</a>
explains how to do this on macOS.</p><h3 id=resolving-secrets-secret-not-found-my_secret-error><code>resolving secrets: secret not found: MY_SECRET</code> error</h3><p>When GitLab is unable to find the secret in the vault, you might receive this error:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>ERROR: Job failed (system failure): resolving secrets: secret not found: MY_SECRET</span></span></code></pre></div></div><p>Check that the <code>vault</code> value is <a href=/ci/secrets/hashicorp_vault/#use-vault-secrets-in-a-cicd-job>correctly configured in the CI/CD job</a>.</p><p>You can use the <a href=https://developer.hashicorp.com/vault/docs/commands/kv><code>kv</code> command with the Vault CLI</a>
to check if the secret is retrievable to help determine the syntax for the <code>vault</code>
value in your CI/CD configuration. For example, to retrieve the secret:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ vault kv get -field<span class=o>=</span>password -namespace<span class=o>=</span>admin -mount<span class=o>=</span>ops <span class=s2>&#34;production/db&#34;</span>
</span></span><span class=line><span class=cl>this-is-a-password</span></span></code></pre></div></div></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/secrets/hashicorp_vault.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/secrets/hashicorp_vault.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>