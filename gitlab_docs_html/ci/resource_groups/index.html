<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Resource group | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/resource_groups/><meta name=description content="Control the job concurrency in GitLab CI/CD"><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage=Deploy data-group=Environments><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › Pipelines"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/pipelines/",title:"Pipelines"},{path:"ci/resource_groups/",title:"Pipeline resource groups"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/resource_groups/index.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Resource group</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Free, Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>By default, pipelines in GitLab CI/CD run concurrently. Concurrency is an important factor to improve
the feedback loop in merge requests, however, there are some situations that
you may want to limit the concurrency on deployment
jobs to run them one by one.
Use resource groups to strategically control
the concurrency of the jobs for optimizing your continuous deployments workflow with safety.</p><h2 id=add-a-resource-group>Add a resource group</h2><p>You can add only one resource to a resource group.</p><p>Provided that you have the following pipeline configuration (<code>.gitlab-ci.yml</code> file in your repository):</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Your build script&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Your deployment script&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><p>Every time you push a new commit to a branch, it runs a new pipeline that has
two jobs <code>build</code> and <code>deploy</code>. But if you push multiple commits in a short interval, multiple
pipelines start running simultaneously, for example:</p><ul><li>The first pipeline runs the jobs <code>build</code> -> <code>deploy</code></li><li>The second pipeline runs the jobs <code>build</code> -> <code>deploy</code></li></ul><p>In this case, the <code>deploy</code> jobs across different pipelines could run concurrently
to the <code>production</code> environment. Running multiple deployment scripts to the same
infrastructure could harm/confuse the instance and leave it in a corrupted state in the worst case.</p><p>To ensure that a <code>deploy</code> job runs once at a time, you can specify
<a href=/ci/yaml/#resource_group><code>resource_group</code> keyword</a> to the concurrency sensitive job:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource_group</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><p>With this configuration, the safety on the deployments is assured while you
can still run <code>build</code> jobs concurrently for maximizing the pipeline efficiency.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>Familiarity with <a href=/ci/pipelines/>GitLab CI/CD pipelines</a></li><li>Familiarity with <a href=/ci/environments/>GitLab environments and deployments</a></li><li>At least the Developer role for the project to configure CI/CD pipelines.</li></ul><h2 id=process-modes>Process modes</h2><p>You can select a process mode to control the job concurrency for your deployment preferences.
The following modes are supported:</p><table><thead><tr><th>Process mode</th><th>Description</th><th>When to use</th></tr></thead><tbody><tr><td><code>unordered</code></td><td>The default process mode. Processes jobs whenever a job is ready to run.</td><td>The execution order of jobs is not important. The easiest option to use.</td></tr><tr><td><code>oldest_first</code></td><td>When a resource is free, picks the first job from the list of upcoming jobs sorted by pipeline ID in ascending order.</td><td>You want to execute jobs from the oldest pipeline first. Less efficient than <code>unordered</code> mode, but safer for continuous deployments.</td></tr><tr><td><code>newest_first</code></td><td>When a resource is free, picks the first job from the list of upcoming jobs that are sorted by pipeline ID in descending order.</td><td>You want to execute jobs from the newest pipeline and <a href=/ci/environments/deployment_safety/#prevent-outdated-deployment-jobs>prevent outdated deployment jobs</a>. Each job must be idempotent.</td></tr><tr><td><code>newest_ready_first</code></td><td>When a resource is free, picks the first job from the list of upcoming jobs waiting on this resource. Jobs are sorted by pipeline ID in descending order.</td><td>You want to prevent <code>newest_first</code> from prioritizing new pipelines before deploying the current pipeline. Faster than <code>newest_first</code>. Each job must be idempotent.</td></tr></tbody></table><h3 id=change-the-process-mode>Change the process mode</h3><p>To change the process mode of a resource group, you must use the API and
send a request to <a href=/api/resource_groups/#edit-an-existing-resource-group>edit an existing resource group</a>
by specifying the <code>process_mode</code>:</p><ul><li><code>unordered</code></li><li><code>oldest_first</code></li><li><code>newest_first</code></li><li><code>newest_ready_first</code></li></ul><h3 id=an-example-of-difference-between-the-process-modes>An example of difference between the process modes</h3><p>Consider the following <code>.gitlab-ci.yml</code>, which has a <code>build</code> job and a <code>deploy</code> job.
Each job runs in its own stage, and the <code>deploy</code> job has a resource group set to
<code>production</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Your build script&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Your deployment script&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource_group</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><p>If three commits are pushed to the project in a short interval, that means that three
pipelines run almost at the same time:</p><ul><li>The first pipeline runs the jobs <code>build</code> -> <code>deploy</code>. Let&rsquo;s call this deployment job <code>deploy-1</code>.</li><li>The second pipeline runs the jobs <code>build</code> -> <code>deploy</code>. Let&rsquo;s call this deployment job <code>deploy-2</code>.</li><li>The third pipeline runs the jobs <code>build</code> -> <code>deploy</code>. Let&rsquo;s call this deployment job <code>deploy-3</code>.</li></ul><p>Depending on the process mode of the resource group:</p><ul><li>If the process mode is set to <code>unordered</code>:<ul><li><code>deploy-1</code>, <code>deploy-2</code>, and <code>deploy-3</code> do not run concurrently.</li><li>There is no guarantee on the job execution order, for example, <code>deploy-1</code> could run before or after <code>deploy-3</code> runs.</li></ul></li><li>If the process mode is <code>oldest_first</code>:<ul><li><code>deploy-1</code>, <code>deploy-2</code>, and <code>deploy-3</code> do not run concurrently.</li><li><code>deploy-1</code> runs first, <code>deploy-2</code> runs second, and <code>deploy-3</code> runs last.</li></ul></li><li>If the process mode is <code>newest_first</code>:<ul><li><code>deploy-1</code>, <code>deploy-2</code>, and <code>deploy-3</code> do not run concurrently.</li><li><code>deploy-3</code> runs first, <code>deploy-2</code> runs second and <code>deploy-1</code> runs last.</li></ul></li></ul><h2 id=pipeline-level-concurrency-control-with-cross-projectparent-child-pipelines>Pipeline-level concurrency control with cross-project/parent-child pipelines</h2><p>You can define <code>resource_group</code> for downstream pipelines that are sensitive to concurrent
executions. The <a href=/ci/yaml/#trigger><code>trigger</code> keyword</a> can trigger downstream pipelines and the
<a href=/ci/yaml/#resource_group><code>resource_group</code> keyword</a> can co-exist with it. <code>resource_group</code> is efficient to control the
concurrency of deployment pipelines, while other jobs can continue to run concurrently.</p><p>The following example has two pipeline configurations in a project. When a pipeline starts running,
non-sensitive jobs are executed first and aren&rsquo;t affected by concurrent executions in other
pipelines. However, GitLab ensures that there are no other deployment pipelines running before
triggering a deployment (child) pipeline. If other deployment pipelines are running, GitLab waits
until those pipelines finish before running another one.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># .gitlab-ci.yml (parent pipeline)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Building...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Testing...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>deploy.gitlab-ci.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span><span class=l>mirror</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource_group</span><span class=p>:</span><span class=w> </span><span class=l>AWS-production</span></span></span></code></pre></div></div><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># deploy.gitlab-ci.yml (child pipeline)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>provision</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>provision</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>provision</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Provisioning...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deployment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Deploying...&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><p>You must define <a href=/ci/yaml/#triggerstrategy><code>trigger:strategy</code></a> to ensure
the lock isn&rsquo;t released until the downstream pipeline finishes.</p><h2 id=related-topics>Related topics</h2><ul><li><a href=/api/resource_groups/>API documentation</a></li><li><a href=/administration/logs/#ci_resource_groups_jsonlog>Log documentation</a></li><li><a href=/ci/environments/deployment_safety/>GitLab for safe deployments</a></li></ul><h2 id=troubleshooting>Troubleshooting</h2><h3 id=avoid-dead-locks-in-pipeline-configurations>Avoid dead locks in pipeline configurations</h3><p>Because <a href=/ci/resource_groups/#process-modes><code>oldest_first</code> process mode</a> enforces the jobs to be executed in a pipeline order,
there is a case that it doesn&rsquo;t work well with the other CI features.</p><p>For example, when you run <a href=/ci/pipelines/downstream_pipelines/#parent-child-pipelines>a child pipeline</a>
that requires the same resource group with the parent pipeline,
a dead lock could happen. Here is an example of a bad setup:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># BAD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>child-pipeline-requires-production-resource-group.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span><span class=l>mirror</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource_group</span><span class=p>:</span><span class=w> </span><span class=l>production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><p>In a parent pipeline, it runs the <code>test</code> job that subsequently runs a child pipeline,
and the <a href=/ci/yaml/#triggerstrategy><code>strategy: mirror</code> option</a> makes the <code>test</code> job wait until the child pipeline has finished.
The parent pipeline runs the <code>deploy</code> job in the next stage, that requires a resource from the <code>production</code> resource group.
If the process mode is <code>oldest_first</code>, it executes the jobs from the oldest pipelines, meaning the <code>deploy</code> job is executed next.</p><p>However, a child pipeline also requires a resource from the <code>production</code> resource group.
Because the child pipeline is newer than the parent pipeline, the child pipeline
waits until the <code>deploy</code> job is finished, something that never happens.</p><p>In this case, you should specify the <code>resource_group</code> keyword in the parent pipeline configuration instead:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># GOOD</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>include</span><span class=p>:</span><span class=w> </span><span class=l>child-pipeline.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span><span class=l>mirror</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource_group</span><span class=p>:</span><span class=w> </span><span class=l>production</span><span class=w> </span><span class=c># Specify the resource group in the parent pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resource_group</span><span class=p>:</span><span class=w> </span><span class=l>production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w> </span><span class=l>production</span></span></span></code></pre></div></div><h3 id=jobs-get-stuck-in-waiting-for-resource>Jobs get stuck in <code>Waiting for resource</code></h3><p>Sometimes, a job hangs with the message <code>Waiting for resource: &lt;resource_group></code>. To resolve,
first check that the resource group is working correctly:</p><ol><li><p>Go to the job details page.</p></li><li><p>If the resource is assigned to a job, select <strong>View job currently using resource</strong> and check the job status.</p><ul><li>If the status is <code>running</code> or <code>pending</code>, the feature is working correctly. Wait until the job finishes and releases the resource.</li><li>If the status is <code>created</code> and the <a href=/ci/resource_groups/#process-modes>process mode</a> is either <strong>Oldest first</strong> or <strong>Newest first</strong>, the feature is working correctly.
Visit the pipeline page of the job and check which upstream stage or job is blocking the execution.</li><li>If none of the previous conditions are met, the feature might not be working correctly. <a href=/ci/resource_groups/#report-an-issue>Report the issue to GitLab</a>.</li></ul></li><li><p>If <strong>View job currently using resource</strong> is not available, the resource is not assigned to a job. Instead, check the resource&rsquo;s upcoming jobs.</p><ol><li>Get the resource&rsquo;s upcoming jobs with the <a href=/api/resource_groups/#list-upcoming-jobs-for-a-specific-resource-group>REST API</a>.</li><li>Verify that the resource group&rsquo;s <a href=/ci/resource_groups/#process-modes>process mode</a> is <strong>Oldest first</strong>.</li><li>Find the first job in the list of upcoming jobs, and get the job details <a href=/ci/resource_groups/#get-job-details-through-graphql>with GraphQL</a>.</li><li>If the first job&rsquo;s pipeline is an older pipeline, try to cancel the pipeline or the job itself.</li><li>Optional. Repeat this process if the next upcoming job is still in an older pipeline that should no longer run.</li><li>If the problem persists, <a href=/ci/resource_groups/#report-an-issue>report the issue to GitLab</a>.</li></ol></li></ol><h4 id=race-conditions-in-complex-or-busy-pipelines>Race conditions in complex or busy pipelines</h4><p>If you can&rsquo;t resolve your issue with the solutions above, you might be encountering a known race condition issue. The race condition happens in complex or busy pipelines.
For example, you might encounter the race condition if you have:</p><ul><li>A pipeline with multiple child pipelines.</li><li>A single project with multiple pipelines running simultaneously.</li></ul><p>If you think you are running into this problem, <a href=/ci/resource_groups/#report-an-issue>report the issue to GitLab</a> and leave a comment on <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/436988>issue 436988</a> with a link to your new issue.
To confirm the problem, GitLab might ask for additional details such
as your full pipeline configuration.</p><p>As a temporary workaround, you can:</p><ul><li><p>Start a new pipeline.</p></li><li><p>Re-run a finished job that has the same resource group as the stuck job.</p><p>For example, if you have a <code>setup_job</code> and a <code>deploy_job</code> with the same resource group,
the <code>setup_job</code> might finish while the <code>deploy_job</code> is stuck <code>waiting for resource</code>.
Re-run the <code>setup_job</code> to restart the whole process and allow <code>deploy_job</code> to finish.</p></li></ul><h4 id=get-job-details-through-graphql>Get job details through GraphQL</h4><p>You can get job information from the GraphQL API. You should use the GraphQL API if you use <a href=/ci/resource_groups/#pipeline-level-concurrency-control-with-cross-projectparent-child-pipelines>pipeline-level concurrency control with cross-project/parent-child pipelines</a> because the trigger jobs are not accessible from the UI.</p><p>To get job information from the GraphQL API:</p><ol><li><p>Go to the pipeline details page.</p></li><li><p>Select the <strong>Jobs</strong> tab and find the ID of the stuck job.</p></li><li><p>Go to the <a href=/api/graphql/#interactive-graphql-explorer>interactive GraphQL explorer</a>.</p></li><li><p>Run the following query:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=graphql class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-graphql data-lang=graphql><span class=line><span class=cl><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=py>project</span><span class=p>(</span><span class=py>fullPath</span><span class=p>:</span><span class=w> </span><span class=s>&#34;&lt;fullpath-to-your-project&gt;&#34;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nc>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=py>job</span><span class=p>(</span><span class=py>id</span><span class=p>:</span><span class=w> </span><span class=s>&#34;gid://gitlab/Ci::Build/&lt;job-id&gt;&#34;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nc>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=py>status</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=py>detailedStatus</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=py>action</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=py>path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=py>buttonTitle</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></div><p>The <code>job.detailedStatus.action.path</code> field contains the job ID using the resource.</p></li><li><p>Run the following query and check <code>job.status</code> field according to the criteria above. You can also visit the pipeline page from <code>pipeline.path</code> field.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=graphql class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-graphql data-lang=graphql><span class=line><span class=cl><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=py>project</span><span class=p>(</span><span class=py>fullPath</span><span class=p>:</span><span class=w> </span><span class=s>&#34;&lt;fullpath-to-your-project&gt;&#34;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nc>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=py>job</span><span class=p>(</span><span class=py>id</span><span class=p>:</span><span class=w> </span><span class=s>&#34;gid://gitlab/Ci::Build/&lt;job-id-currently-using-the-resource&gt;&#34;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nc>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=py>status</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=py>pipeline</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=py>path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></div></li></ol><h3 id=report-an-issue>Report an issue</h3><p><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/new>Open a new issue</a> with the following information:</p><ul><li><p>The ID of the affected job.</p></li><li><p>The job status.</p></li><li><p>How often the problem occurs.</p></li><li><p>Steps to reproduce the problem.</p><p>You can also <a href=https://about.gitlab.com/support/#contact-support>contact support</a> for further assistance, or to get in touch with the development team.</p></li></ul></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/resource_groups/_index.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/resource_groups/_index.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>