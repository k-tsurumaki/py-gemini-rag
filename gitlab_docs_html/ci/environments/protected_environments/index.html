<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Protected environments | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/environments/protected_environments/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage=Deploy data-group=Environments><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Deploy and release your application › Environments"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/release_your_application/",title:"Deploy and release your application"},{path:"ci/environments/",title:"Environments"},{path:"ci/environments/protected_environments/",title:"Protected environments"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/environments/protected_environments.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Protected environments</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p><a href=/ci/environments/>Environments</a> can be used for both testing and
production reasons.</p><p>Because deploy jobs can be raised by different users with different roles, it&rsquo;s
important to be able to protect specific environments from the effects of
unauthorized users.</p><p>By default, a protected environment ensures that only people with the
appropriate privileges can deploy to it, keeping the environment safe.</p><div class="alert alert-type-note gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>GitLab administrators can use all environments, including protected environments.</p></div></div><p>To protect, update, or unprotect an environment, you need to have at least the
Maintainer role.</p><h2 id=protecting-environments>Protecting environments</h2><p>Prerequisites:</p><ul><li>When granting the <strong>Allowed to deploy</strong> permission to an approver group, the user configuring the protected environment must be a <strong>direct member</strong> of the approver group to be added. Otherwise, the group or subgroup does not show up in the dropdown list. For more information see <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/345140>issue #345140</a>.</li><li>When granting <strong>Approvers</strong> permissions to an approver group or project, by default only direct members of the approver group or project receive these permissions. To also grant these permissions to inherited members of the approver group or project:<ul><li>Select the <strong>Enable group inheritance</strong> checkbox.</li><li><a href=/api/protected_environments/#group-inheritance-types>Use the API</a>.</li></ul></li></ul><p>To protect an environment:</p><ol><li><p>On the left sidebar, select <strong>Search or go to</strong> and find your project. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</p></li><li><p>Select <strong>Settings</strong> > <strong>CI/CD</strong>.</p></li><li><p>Expand <strong>Protected environments</strong>.</p></li><li><p>Select <strong>Protect an environment</strong>.</p></li><li><p>From the <strong>Environment</strong> list, select the environment you want to protect.</p></li><li><p>In the <strong>Allowed to deploy</strong> list, select the role, users, or groups you
want to give deploy access to. Keep in mind that:</p><ul><li>There are two roles to choose from:<ul><li><strong>Maintainers</strong>: Allows access to all of the project&rsquo;s users with the Maintainer role.</li><li><strong>Developers</strong>: Allows access to all of the project&rsquo;s users with the Maintainer and Developer role.</li></ul></li><li>You can also select groups that are already <a href=/user/project/members/sharing_projects_groups/#invite-a-group-to-a-project>invited</a> to the project. Invited groups added to the project with the Reporter role appear in the dropdown list for <a href=/ci/environments/protected_environments/#deployment-only-access-to-protected-environments>deployment-only access</a>.</li><li>You can also select specific users. The users must have at least the Developer role to appear in
the <strong>Allowed to deploy</strong> list.</li></ul></li><li><p>In the <strong>Approvers</strong> list, select the role, users, or groups you
want to give deploy access to. Keep in mind that:</p><ul><li>There are two roles to choose from:<ul><li><strong>Maintainers</strong>: Allows access to all of the project&rsquo;s users with the Maintainer role.</li><li><strong>Developers</strong>: Allows access to all of the project&rsquo;s users with the Maintainer and Developer role.</li></ul></li><li>You can only select groups that are already <a href=/user/project/members/sharing_projects_groups/#invite-a-group-to-a-project>invited</a> to the project.</li><li>Users must have at least the Developer role to appear in
the <strong>Approvers</strong> list.</li></ul></li><li><p>In the <strong>Approval rules</strong> section:</p><ul><li>Ensure that this number is less than or equal to the number of members in
the rule.</li><li>See <a href=/ci/environments/deployment_approvals/>Deployment Approvals</a> for more information about this feature.</li></ul></li><li><p>Select <strong>Protect</strong>.</p></li></ol><p>The protected environment now appears in the list of protected environments.</p><h3 id=use-the-api-to-protect-an-environment>Use the API to protect an environment</h3><p>Alternatively, you can use the API to protect an environment:</p><ol><li><p>Use a project with a CI that creates an environment. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s1>&#39;echo &#34;Testing Application: ${CI_PROJECT_NAME}&#34;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>production</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>manual</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s1>&#39;echo &#34;Deploying to ${CI_ENVIRONMENT_NAME}&#34;&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>${CI_JOB_NAME}</span></span></span></code></pre></div></div></li><li><p>Use the UI to <a href=/user/group/#create-a-group>create a new group</a>.
For example, this group is called <code>protected-access-group</code> and has the group ID <code>9899826</code>. Note
that the rest of the examples in these steps use this group.</p><p><a href=/ci/environments/img/protected_access_group_v13_6.png target=_blank rel="noopener noreferrer"><img alt="Protected access group interface with the New project button highlighted." height=268 src=/ci/environments/img/protected_access_group_v13_6.png width=1089></a></p></li><li><p>Use the API to add a user to the group as a reporter:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ curl --request POST --header <span class=s2>&#34;PRIVATE-TOKEN: &lt;your_access_token&gt;&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>       --data <span class=s2>&#34;user_id=3222377&amp;access_level=20&#34;</span> <span class=s2>&#34;https://gitlab.com/api/v4/groups/9899826/members&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;id&#34;</span>:3222377,<span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;Sean Carroll&#34;</span>,<span class=s2>&#34;username&#34;</span>:<span class=s2>&#34;sfcarroll&#34;</span>,<span class=s2>&#34;state&#34;</span>:<span class=s2>&#34;active&#34;</span>,<span class=s2>&#34;avatar_url&#34;</span>:<span class=s2>&#34;https://gitlab.com/uploads/-/system/user/avatar/3222377/avatar.png&#34;</span>,<span class=s2>&#34;web_url&#34;</span>:<span class=s2>&#34;https://gitlab.com/sfcarroll&#34;</span>,<span class=s2>&#34;access_level&#34;</span>:20,<span class=s2>&#34;created_at&#34;</span>:<span class=s2>&#34;2020-10-26T17:37:50.309Z&#34;</span>,<span class=s2>&#34;expires_at&#34;</span>:null<span class=o>}</span></span></span></code></pre></div></div></li><li><p>Use the API to add the group to the project as a reporter:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ curl --request POST --header <span class=s2>&#34;PRIVATE-TOKEN: &lt;your_access_token&gt;&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>       --request POST <span class=s2>&#34;https://gitlab.com/api/v4/projects/22034114/share?group_id=9899826&amp;group_access=20&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;id&#34;</span>:1233335,<span class=s2>&#34;project_id&#34;</span>:22034114,<span class=s2>&#34;group_id&#34;</span>:9899826,<span class=s2>&#34;group_access&#34;</span>:20,<span class=s2>&#34;expires_at&#34;</span>:null<span class=o>}</span></span></span></code></pre></div></div></li><li><p>Use the API to add the group with protected environment access:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl --header <span class=s1>&#39;Content-Type: application/json&#39;</span> --request POST --data <span class=s1>&#39;{&#34;name&#34;: &#34;production&#34;, &#34;deploy_access_levels&#34;: [{&#34;group_id&#34;: 9899826}]}&#39;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     --header <span class=s2>&#34;PRIVATE-TOKEN: &lt;your_access_token&gt;&#34;</span> <span class=s2>&#34;https://gitlab.com/api/v4/projects/22034114/protected_environments&#34;</span></span></span></code></pre></div></div></li></ol><p>The group now has access and can be seen in the UI.</p><h2 id=environment-access-by-group-membership>Environment access by group membership</h2><p>A user may be granted access to protected environments as part of <a href=/user/group/>group membership</a>. Users
with the Reporter role can only be granted access to protected environments with this
method.</p><h2 id=deployment-branch-access>Deployment branch access</h2><p>Users with the Developer role can be granted
access to a protected environment through any of these methods:</p><ul><li>As an individual contributor, through a role.</li><li>Through a group membership.</li></ul><p>If the user also has push or merge access to the branch deployed on production,
they have the following privileges:</p><ul><li><a href=/ci/environments/#stopping-an-environment>Stop an environment</a>.</li><li><a href=/ci/environments/#delete-an-environment>Delete an environment</a>.</li><li><a href=/ci/environments/#web-terminals-deprecated>Create an environment terminal</a>.</li></ul><h2 id=deployment-only-access-to-protected-environments>Deployment-only access to protected environments</h2><p>Users granted access to a protected environment, but not push or merge access
to the branch deployed to it, are only granted access to deploy the environment.
<a href=/user/project/members/sharing_projects_groups/#invite-a-group-to-a-project>Invited groups</a> added
to the project with <a href=/user/permissions/#project-members-permissions>Reporter role</a>, appear in the dropdown list for deployment-only access.</p><p>To add deployment-only access:</p><ol><li>Create a group with members who are granted to access to the protected environment, if it doesn&rsquo;t exist yet.</li><li><a href=/user/project/members/sharing_projects_groups/#invite-a-group-to-a-project>Invite the group</a> to the project with the Reporter role.</li><li>Follow the steps in <a href=/ci/environments/protected_environments/#protecting-environments>Protecting Environments</a>.</li></ol><h2 id=modifying-and-unprotecting-environments>Modifying and unprotecting environments</h2><p>Maintainers can:</p><ul><li>Update existing protected environments at any time by changing the access in the
<strong>Allowed to Deploy</strong> dropdown list.</li><li>Unprotect a protected environment by selecting the <strong>Unprotect</strong> button for that environment.</li></ul><p>After an environment is unprotected, all access entries are deleted and must
be re-entered if the environment is re-protected.</p><p>After an approval rule is deleted, previously approved deployments do not show who approved the deployment.
Information on who approved a deployment is still available in the <a href=/user/compliance/audit_events/#project-audit-events>project audit events</a>.
If a new rule is added, previous deployments show the new rules without the option to approve the deployment. <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/506687>Issue 506687</a> proposes to show the full approval history of deployments, even if an approval rule is deleted.</p><p>For more information, see <a href=/ci/environments/deployment_safety/>Deployment safety</a>.</p><h2 id=group-level-protected-environments>Group-level protected environments</h2><p>Typically, large enterprise organizations have an explicit permission boundary
between <a href=https://about.gitlab.com/topics/devops/>developers and operators</a>.
Developers build and test their code, and operators deploy and monitor the
application. With group-level protected environments, operators can
restrict access to critical environments from developers. Group-level protected environments
extend the <a href=/ci/environments/protected_environments/#protecting-environments>project-level protected environments</a>
to the group-level.</p><p>The permissions of deployments can be illustrated in the following table:</p><table><thead><tr><th>Environment</th><th>Developer</th><th>Operator</th><th>Category</th></tr></thead><tbody><tr><td>Development</td><td>Allowed</td><td>Allowed</td><td>Lower environment</td></tr><tr><td>Testing</td><td>Allowed</td><td>Allowed</td><td>Lower environment</td></tr><tr><td>Staging</td><td>Disallowed</td><td>Allowed</td><td>Higher environment</td></tr><tr><td>Production</td><td>Disallowed</td><td>Allowed</td><td>Higher environment</td></tr></tbody></table><p><em>(Reference: <a href=https://en.wikipedia.org/wiki/Deployment_environment>Deployment environments on Wikipedia</a>)</em></p><h3 id=group-level-protected-environments-names>Group-level protected environments names</h3><p>Contrary to project-level protected environments, group-level protected
environments use the <a href=/ci/environments/#deployment-tier-of-environments>deployment tier</a>
as their name.</p><p>A group may consist of many project environments that have unique names.
For example, Project-A has a <code>gprd</code> environment and Project-B has a <code>Production</code>
environment, so protecting a specific environment name doesn&rsquo;t scale well.
By using deployment tiers, both are recognized as <code>production</code> deployment tier
and are protected at the same time.</p><h3 id=configure-group-level-memberships>Configure group-level memberships</h3><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-2 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-2>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-2 class="collapsible-list collapse" aria-hidden=true><ul><li>Operators are required to have Owner+ role from the original Maintainer+ role and this role change is introduced from GitLab 15.3 <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/369873>with a flag</a> named <code>group_level_protected_environment_settings_permission</code>. Enabled by default.</li><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/369873>Feature flag removed</a> in GitLab 15.4.</li></ul></div></div><p>To maximize the effectiveness of group-level protected environments,
<a href=/user/group/>group-level memberships</a> must be correctly
configured:</p><ul><li>Operators should be given the Owner role
for the top-level group. They can maintain CI/CD configurations for
the higher environments (such as production) in the group-level settings page,
which includes group-level protected environments,
<a href=/ci/runners/runners_scope/#group-runners>group-level runners</a>, and
<a href=/user/group/clusters/>group-level clusters</a>. Those
configurations are inherited to the child projects as read-only entries.
This ensures that only operators can configure the organization-wide
deployment ruleset.</li><li>Developers should be given no more than the Developer role
for the top-level group, or explicitly given the Owner role for a child project.
They do not have access to the CI/CD configurations in the
top-level group, so operators can ensure that the critical configuration won&rsquo;t
be accidentally changed by the developers.</li><li>For subgroups and child projects:<ul><li>Regarding <a href=/user/group/subgroups/>subgroups</a>, if a higher
group has configured the group-level protected environment, the lower groups
cannot override it.</li><li><a href=/ci/environments/protected_environments/#protecting-environments>Project-level protected environments</a> can be
combined with the group-level setting. If both group-level and project-level
environment configurations exist, to run a deployment job, the user must be allowed in <strong>both</strong>
rulesets.</li><li>In a project or a subgroup of the top-level group, developers can be
safely assigned the Maintainer role to tune their lower environments (such
as <code>testing</code>).</li></ul></li></ul><p>Having this configuration in place:</p><ul><li>If a user is about to run a deployment job in a project and allowed to deploy
to the environment, the deployment job proceeds.</li><li>If a user is about to run a deployment job in a project but disallowed to
deploy to the environment, the deployment job fails with an error message.</li></ul><h3 id=protect-critical-environments-under-a-group>Protect critical environments under a group</h3><p>To protect a group-level environment, make sure your environments have the correct
<a href=/ci/environments/#deployment-tier-of-environments><code>deployment_tier</code></a> defined in <code>.gitlab-ci.yml</code>.</p><h4 id=using-the-ui>Using the UI</h4><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-3 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-3>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-3 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/325249>Introduced</a> in GitLab 15.1.</li></ul></div></div><ol><li>On the left sidebar, select <strong>Search or go to</strong> and find your group. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</li><li>Select <strong>Settings</strong> > <strong>CI/CD</strong>.</li><li>Expand <strong>Protected environments</strong>.</li><li>From the <strong>Environment</strong> list, select the <a href=/ci/environments/#deployment-tier-of-environments>deployment tier of environments</a> you want to protect.</li><li>In the <strong>Allowed to deploy</strong> list, select the <a href=/user/group/subgroups/>subgroups</a> you want to give deploy access to.</li><li>Select <strong>Protect</strong>.</li></ol><h4 id=using-the-api>Using the API</h4><p>Configure the group-level protected environments by using the <a href=/api/group_protected_environments/>REST API</a>.</p><h2 id=deployment-approvals>Deployment approvals</h2><p>Protected environments can also be used to require manual approvals before deployments. See <a href=/ci/environments/deployment_approvals/>Deployment approvals</a> for more information.</p><h2 id=troubleshooting>Troubleshooting</h2><h3 id=reporter-cant-run-a-trigger-job-that-deploys-to-a-protected-environment-in-downstream-pipeline>Reporter can&rsquo;t run a trigger job that deploys to a protected environment in downstream pipeline</h3><p>A user who has <a href=/ci/environments/protected_environments/#deployment-only-access-to-protected-environments>deployment-only access to protected environments</a> might <strong>not</strong> be able to run a job if it&rsquo;s with a <a href=/ci/yaml/#trigger><code>trigger</code></a> keyword. This is because the job is missing the <a href=/ci/yaml/#environment><code>environment</code></a> keyword definition to associate the job with the protected environment, therefore the job is recognized as a standard job that uses <a href=/user/permissions/#cicd>regular CI/CD permission model</a>.</p><p>See <a href=https://gitlab.com/groups/gitlab-org/-/epics/8483>this issue</a> for more information about supporting <code>environment</code> keyword with <code>trigger</code> keyword.</p></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/environments/protected_environments.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/environments/protected_environments.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>