<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Services | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/services/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage=Verify data-group="Runner Core"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › Jobs"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/jobs/",title:"Jobs"},{path:"ci/services/",title:"Services"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/services/index.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Services</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Free, Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>When you configure CI/CD, you specify an image, which is used to create the container
where your jobs run. To specify this image, you use the <code>image</code> keyword.</p><p>You can specify an additional image by using the <code>services</code> keyword. This additional
image is used to create another container, which is available to the first container.
The two containers have access to one another and can communicate when running the job.</p><p>The service image can run any application, but the most common use
case is to run a database container, for example:</p><ul><li><a href=/ci/services/mysql/>MySQL</a></li><li><a href=/ci/services/postgres/>PostgreSQL</a></li><li><a href=/ci/services/redis/>Redis</a></li><li><a href=/ci/services/gitlab/>GitLab</a> as an example for a microservice offering a JSON API</li></ul><p>Consider that you&rsquo;re developing a content management system that uses database for storage.
You need a database to test all features in the application. Running a database
container as a service image is a good use case in this scenario.</p><p>Use an existing image and run it as an additional container
instead of installing <code>mysql</code> every time you build a project.</p><p>You&rsquo;re not limited to only database services. You can add as many
services you need to <code>.gitlab-ci.yml</code> or manually modify the <a href=https://docs.gitlab.com/runner/configuration/advanced-configuration.html><code>config.toml</code></a>.
Any image found at <a href=https://hub.docker.com/>Docker Hub</a> or your private container registry can be
used as a service.</p><p>For information about using private images, see <a href=/ci/docker/using_docker_images/#access-an-image-from-a-private-container-registry>Access an image from a private container registry</a>.</p><p>Services inherit the same DNS servers, search domains, and additional hosts as
the CI container itself.</p><h2 id=how-services-are-linked-to-the-job>How services are linked to the job</h2><p>To better understand how container linking works, read
<a href=https://docs.docker.com/network/links/>Linking containers together</a>.</p><p>If you add <code>mysql</code> as service to your application, the image is
used to create a container that&rsquo;s linked to the job container.</p><p>The service container for MySQL is accessible under the hostname <code>mysql</code>.
To access your database service, connect to the host named <code>mysql</code> instead of a
socket or <code>localhost</code>. Read more in <a href=/ci/services/#accessing-the-services>accessing the services</a>.</p><h2 id=how-the-health-check-of-services-works>How the health check of services works</h2><p>Services are designed to provide additional features which are <strong>network accessible</strong>.
They may be a database like MySQL, or Redis, and even <code>docker:dind</code> which
allows you to use Docker-in-Docker (DinD). It can be practically anything that&rsquo;s
required for the CI/CD job to proceed, and is accessed by network.</p><p>To make sure this works, the runner:</p><ol><li>Checks which ports are exposed from the container by default.</li><li>Starts a special container that waits for these ports to be accessible.</li></ol><p>If the second stage of the check fails, it prints the warning: <code>*** WARNING: Service XYZ probably didn't start properly</code>.
This issue can occur because:</p><ul><li>There is no opened port in the service.</li><li>The service was not started properly before the timeout, and the port is not
responding.</li></ul><p>In most cases it affects the job, but there may be situations when the job
still succeeds even if that warning was printed. For example:</p><ul><li>The service was started shortly after the warning was raised, and the job is
not using the linked service from the beginning. In that case, when the
job needed to access the service, it may have been already there waiting for
connections.</li><li>The service container is not providing any networking service, but it&rsquo;s doing
something with the job&rsquo;s directory (all services have the job directory mounted
as a volume under <code>/builds</code>). In that case, the service does its job, and
because the job is not trying to connect to it, it does not fail.</li></ul><p>If the services start successfully, they start before the
<a href=/ci/yaml/#before_script><code>before_script</code></a> runs. This means you can
write a <code>before_script</code> that queries the service.</p><p>Services stop at the end of the job, even if the job fails.</p><h2 id=using-software-provided-by-a-service-image>Using software provided by a service image</h2><p>When you specify the <code>service</code>, this provides <strong>network accessible</strong>
services. A database is the simplest example of such a service.</p><p>The services feature does not add any software from the
defined <code>services</code> images to the job&rsquo;s container.</p><p>For example, if you have the following <code>services</code> defined in your job, the <code>php</code>,
<code>node</code> or <code>go</code> commands are <strong>not</strong> available for your script, and the job fails:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>php:7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>node:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>golang:1.10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine:3.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>php -v</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>node -v</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>go version</span></span></span></code></pre></div></div><p>If you need to have <code>php</code>, <code>node</code> and <code>go</code> available for your script, you should
either:</p><ul><li>Choose an existing Docker image that contains all required tools.</li><li>Create your own Docker image, with all the required tools included,
and use that in your job.</li></ul><h2 id=define-services-in-the-gitlab-ciyml-file>Define <code>services</code> in the <code>.gitlab-ci.yml</code> file</h2><p>It&rsquo;s also possible to define different images and services per job:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test:2.6</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ruby:2.6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>postgres:11.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle exec rake spec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test:2.7</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ruby:2.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>postgres:12.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle exec rake spec</span></span></span></code></pre></div></div><p>Or you can pass some <a href=/ci/docker/using_docker_images/#extended-docker-configuration-options>extended configuration options</a>
for <code>image</code> and <code>services</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ruby:2.6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>entrypoint</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/bash&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-postgres:11.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>db,postgres,pg</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>entrypoint</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/usr/local/bin/db-postgres&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;start&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle exec rake spec</span></span></span></code></pre></div></div><h2 id=accessing-the-services>Accessing the services</h2><p>If you need a Wordpress instance to test API integration with
your application, you can use the
<a href=https://hub.docker.com/r/tutum/wordpress/><code>tutum/wordpress</code></a> image in your
<code>.gitlab-ci.yml</code> file:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>tutum/wordpress:latest</span></span></span></code></pre></div></div><p>If you don&rsquo;t <a href=/ci/services/#available-settings-for-services>specify a service alias</a>,
when the job runs, <code>tutum/wordpress</code> is started. You have
access to it from your build container under two hostnames:</p><ul><li><code>tutum-wordpress</code></li><li><code>tutum__wordpress</code></li></ul><p>Hostnames with underscores are not RFC valid and may cause problems in third-party
applications.</p><p>The default aliases for the service&rsquo;s hostname are created from its image name
following these rules:</p><ul><li>Everything after the colon (<code>:</code>) is stripped.</li><li>Slash (<code>/</code>) is replaced with double underscores (<code>__</code>) and the primary alias
is created.</li><li>Slash (<code>/</code>) is replaced with a single dash (<code>-</code>) and the secondary alias is
created.</li></ul><p>To override the default behavior, you can
<a href=/ci/services/#available-settings-for-services>specify one or more service aliases</a>.</p><h3 id=connecting-services>Connecting services</h3><p>You can use inter-dependent services with complex jobs, like end-to-end tests where an
external API needs to communicate with its own database.</p><p>For example, for an end-to-end test for a front-end application that uses an API, and where the API needs a database:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>end-to-end-tests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>selenium/standalone-firefox:${FIREFOX_VERSION}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>firefox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>registry.gitlab.com/organization/private-api:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>backend-api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres:16.10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>db postgres db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>FF_NETWORK_PER_BUILD</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>supersecretpassword</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>BACKEND_POSTGRES_HOST</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm test</span></span></span></code></pre></div></div><p>For this solution to work, you must use
<a href=https://docs.gitlab.com/runner/executors/docker.html#create-a-network-for-each-job>the networking mode that creates a new network for each job</a>.</p><h2 id=passing-cicd-variables-to-services>Passing CI/CD variables to services</h2><p>You can also pass custom CI/CD <a href=/ci/variables/>variables</a>
to fine tune your Docker <code>images</code> and <code>services</code> directly in the <code>.gitlab-ci.yml</code> file.
For more information, read about <a href=/ci/variables/#define-a-cicd-variable-in-the-gitlab-ciyml-file><code>.gitlab-ci.yml</code> defined variables</a>.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># The following variables are automatically passed down to the Postgres container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># as well as the Ruby container and available within each.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>HTTPS_PROXY</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://10.1.1.1:8090&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>HTTP_PROXY</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://10.1.1.1:8090&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;my_custom_db&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;postgres&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;example&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PGDATA</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/var/lib/postgresql/data&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>POSTGRES_INITDB_ARGS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;--encoding=UTF8 --data-checksums&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>postgres:11.7</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>entrypoint</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;docker-entrypoint.sh&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;postgres&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ruby:2.6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>entrypoint</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/bin/bash&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle exec rake spec</span></span></span></code></pre></div></div><h2 id=available-settings-for-services>Available settings for <code>services</code></h2><table><thead><tr><th>Setting</th><th>Required</th><th>GitLab version</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>yes, when used with any other option</td><td>9.4</td><td>Full name of the image to use. If the full image name includes a registry hostname, use the <code>alias</code> option to define a shorter service access name. For more information, see <a href=/ci/services/#accessing-the-services>Accessing the services</a>.</td></tr><tr><td><code>entrypoint</code></td><td>no</td><td>9.4</td><td>Command or script to execute as the container&rsquo;s entrypoint. It&rsquo;s translated to the Docker <code>--entrypoint</code> option while creating the container. The syntax is similar to the <a href=https://docs.docker.com/reference/dockerfile/#entrypoint>Dockerfile <code>ENTRYPOINT</code></a> directive, where each shell token is a separate string in the array.</td></tr><tr><td><code>command</code></td><td>no</td><td>9.4</td><td>Command or script that should be used as the container&rsquo;s command. It&rsquo;s translated to arguments passed to Docker after the image&rsquo;s name. The syntax is similar to the <a href=https://docs.docker.com/reference/dockerfile/#cmd>Dockerfile <code>CMD</code></a> directive, where each shell token is a separate string in the array.</td></tr><tr><td><code>alias</code></td><td>no</td><td>9.4</td><td>Additional aliases to access the service from the job&rsquo;s container. Multiple aliases can be separated by spaces or commas. For more information, see <a href=/ci/services/#accessing-the-services>Accessing the services</a>. Using alias as a container name for the Kubernetes executor was <a href=https://gitlab.com/gitlab-org/gitlab/-/issues/421131>introduced</a> in GitLab Runner 17.9. For more information, see <a href=/ci/services/#using-aliases-as-service-container-names-for-the-kubernetes-executor>Configuring the service containers name with the Kubernetes executor</a>.</td></tr><tr><td><code>variables</code></td><td>no</td><td>14.5</td><td>Additional environment variables that are passed exclusively to the service. The syntax is the same as <a href=/ci/variables/>Job Variables</a>. Service variables cannot reference themselves.</td></tr><tr><td><code>pull_policy</code></td><td>no</td><td>15.1</td><td>Specify how the runner pulls Docker images when it executes a job. Valid values are <code>always</code>, <code>if-not-present</code>, and <code>never</code>. Default is <code>always</code>. For more information, see <a href=/ci/yaml/#servicespull_policy><code>services:pull_policy</code></a>.</td></tr></tbody></table><h2 id=starting-multiple-services-from-the-same-image>Starting multiple services from the same image</h2><p>Before the new extended Docker configuration options, the following configuration
would not work properly:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>mysql:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>mysql:latest</span></span></span></code></pre></div></div><p>The runner would start two containers, each that uses the <code>mysql:latest</code> image.
However, both of them would be added to the job&rsquo;s container with the <code>mysql</code> alias, based on
the <a href=/ci/services/#accessing-the-services>default hostname naming</a>. This would end with one
of the services not being accessible.</p><p>After the new extended Docker configuration options, the previous example would
look like this:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>mysql-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>mysql-2</span></span></span></code></pre></div></div><p>The runner still starts two containers using the <code>mysql:latest</code> image,
however now each of them are also accessible with the alias configured
in <code>.gitlab-ci.yml</code> file.</p><h2 id=setting-a-command-for-the-service>Setting a command for the service</h2><p>Let&rsquo;s assume you have a <code>super/sql:latest</code> image with some SQL database
in it. You would like to use it as a service for your job. Let&rsquo;s also
assume that this image does not start the database process while starting
the container. The user needs to manually use <code>/usr/bin/super-sql run</code> as
a command to start the database.</p><p>Before the new extended Docker configuration options, you would need to:</p><ul><li><p>Create your own image based on the <code>super/sql:latest</code> image.</p></li><li><p>Add the default command.</p></li><li><p>Use the image in the job&rsquo;s configuration.</p><ul><li><p><code>my-super-sql:latest</code> image&rsquo;s Dockerfile:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=dockerfile class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=w> </span><span class=s>super/sql:latest</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;/usr/bin/super-sql&#34;</span><span class=p>,</span> <span class=s2>&#34;run&#34;</span><span class=p>]</span></span></span></code></pre></div></div></li><li><p>In the job in the <code>.gitlab-ci.yml</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>my-super-sql:latest</span></span></span></code></pre></div></div></li></ul></li></ul><p>After the new extended Docker configuration options, you can
set a <code>command</code> in the <code>.gitlab-ci.yml</code> file instead:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>super/sql:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;/usr/bin/super-sql&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;run&#34;</span><span class=p>]</span></span></span></code></pre></div></div><p>The syntax of <code>command</code> is similar to <a href=https://docs.docker.com/reference/dockerfile/#cmd>Dockerfile <code>CMD</code></a>.</p><h2 id=using-aliases-as-service-container-names-for-the-kubernetes-executor>Using aliases as service container names for the Kubernetes executor</h2><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-1 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-1>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-1 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/421131>Introduced</a> in GitLab and GitLab Runner 17.9.</li></ul></div></div><p>You can use service aliases as service container names for the Kubernetes executor.
GitLab Runner names containers based on the following conditions:</p><ul><li>When multiple aliases are set for a service, the service container is named after the first alias that:<ul><li>Isn&rsquo;t already used by another service container.</li><li>Follows the <a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names>Kubernetes constraints for label names</a>.</li></ul></li><li>When aliases can&rsquo;t be used to name a service container, GitLab Runner falls back to the <code>svc-i</code> pattern.</li></ul><p>The following examples illustrate how aliases are used to name service containers for the Kubernetes executor.</p><h3 id=one-alias-per-services>One alias per services</h3><p>In the following <code>.gitlab-ci.yml</code> file:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sleep 10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span></span></span></code></pre></div></div><p>The system creates job Pod with containers named <code>alpine</code> and <code>mysql</code> in addition to the standard <code>build</code> and <code>helper</code> containers.
These aliases are used because they:</p><ul><li>Are not used by another service container.</li><li>Follow the <a href=https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names>Kubernetes constraints for label names</a>.</li></ul><p>However, in the following <code>.gitlab-ci.yml</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sleep 10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql:lts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysql:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>mysql</span></span></span></code></pre></div></div><p>The system creates two more containers named <code>mysql</code> and <code>svc-0</code> in addition to the <code>build</code> and <code>helper</code> containers.
The <code>mysql</code> container corresponds to the <code>mysql:lts</code> image, while the <code>svc-0</code> container corresponds to the <code>mysql:latest</code> image.</p><h3 id=multiple-aliases-per-services>Multiple aliases per services</h3><p>In the following <code>.gitlab-ci.yml</code> file:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sleep 10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>alpine,alpine-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine:edge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>alpine,alpine-edge,alpine-latest</span></span></span></code></pre></div></div><p>The system creates four more containers in addition to the <code>build</code> and <code>helper</code> containers:</p><ul><li><code>alpine</code> which should correspond to the container with the <code>alpine:latest</code> image.</li><li><code>alpine-edge</code> which should correspond to the container with the <code>alpine:edge</code> image (<code>alpine</code> alias being already used for the previous container).</li></ul><p>In this example, the alias <code>alpine-latest</code> is not being used.</p><p>However, in the following <code>.gitlab-ci.yml</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sleep 10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>alpine,alpine-edge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine:edge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>alpine,alpine-edge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine:3.21</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>alias</span><span class=p>:</span><span class=w> </span><span class=l>alpine,alpine-edge</span></span></span></code></pre></div></div><p>In addition to the <code>build</code> and <code>helper</code> containers, six more containers are created.</p><ul><li><p><code>alpine</code> should refer to the container with the <code>alpine:latest</code> image.</p></li><li><p><code>alpine-edge</code> should refer to the container with the <code>alpine:edge</code> image (<code>alpine</code> alias being
already used for the previous container).</p></li><li><p><code>svc-0</code> should refer to the container with the <code>alpine:3.21</code> image (<code>alpine</code> and <code>alpine-edge</code>
aliases being already used for the previous containers).</p><ul><li><p>The <code>i</code> in the <code>svc-i</code> pattern does not indicate the service&rsquo;s position in the provided list.
Instead, it represents the service&rsquo;s position when no available alias is found.</p></li><li><p>When an invalid alias is provided (doesn&rsquo;t meet Kubernetes constraint), the job fails with the
following error (example with the alias <code>alpine_edge</code>). This failure occurs because aliases are
also used to create local DNS entries on the job Pod.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=plaintext class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>ERROR: Job failed (system failure): prepare environment: setting up build pod: provided host alias
</span></span><span class=line><span class=cl>alpine_edge for service alpine:edge is invalid DNS. a lowercase RFC 1123 subdomain must consist of lower
</span></span><span class=line><span class=cl>case alphanumeric characters, &#39;-&#39; or &#39;.&#39;, and must start and end with an alphanumeric character (e.g.
</span></span><span class=line><span class=cl>&#39;example.com&#39;, regex used for validation is &#39;[a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*&#39;).
</span></span><span class=line><span class=cl>Check https://docs.gitlab.com/runner/shells/index.html#shell-profile-loading for more information.</span></span></code></pre></div></div></li></ul></li></ul><h2 id=using-services-with-docker-run-docker-in-docker-side-by-side>Using <code>services</code> with <code>docker run</code> (Docker-in-Docker) side-by-side</h2><p>Containers started with <code>docker run</code> can also connect to services provided by GitLab.</p><p>If booting a service is expensive or time consuming, you can
run tests from different client environments,
while booting up the tested service only once.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>access-service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker:20.10.16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>docker:dind                   </span><span class=w> </span><span class=c># necessary for docker run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>tutum/wordpress:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>FF_NETWORK_PER_BUILD</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span><span class=w>     </span><span class=c># activate container-to-container networking</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    docker run --rm --name curl \
</span></span></span><span class=line><span class=cl><span class=sd>      --volume  &#34;$(pwd)&#34;:&#34;$(pwd)&#34;    \
</span></span></span><span class=line><span class=cl><span class=sd>      --workdir &#34;$(pwd)&#34;             \
</span></span></span><span class=line><span class=cl><span class=sd>      --network=host                 \
</span></span></span><span class=line><span class=cl><span class=sd>      curlimages/curl:7.74.0 curl &#34;http://tutum-wordpress&#34;</span></span></span></code></pre></div></div><p>For this solution to work, you must:</p><ul><li>Use <a href=https://docs.gitlab.com/runner/executors/docker.html#create-a-network-for-each-job>the networking mode that creates a new network for each job</a>.</li><li><a href=/ci/docker/using_docker_build/#use-docker-socket-binding>Not use the Docker executor with Docker socket binding</a>.
If you must, then in the previous example, instead of <code>host</code>, use the dynamic network name created for this job.</li></ul><h2 id=how-docker-integration-works>How Docker integration works</h2><p>The following is a high level overview of the steps performed by Docker during job
time.</p><ol><li>Create any service container: <code>mysql</code>, <code>postgresql</code>, <code>mongodb</code>, <code>redis</code>.</li><li>Create a cache container to store all volumes as defined in <code>config.toml</code> and
<code>Dockerfile</code> of build image (<code>ruby:2.6</code> as in the previous examples).</li><li>Create a build container and link any service container to build container.</li><li>Start the build container, and send a job script to the container.</li><li>Run the job script.</li><li>Checkout code in: <code>/builds/group-name/project-name/</code>.</li><li>Run any step defined in <code>.gitlab-ci.yml</code>.</li><li>Check the exit status of build script.</li><li>Remove the build container and all created service containers.</li></ol><h2 id=capturing-service-container-logs>Capturing service container logs</h2><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-2 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-2>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-2 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab-runner/-/merge_requests/3680>Introduced</a> in GitLab Runner 15.6.</li></ul></div></div><p>Logs generated by applications running in service containers can be captured for subsequent examination and debugging.
View service container logs when a service container starts successfully but causes job failures due to unexpected behavior.
The logs can indicate missing or incorrect configuration of the service
in the container.</p><p><code>CI_DEBUG_SERVICES</code> should only be enabled when service containers are being actively debugged as there are both storage
and performance consequences to capturing service container logs.</p><p>To enable service logging, add the <code>CI_DEBUG_SERVICES</code> variable to the project&rsquo;s
<code>.gitlab-ci.yml</code> file:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>CI_DEBUG_SERVICES</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;true&#34;</span></span></span></code></pre></div></div><p>Accepted values are:</p><ul><li>Enabled: <code>TRUE</code>, <code>true</code>, <code>True</code></li><li>Disabled: <code>FALSE</code>, <code>false</code>, <code>False</code></li></ul><p>Any other values result in an error message and effectively disable the feature.</p><p>When enabled, logs for all service containers are captured and streamed into the jobs trace log concurrently with
other logs. Logs from each container are prefixed with the container&rsquo;s aliases, and displayed in a different color.</p><div class="alert alert-type-note gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>To diagnose job failures, you can adjust the logging level in your service container for which you want to capture logs.
The default logging level might not provide sufficient troubleshooting information.</p></div></div><div class="alert alert-type-warning gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>Enabling <code>CI_DEBUG_SERVICES</code> might reveal masked variables. When <code>CI_DEBUG_SERVICES</code> is enabled,
service container logs and the CI job&rsquo;s logs are streamed to the job&rsquo;s trace log concurrently. This means that the
service container logs might get inserted into a job&rsquo;s masked log. This would thwart the variable masking mechanism
and result in the masked variable being revealed.</p></div></div><p>See <a href=/ci/variables/#mask-a-cicd-variable>Mask a CI/CD Variable</a></p><h2 id=debug-a-job-locally>Debug a job locally</h2><p>The following commands are run without root privileges. Verify that you can run Docker commands with your user account.</p><p>First start by creating a file named <code>build_script</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt; build_script
</span></span></span><span class=line><span class=cl><span class=s>git clone https://gitlab.com/gitlab-org/gitlab-runner.git /builds/gitlab-org/gitlab-runner
</span></span></span><span class=line><span class=cl><span class=s>cd /builds/gitlab-org/gitlab-runner
</span></span></span><span class=line><span class=cl><span class=s>make runner-bin-host
</span></span></span><span class=line><span class=cl><span class=s>EOF</span></span></span></code></pre></div></div><p>This example uses the GitLab Runner repository which contains a Makefile, so running <code>make</code> executes the target
defined in the Makefile. Instead of <code>make runner-bin-host</code>, you could run the command which is specific to your project.</p><p>Then create a service container:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker run -d --name service-redis redis:latest</span></span></code></pre></div></div><p>The previous command creates a service container named <code>service-redis</code> using the latest Redis image. The service
container runs in the background (<code>-d</code>).</p><p>Finally, create a build container by executing the <code>build_script</code> file you created earlier:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker run --name build -i --link<span class=o>=</span>service-redis:redis golang:latest /bin/bash &lt; build_script</span></span></code></pre></div></div><p>The previous command creates a container named <code>build</code> that is spawned from the <code>golang:latest</code> image and has one service
linked to it. The <code>build_script</code> is piped using <code>stdin</code> to the bash interpreter which in turn executes the
<code>build_script</code> in the <code>build</code> container.</p><p>Use the following command to remove containers after testing is complete:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=shell class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker rm -f -v build service-redis</span></span></code></pre></div></div><p>This forcefully (<code>-f</code>) removes the <code>build</code> container, the service container, and all volumes (<code>-v</code>) that were created
with the container creation.</p><h2 id=security-when-using-services-containers>Security when using services containers</h2><p>Docker privileged mode applies to services. This means that the service image container can access the host system. You should use container images from trusted sources only.</p><h2 id=shared-builds-directory>Shared <code>/builds</code> directory</h2><p>The build directory is mounted as a volume under <code>/builds</code> and is shared
between the job and services. The job checks the project out into
<code>/builds/$CI_PROJECT_PATH</code> after the services are running. Your service might
need to access project files or store artifacts. If so, wait for the directory
to exist and for <code>$CI_COMMIT_SHA</code> to be checked out. Any changes made before
the job finishes its checkout process are removed by the checkout process.</p><p>The service must detect when the job directory is populated and
ready for processing. For example, wait for a specific file to become available.</p><p>Services that start working immediately when launched are likely to fail, as the
job data may not be available yet. For example, containers use the <code>docker build</code>
command to make a network connection to the DinD service.
The service instructs its API to start a container image build. The Docker Engine
must have access to the files you&rsquo;re referencing in your Dockerfile. Hence, you
need access to the <code>CI_PROJECT_DIR</code> in the service. However, Docker Engine does not try to access it until
the <code>docker build</code> command is called in a job. At this time, the <code>/builds</code> directory
is already populated with data. The service that tries to write the <code>CI_PROJECT_DIR</code>
immediately after it started might fail with a <code>No such file or directory</code> error.</p><p>In scenarios where services that interact with job data are not controlled by the job itself, consider the
<a href=https://docs.gitlab.com/runner/executors/docker.html#docker-executor-workflow>Docker executor workflow</a>.</p></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/services/_index.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/services/_index.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>