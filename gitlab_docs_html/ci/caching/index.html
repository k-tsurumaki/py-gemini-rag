<!doctype html><html lang=en-us dir=ltr><head><script src=https://cdn.cookielaw.org/consent/7f944245-c5cd-4eed-a90e-dd955adfdd08/OtAutoBlock.js></script><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js data-domain-script=7f944245-c5cd-4eed-a90e-dd955adfdd08></script><script type=text/javascript>function OptanonWrapper(){}</script><script>const callback=(e)=>{for(const t of e)t.type==="childList"&&t.addedNodes.forEach(e=>{e.nodeName==="IMG"&&document.querySelectorAll('img:not([src^="http"]):not([data-ot-ignore])').forEach(e=>{e.setAttribute("data-ot-ignore","")})})},config={attributes:!0,childList:!0,subtree:!0,attributeFilter:["src"]},observer=new MutationObserver(callback);observer.observe(document.documentElement,config)</script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","GTM-NJXWQL"),gtag("consent","default",{analytics_storage:"granted",ad_storage:"granted",functionality_storage:"granted",wait_for_update:500}),gtag("consent","default",{analytics_storage:"denied",ad_storage:"denied",functionality_storage:"denied",region:["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","IS","LI","NO","GB","PE","RU"],wait_for_update:500}),window.geofeed=e=>{dataLayer.push({event:"OneTrustCountryLoad",oneTrustCountryId:e.country.toString()})};const json=document.createElement("script");json.setAttribute("src","https://geolocation.onetrust.com/cookieconsentpub/v1/geo/location/geofeed"),document.head.appendChild(json)</script><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Caching in GitLab CI/CD | GitLab Docs</title><link rel=icon href=/favicon.ico sizes=any><link rel=icon href=/favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=/apple-touch-icon.png><link rel=manifest href=/manifests/manifest.webmanifest><meta name=theme-color content="#FC6D26"><link rel=canonical href=https://docs.gitlab.com/ci/caching/><meta name=description content="GitLab product documentation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"GitLab Docs","url":"https://docs.gitlab.com/"}</script><link rel=preload href=/gitlab_ui/fonts/GitLabSans.woff2 type=font/woff2 as=font crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabSans-Italic.woff2 crossorigin><link rel=prefetch href=/gitlab_ui/fonts/GitLabMono.woff2 crossorigin><link rel=stylesheet href=/gitlab_ui/ui/index.css><link rel=stylesheet href=/vite/main.css><link rel=stylesheet href=/css/syntax-dark.min.css id=syntax-dark-theme><link rel=stylesheet href=/css/syntax-light.min.css id=syntax-light-theme><script>(function(){const p="gitlab-docs-theme",g="gitlab-docs-layout",e={LIGHT:"light",DARK:"dark",AUTO:"auto"},i={FIXED:"fixed",FLUID:"fluid"},d="light",f="fixed";let r=!1;const t=localStorage?.getItem(p),m=localStorage?.getItem(g),l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?e.DARK:e.LIGHT;function h(){return t&&(t===e.LIGHT||t===e.DARK)?t:(t===e.AUTO&&(r=!0),l||d)}function u(){return m===i.FLUID?i.FLUID:f}const s=h(),c=u(),n=document.documentElement;n.classList.remove("gl-dark","gl-light"),n.classList.add(s===e.DARK?"gl-dark":"gl-light"),c===i.FLUID&&(n.classList.add("fluid"),n.classList.remove("fixed"));const a=document.getElementById("syntax-dark-theme"),o=document.getElementById("syntax-light-theme");a&&o&&(s===e.DARK?(a.disabled=!1,o.disabled=!0):(a.disabled=!0,o.disabled=!1)),window.__initialTheme=r?e.AUTO:s,window.__initialLayout=c})()</script><meta name=gitlab_docs_base_url content="/"><meta name=gitlab_docs_page_owner data-stage=Verify data-group="Pipeline Authoring"><meta class=elastic name=gitlab_docs_version content="18.6"><meta class=elastic name=gitlab_docs_section content="use_gitlab"><meta class=elastic name=gitlab_docs_breadcrumbs content="Use GitLab › Use CI/CD to build your application › Jobs"><script>window.pageMetadata={trail:[{path:"user/",title:"Use GitLab"},{path:"topics/build_your_application/",title:"Use CI/CD to build your application"},{path:"ci/jobs/",title:"Jobs"},{path:"ci/caching/",title:"Caching"}]}</script><meta name=gitlab_docs_legacy_path content="/ee/ci/caching/index.html"><meta name=gitlab_docs_hugo_launch_version content="17.9"><script>const ELASTIC_CLOUD_ID="gitlab-docs-website:dXMtY2VudHJhbDEuZ2NwLmNsb3VkLmVzLmlvJDQwZTQyYTQzMTJiZjQyMzNiMzBiZTg0MTU5YjlkNmE1JGMxODg4Y2U5OTY0YzQzZjc5ZjQ1YTk5NDZmMjI0ODg0",ELASTIC_KEY="cDFpLWJaSUJXVHBqWWI4VGZKN3M6eENBSjl4WDRSRnlCUW94ajRQazhLQQ==",ELASTIC_INDEX="search-gitlab-docs-hugo"</script><script type=module src=/vite/elastic_search.js></script><script type=module src=/vite/history.js></script><script>const FS_IDENTIFIER="AIzaSyCLdi3jHHjkmLji9D8uj_RNPMHcdrYoIW4",RECAPTCHA_PUBLIC_KEY="6Le4R3UrAAAAALsIlK_siq0_UhPD-0rD-ImF1gfO"</script><meta name=google-site-verification content="AcGSBNaKDWnLgcYotlVibGy6STm2Y6_KJSaRxrA90xY"><meta name=google-site-verification content="6eFQOFLxYAer08ROqc3I-SAi44F9NmvH7PrUUBR3oCI"><meta name=google-site-verification content="xAUTWp3CDg-tU1LVVwsM9OrVhLR7L3SmiyKzkOuPNos"><meta name=google-site-verification content="F0zzwaMpiyWFcPQ1Lqu18qN3EnuQsqFXbySl_29yvHs"><meta name=google-site-verification content="nwo1bVaU0t9TZxZyM-aOI6-CofaH9GRL-uBPbdREWgc"><meta name=google-site-verification content="rWoHrtHEmIX0t28oOb1ZEDMYZb_EZA6rr6ZOl5otEPI"><meta name=google-site-verification content="fSxr8-uslxcuFL0N-oECp3Tm0RPNEGX97wbdayKOEL8"><meta name=google-site-verification content="ISxyLVnZqU8oY3jwrK7EO9o-2DOTvLJwPse7bZz6yhs"><meta name=google-site-verification content="x1WspIvz3ZHqS0gezfX_P-qiRDOeP2Oyrd68zrU2ErI"><meta name=google-site-verification content="DfXB2Za52GT3zs_vuLIAL4Mi3M3K4qxXcg7MAs0CUqo"><meta name=google-site-verification content="BCEBC2LC7A1NzO9Com1oBrWK88tV_QXfUL0i9mwXPL0"><meta name=google-site-verification content="a2lNcHMorfS43aoISjZt5_BBPo-H1UaTKMQdBgZO9iY"><meta name=google-site-verification content="0s16pP9MelY6wDHRf-izXb5pwLU01IogP-Uc_e8f3GU"><meta name=google-site-verification content="H474RNof35Xp8fLg02fZbg9Dzxdtfch6vtcjzpmUraU"><meta name=google-site-verification content="E0FlhpgBGeE7d1pQ6amdcIWPMDLDeu15-HLQVoDTguE"><meta name=google-site-verification content="opQd7_rXtPy-pX5CO_XZiztzeQEsXnB3j6Y1_dZAizA"><meta name=google-site-verification content="06Kq4AoXdmBOjOAkbPvnYGtSxnn4Q9QBqEO55PLlw5c"><meta name=google-site-verification content="djBBokRFSWV_VRlSE51V5TZSPzMC6hml5l-Sb22WglE"><meta name=google-site-verification content="UOW6nOsvbyMeIySuamzbws4kNC_WqehamWfoxxtKjZ8"><meta name=google-site-verification content="hXU1Gsdba74DUbvbdUHRl9o0cQeiwXIhAdIllOG6p8E"><meta name=google-site-verification content="YFeHIAPk9lE76ubVMeq4P0sQVnzo2-a4k1oU_bPY8yE"><meta name=google-site-verification content="h8ICI4eDkvXmYaGDuLTLoWuXnLn-KUkChqYB-roMRsw"><meta name=google-site-verification content="9QW7feFNlCpMLPm7vAWEU-v14vdzb0Bb3RAk-8e_a18"><meta name=google-site-verification content="26kXLBOjaYRb2UwzWTDl1I1nzA2NxMunhp7SUtxGV6E"><meta name=google-site-verification content="jr3C8t6vKGPyN9GV3esdHY_xGYyQaUNznIl-Un2RObA"><meta name=google-site-verification content="WdlBpRU0ec1ieKqrTY_772OhG23FY45VQ4Lv9DyLJ_Y"><meta name=google-site-verification content="n9i6B9q4Xjr_etK2nQGZH1msoo7vIv9SXV8SQLOUA7c"><meta name=zd-site-verification content="ony3w7hk1vs6tfyrc51mld"><meta name=zd-site-verification content="gtuq65qdzt6n31viazi6hj"></head><body data-elastic-exclude><nav data-ga-section=header data-elastic-exclude><div class="header-wrapper gl-w-full gl-fixed gl-z-4"><div class=header><div class="header-top gl-flex gl-items-center"><a href=#skipTarget class="gl-sr-only skip-link">Skip to main content</a>
<a class=navbar-logo href=/><span class=gl-sr-only>Go to GitLab Docs homepage</span></a><div class="mobile-header gl-w-full gl-text-base"><div class=mobile-header-overlay></div><div class="header-right collapse gl-z-4 gl-border-t lg:gl-border-0"><div class="search-wrapper lg:gl-ml-4 lg:gl-grow"><div class="js-elastic-search-form gl-spinner-container"><span role=status aria-label=Loading class="gl-ml-3 gl-align-text-bottom! gl-spinner gl-spinner gl-spinner-sm"></span></div></div><div class="gl-flex gl-flex-col gl-gap-3 gl-mt-5 lg:gl-mt-0 lg:gl-flex-row lg:gl-items-center gl-ml-auto"><a class="whats-new gl-button btn-default btn-default-tertiary gl-hidden lg:gl-block" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a><div data-vue-app=versions-menu></div><div data-vue-app=appearance-toggle class="gl-hidden lg:gl-block"></div><div class="gl-flex gl-justify-evenly lg:gl-justify-normal gl-items-center gl-gap-5"><a class="whats-new gl-button btn-default btn-default-tertiary gl-w-full lg:gl-hidden hover:gl-no-underline" href=https://about.gitlab.com/releases/categories/releases/ target=_blank rel="noopener noreferrer">What's new?</a>
<a class="free-trial-btn cta-button gl-button btn-confirm gl-w-full hover:gl-no-underline" href="https://gitlab.com/-/trial_registrations/new?glm_source=docs.gitlab.com&amp;amp;glm_content=navigation-cta-docs" target=_blank rel="noopener noreferrer" role=button>Get free trial</a></div></div></div></div><button class="navbar-toggle gl-button btn-default lg:gl-hidden" data-toggle=collapse data-target=.header-right>
<span class=navbar-toggle-icon></span>
<span class=gl-sr-only>Toggle menu</span></button></div><div class="header-bottom gl-border-t lg:gl-border-b"><ul class="subheader-menu gl-hidden lg:gl-flex gl-list-none gl-text-base gl-space-x-5 gl-py-4 gl-pl-0 gl-mb-0"><li><a href=/user/ class=active>Use GitLab</a></li><li><a href=/user/gitlab_duo/>GitLab Duo</a></li><li><a href=/api/>Extend</a></li><li><a href=/install/>Install</a></li><li><a href=/administration/>Administer</a></li><li><a href=/subscriptions/>Subscribe</a></li><li><a href=/development/>Contribute</a></li><li><a href=/solutions/>Solutions</a></li></ul></div></div></div></nav><main data-ga-section=content-body><div id=js-version-banner></div><div class="template-single gl-flex gl-h-full"><div class=side-nav data-ga-section=side-nav data-vue-app=sidebar-menu></div><div data-pagefind-body class=main-content><div class=docs-content><div class="gl-flex gl-h-5 gl-items-center gl-my-6"><div data-vue-app=open-sidebar></div><div data-vue-app=breadcrumb-nav></div></div><hr class="gl-border-t gl-px-5 lg:gl-hidden"><div class="gl-pt-4 gl-mt-4 lg:gl-pt-0 lg:gl-mt-0 lg:gl-border-t-0"><h1 id=skipTarget class=gl-mb-6>Caching in GitLab CI/CD</h1></div><div data-elastic-include><div class="availability gl-pl-4 gl-mb-5"><ul class="gl-list-none gl-p-0 gl-m-0"><li><span class=gl-font-bold>Tier</span>: Free, Premium, Ultimate</li><li><span class=gl-font-bold>Offering</span>: GitLab.com, GitLab Self-Managed, GitLab Dedicated</li></ul></div><p>A cache is one or more files a job downloads and saves. Subsequent jobs that use
the same cache don&rsquo;t have to download the files again, so they execute more quickly.</p><p>To learn how to define the cache in your <code>.gitlab-ci.yml</code> file,
see the <a href=/ci/yaml/#cache><code>cache</code> reference</a>.</p><p>For advanced cache key strategies, you can use:</p><ul><li><a href=/ci/yaml/#cachekeyfiles><code>cache:key:files</code></a>: Generate keys linked to the content of specific files.</li><li><a href=/ci/yaml/#cachekeyfiles_commits><code>cache:key:files_commits</code></a>: Generate keys linked to the latest commit of specific files.</li></ul><h2 id=how-cache-is-different-from-artifacts>How cache is different from artifacts</h2><p>Use cache for dependencies, like packages you download from the internet.
Cache is stored where GitLab Runner is installed and uploaded to S3 if
<a href=https://docs.gitlab.com/runner/configuration/autoscale.html#distributed-runners-caching>distributed cache is enabled</a>.</p><p>Use artifacts to pass intermediate build results between stages.
Artifacts are generated by a job, stored in GitLab, and can be downloaded.</p><p>Both artifacts and caches define their paths relative to the project directory, and
can&rsquo;t link to files outside it.</p><h3 id=cache>Cache</h3><ul><li>Define cache per job by using the <code>cache</code> keyword. Otherwise it is disabled.</li><li>Subsequent pipelines can use the cache.</li><li>Subsequent jobs in the same pipeline can use the cache, if the dependencies are identical.</li><li>Different projects cannot share the cache.</li><li>By default, protected and non-protected branches <a href=/ci/caching/#cache-key-names>do not share the cache</a>. However, you can <a href=/ci/caching/#use-the-same-cache-for-all-branches>change this behavior</a>.</li></ul><h3 id=artifacts>Artifacts</h3><ul><li>Define artifacts per job.</li><li>Subsequent jobs in later stages of the same pipeline can use artifacts.</li><li>Artifacts expire after 30 days by default. You can define a custom <a href=/ci/yaml/#artifactsexpire_in>expiration time</a>.</li><li>The latest artifacts do not expire if <a href=/ci/jobs/job_artifacts/#keep-artifacts-from-most-recent-successful-jobs>keep latest artifacts</a> is enabled.</li><li>Use <a href=/ci/yaml/#dependencies>dependencies</a> to control which jobs fetch the artifacts.</li></ul><h2 id=good-caching-practices>Good caching practices</h2><p>To ensure maximum availability of the cache, do one or more of the following:</p><ul><li><a href=/ci/runners/configure_runners/#control-jobs-that-a-runner-can-run>Tag your runners</a> and use the tag on jobs
that share the cache.</li><li><a href=/ci/runners/runners_scope/#prevent-a-project-runner-from-being-enabled-for-other-projects>Use runners that are only available to a particular project</a>.</li><li><a href=/ci/yaml/#cachekey>Use a <code>key</code></a> that fits your workflow. For example,
you can configure a different cache for each branch.</li></ul><p>For runners to work with caches efficiently, you must do one of the following:</p><ul><li>Use a single runner for all your jobs.</li><li>Use multiple runners that have
<a href=https://docs.gitlab.com/runner/configuration/autoscale.html#distributed-runners-caching>distributed caching</a>,
where the cache is stored in S3 buckets. Instance runners on GitLab.com behave this way. These runners can be in autoscale mode,
but they don&rsquo;t have to be. To manage cache objects,
apply lifecycle rules to delete the cache objects after a period of time.
Lifecycle rules are available on the object storage server.</li><li>Use multiple runners with the same architecture and have these runners
share a common network-mounted directory to store the cache. This directory should use NFS or something similar.
These runners must be in autoscale mode.</li></ul><h2 id=use-multiple-caches>Use multiple caches</h2><p>You can have a maximum of four caches, per job:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>test-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>key</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>files</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>Gemfile.lock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>vendor/ruby</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>key</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>files</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>yarn.lock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>.yarn-cache/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle config set --local path &#39;vendor/ruby&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>yarn install --cache-folder .yarn-cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo Run tests...</span></span></span></code></pre></div></div><p>If multiple caches are combined with a fallback cache key,
the global fallback cache is fetched every time a cache is not found.</p><h2 id=use-a-fallback-cache-key>Use a fallback cache key</h2><h3 id=per-cache-fallback-keys>Per-cache fallback keys</h3><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-1 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-1>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-1 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/merge_requests/110467>Introduced</a> in GitLab 16.0</li></ul></div></div><p>Each cache entry supports up to five fallback keys with the <a href=/ci/yaml/#cachefallback_keys><code>fallback_keys</code> keyword</a>.
When a job does not find a cache key, the job attempts to retrieve a fallback cache instead.
Fallback keys are searched in order until a cache is found. If no cache is found,
the job runs without using a cache. For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>test-job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>cache-$CI_COMMIT_REF_SLUG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>fallback_keys</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>cache-$CI_DEFAULT_BRANCH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>cache-default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>vendor/ruby</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle config set --local path &#39;vendor/ruby&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo Run tests...</span></span></span></code></pre></div></div><p>In this example:</p><ol><li>The job looks for the <code>cache-$CI_COMMIT_REF_SLUG</code> cache.</li><li>If <code>cache-$CI_COMMIT_REF_SLUG</code> is not found, the job looks for <code>cache-$CI_DEFAULT_BRANCH</code>
as a fallback option.</li><li>If <code>cache-$CI_DEFAULT_BRANCH</code> is also not found, the job looks for <code>cache-default</code>
as a second fallback option.</li><li>If none are found, the job downloads all the Ruby dependencies without using a cache,
but creates a new cache for <code>cache-$CI_COMMIT_REF_SLUG</code> when the job completes.</li></ol><p>Fallback keys follow the same processing logic as <code>cache:key</code>:</p><ul><li>If you <a href=/ci/caching/#clear-the-cache-manually>clear caches manually</a>, per-cache fallback keys are appended
with an index like other cache keys.</li><li>If the <a href=/ci/caching/#cache-key-names><strong>Use separate caches for protected branches</strong> setting</a> is enabled,
per-cache fallback keys are appended with <code>-protected</code> or <code>-non_protected</code>.</li></ul><h3 id=global-fallback-key>Global fallback key</h3><p>You can use the <code>$CI_COMMIT_REF_SLUG</code> <a href=/ci/variables/predefined_variables/>predefined variable</a>
to specify your <a href=/ci/yaml/#cachekey><code>cache:key</code></a>. For example, if your
<code>$CI_COMMIT_REF_SLUG</code> is <code>test</code>, you can set a job to download cache that&rsquo;s tagged with <code>test</code>.</p><p>If a cache with this tag is not found, you can use <code>CACHE_FALLBACK_KEY</code> to
specify a cache to use when none exists.</p><p>In the following example, if the <code>$CI_COMMIT_REF_SLUG</code> is not found, the job uses the key defined
by the <code>CACHE_FALLBACK_KEY</code> variable:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>CACHE_FALLBACK_KEY</span><span class=p>:</span><span class=w> </span><span class=l>fallback-key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;$CI_COMMIT_REF_SLUG&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>binaries/</span></span></span></code></pre></div></div><p>The order of caches extraction is:</p><ol><li>Retrieval attempt for <code>cache:key</code></li><li>Retrieval attempts for each entry in order in <code>fallback_keys</code></li><li>Retrieval attempt for the global fallback key in <code>CACHE_FALLBACK_KEY</code></li></ol><p>The cache extraction process stops after the first successful cache is retrieved.</p><h2 id=disable-cache-for-specific-jobs>Disable cache for specific jobs</h2><p>If you define the cache globally, each job uses the
same definition. You can override this behavior for each job.</p><p>To disable it completely for a job, use an empty list:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w> </span><span class=p>[]</span></span></span></code></pre></div></div><h2 id=inherit-global-configuration-but-override-specific-settings-per-job>Inherit global configuration, but override specific settings per job</h2><p>You can override cache settings without overwriting the global cache by using
<a href=/ci/yaml/yaml_optimization/#anchors>anchors</a>. For example, if you want to override the
<code>policy</code> for one job:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w> </span><span class=cp>&amp;global_cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_REF_SLUG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>node_modules/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>public/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vendor/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>policy</span><span class=p>:</span><span class=w> </span><span class=l>pull-push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># inherit all global cache settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=cp>*global_cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># override the policy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>policy</span><span class=p>:</span><span class=w> </span><span class=l>pull</span></span></span></code></pre></div></div><p>For more information, see <a href=/ci/yaml/#cachepolicy><code>cache: policy</code></a>.</p><h2 id=common-use-cases-for-caches>Common use cases for caches</h2><p>Usually you use caches to avoid downloading content, like dependencies
or libraries, each time you run a job. Node.js packages,
PHP packages, Ruby gems, Python libraries, and others can be cached.</p><p>For examples, see the <a href=https://gitlab.com/gitlab-org/gitlab/-/tree/master/lib/gitlab/ci/templates>GitLab CI/CD templates</a>.</p><h3 id=share-caches-between-jobs-in-the-same-branch>Share caches between jobs in the same branch</h3><p>To have jobs in each branch use the same cache, define a cache with the <code>key: $CI_COMMIT_REF_SLUG</code>:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_REF_SLUG</span></span></span></code></pre></div></div><p>This configuration prevents you from accidentally overwriting the cache. However, the
first pipeline for a merge request is slow. The next time a commit is pushed to the branch, the
cache is re-used and jobs run faster.</p><p>To enable per-job and per-branch caching:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;$CI_JOB_NAME-$CI_COMMIT_REF_SLUG&#34;</span></span></span></code></pre></div></div><p>To enable per-stage and per-branch caching:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;$CI_JOB_STAGE-$CI_COMMIT_REF_SLUG&#34;</span></span></span></code></pre></div></div><h3 id=share-caches-across-jobs-in-different-branches>Share caches across jobs in different branches</h3><p>To share a cache across all branches and all jobs, use the same key for everything:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>one-key-to-rule-them-all</span></span></span></code></pre></div></div><p>To share a cache between branches, but have a unique cache for each job:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>$CI_JOB_NAME</span></span></span></code></pre></div></div><h3 id=use-a-variable-to-control-a-jobs-cache-policy>Use a variable to control a job&rsquo;s cache policy</h3><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-2 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-2>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-2 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/371480>Introduced</a> in GitLab 16.1.</li></ul></div></div><p>To reduce duplication of jobs where the only difference is the pull policy, you can use a <a href=/ci/variables/>CI/CD variable</a>.</p><p>For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>conditional-policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>POLICY</span><span class=p>:</span><span class=w> </span><span class=l>pull-push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_BRANCH != $CI_DEFAULT_BRANCH</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>POLICY</span><span class=p>:</span><span class=w> </span><span class=l>pull</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>gems</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>policy</span><span class=p>:</span><span class=w> </span><span class=l>$POLICY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vendor/bundle</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;This job pulls and pushes the cache depending on the branch&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;Downloading dependencies...&#34;</span></span></span></code></pre></div></div><p>In this example, the job&rsquo;s cache policy is:</p><ul><li><code>pull-push</code> for changes to the default branch.</li><li><code>pull</code> for changes to other branches.</li></ul><h3 id=cache-nodejs-dependencies>Cache Node.js dependencies</h3><p>If your project uses <a href=https://www.npmjs.com/>npm</a> to install Node.js
dependencies, the following example defines a default <code>cache</code> so that all jobs inherit it.
By default, npm stores cache data in the home folder (<code>~/.npm</code>). However, you
<a href=/ci/yaml/#cachepaths>can&rsquo;t cache things outside of the project directory</a>.
Instead, tell npm to use <code>./.npm</code>, and cache it per-branch:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>node:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>  </span><span class=c># Cache modules in between jobs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_REF_SLUG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.npm/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>npm ci --cache .npm --prefer-offline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test_async</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>node ./specs/start.js ./specs/async.spec.js</span></span></span></code></pre></div></div><h4 id=compute-the-cache-key-from-the-lock-file>Compute the cache key from the lock file</h4><p>You can use <a href=/ci/yaml/#cachekeyfiles><code>cache:key:files</code></a> to compute the cache
key from a lock file like <code>package-lock.json</code> or <code>yarn.lock</code>, and reuse it in many jobs.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>  </span><span class=c># Cache modules using lock file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>files</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>package-lock.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.npm/</span></span></span></code></pre></div></div><p>If you&rsquo;re using <a href=https://yarnpkg.com/>Yarn</a>, you can use <a href=https://classic.yarnpkg.com/blog/2016/11/24/offline-mirror/><code>yarn-offline-mirror</code></a>
to cache the zipped <code>node_modules</code> tarballs. The cache generates more quickly, because
fewer files have to be compressed:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#39;yarn-offline-mirror &#34;.yarn-cache/&#34;&#39; &gt;&gt; .yarnrc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#39;yarn-offline-mirror-pruning true&#39; &gt;&gt; .yarnrc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>yarn install --frozen-lockfile --no-progress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>files</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>yarn.lock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.yarn-cache/</span></span></span></code></pre></div></div><h3 id=cache-cc-compilation-using-ccache>Cache C/C++ compilation using Ccache</h3><p>If you are compiling C/C++ projects, you can use <a href=https://ccache.dev/>Ccache</a> to
speed up your build times. Ccache speeds up recompilation by caching previous compilations
and detecting when the same compilation is being done again. When building big projects like the Linux kernel,
you can expect significantly faster compilations.</p><p>Use <code>cache</code> to reuse the created cache between jobs, for example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>ccache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>export PATH=&#34;/usr/lib/ccache:$PATH&#34; </span><span class=w> </span><span class=c># Override compiler path with ccache (this example is for Debian)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>export CCACHE_DIR=&#34;${CI_PROJECT_DIR}/ccache&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>export CCACHE_BASEDIR=&#34;${CI_PROJECT_DIR}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>export CCACHE_COMPILERCHECK=content </span><span class=w> </span><span class=c># Compiler mtime might change in the container, use checksums instead</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ccache --zero-stats || true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>time make                           </span><span class=w> </span><span class=c># Actually build your code while measuring time and cache efficiency.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ccache --show-stats || true</span></span></span></code></pre></div></div><p>If you have multiple projects in a single repository you do not need a separate <code>CCACHE_BASEDIR</code> for each of them.</p><h3 id=cache-php-dependencies>Cache PHP dependencies</h3><p>If your project uses <a href=https://getcomposer.org/>Composer</a> to install
PHP dependencies, the following example defines a default <code>cache</code> so that
all jobs inherit it. PHP libraries modules are installed in <code>vendor/</code> and
are cached per-branch:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>php:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>  </span><span class=c># Cache libraries in between jobs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_REF_SLUG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vendor/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Install and run Composer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>curl --show-error --silent &#34;https://getcomposer.org/installer&#34; | php</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>php composer.phar install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>vendor/bin/phpunit --configuration phpunit.xml --coverage-text --colors=never</span></span></span></code></pre></div></div><h3 id=cache-python-dependencies>Cache Python dependencies</h3><p>If your project uses <a href=https://pip.pypa.io/en/stable/>pip</a> to install
Python dependencies, the following example defines a default <code>cache</code> so that
all jobs inherit it. pip&rsquo;s cache is defined under <code>.cache/pip/</code> and is cached per-branch:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>python:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>                      </span><span class=c># Pip&#39;s cache doesn&#39;t store the python packages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>                    </span><span class=c># https://pip.pypa.io/en/stable/topics/caching/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.cache/pip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>python -V              </span><span class=w> </span><span class=c># Print out python version for debugging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pip install virtualenv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>virtualenv venv</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>source venv/bin/activate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>variables</span><span class=p>:</span><span class=w>  </span><span class=c># Change pip&#39;s cache directory to be inside the project directory because GitLab can only cache local items.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>PIP_CACHE_DIR</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;$CI_PROJECT_DIR/.cache/pip&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>python setup.py test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>pip install ruff</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ruff --format=gitlab .</span></span></span></code></pre></div></div><h3 id=cache-ruby-dependencies>Cache Ruby dependencies</h3><p>If your project uses <a href=https://bundler.io>Bundler</a> to install
gem dependencies, the following example defines a default <code>cache</code> so that all
jobs inherit it. Gems are installed in <code>vendor/ruby/</code> and are cached per-branch:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ruby:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>                                            </span><span class=c># Cache gems in between builds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>$CI_COMMIT_REF_SLUG</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vendor/ruby</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>ruby -v                                      </span><span class=w> </span><span class=c># Print out ruby version for debugging</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle config set --local path &#39;vendor/ruby&#39; </span><span class=w> </span><span class=c># The location to install the specified gems to</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle install -j $(nproc)                   </span><span class=w> </span><span class=c># Install dependencies into ./vendor/ruby</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rspec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>rspec spec</span></span></span></code></pre></div></div><p>If you have jobs that need different gems, use the <code>prefix</code>
keyword in the global <code>cache</code> definition. This configuration generates a different
cache for each job.</p><p>For example, a testing job might not need the same gems as a job that deploys to
production:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>files</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>Gemfile.lock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>prefix</span><span class=p>:</span><span class=w> </span><span class=l>$CI_JOB_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vendor/ruby</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle config set --local path &#39;vendor/ruby&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle install --without production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle exec rspec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy_job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>production</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle config set --local path &#39;vendor/ruby&#39;  </span><span class=w> </span><span class=c># The location to install the specified gems to</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle install --without test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>bundle exec deploy</span></span></span></code></pre></div></div><h3 id=cache-go-dependencies>Cache Go dependencies</h3><p>If your project uses <a href=https://go.dev/wiki/Modules>Go Modules</a> to install
Go dependencies, the following example defines <code>cache</code> in a <code>go-cache</code> template, that
any job can extend. Go modules are installed in <code>${GOPATH}/pkg/mod/</code> and
are cached for all of the <code>go</code> projects:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>.go-cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>variables</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>GOPATH</span><span class=p>:</span><span class=w> </span><span class=l>$CI_PROJECT_DIR/.go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mkdir -p .go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.go/pkg/mod/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>golang:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>extends</span><span class=p>:</span><span class=w> </span><span class=l>.go-cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>go test ./... -v -short</span></span></span></code></pre></div></div><h3 id=cache-curl-downloads>Cache curl downloads</h3><p>If your project uses <a href=https://curl.se/>cURL</a> to download dependencies or files,
you can cache the downloaded content. The files are automatically updated when
newer downloads are available.</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>job</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>curl --remote-time --time-cond .curl-cache/caching.md --output .curl-cache/caching.md &#34;https://docs.gitlab.com/ci/caching/&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.curl-cache/</span></span></span></code></pre></div></div><p>In this example cURL downloads a file from a webserver and saves it to a local file in <code>.curl-cache/</code>.
The <code>--remote-time</code> flag saves the last modification time reported by the server,
and cURL compares it to the timestamp of the cached file with <code>--time-cond</code>. If the remote file has
a more recent timestamp the local cache is automatically updated.</p><h2 id=availability-of-the-cache>Availability of the cache</h2><p>Caching is an optimization, but it isn&rsquo;t guaranteed to always work. You might need
to regenerate cached files in each job that needs them.</p><p>After you define a <a href=/ci/yaml/#cache>cache in <code>.gitlab-ci.yml</code></a>,
the availability of the cache depends on:</p><ul><li>The runner&rsquo;s executor type.</li><li>Whether different runners are used to pass the cache between jobs.</li></ul><h3 id=where-the-caches-are-stored>Where the caches are stored</h3><p>All caches defined for a job are archived in a single <code>cache.zip</code> file.
The runner configuration defines where the file is stored. By default, the cache
is stored on the machine where GitLab Runner is installed. The location also depends on the type of executor.</p><table><thead><tr><th>Runner executor</th><th>Default path of the cache</th></tr></thead><tbody><tr><td><a href=https://docs.gitlab.com/runner/executors/shell.html>Shell</a></td><td>Locally, under the <code>gitlab-runner</code> user&rsquo;s home directory: <code>/home/gitlab-runner/cache/&lt;user>/&lt;project>/&lt;cache-key>/cache.zip</code>.</td></tr><tr><td><a href=https://docs.gitlab.com/runner/executors/docker.html>Docker</a></td><td>Locally, under <a href=https://docs.gitlab.com/runner/executors/docker.html#configure-directories-for-the-container-build-and-cache>Docker volumes</a>: <code>/var/lib/docker/volumes/&lt;volume-id>/_data/&lt;user>/&lt;project>/&lt;cache-key>/cache.zip</code>.</td></tr><tr><td><a href=https://docs.gitlab.com/runner/executors/docker_machine.html>Docker Machine</a> (autoscale runners)</td><td>The same as the Docker executor.</td></tr></tbody></table><p>If you use cache and artifacts to store the same path in your jobs, the cache might
be overwritten because caches are restored before artifacts.</p><h4 id=cache-key-names>Cache key names</h4><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-3 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-3>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-3 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/330047>Introduced</a> in GitLab 15.0.</li></ul></div></div><p>A suffix is added to the cache key, with the exception of the <a href=/ci/caching/#global-fallback-key>global fallback cache key</a>.</p><p>As an example, assuming that <code>cache.key</code> is set to <code>$CI_COMMIT_REF_SLUG</code>, and that you have two branches <code>main</code>
and <code>feature</code>, then the following table represents the resulting cache keys:</p><table><thead><tr><th>Branch name</th><th>Cache key</th></tr></thead><tbody><tr><td><code>main</code></td><td><code>main-protected</code></td></tr><tr><td><code>feature</code></td><td><code>feature-non_protected</code></td></tr></tbody></table><h5 id=cache-suffix-with-tag-triggers>Cache suffix with tag triggers</h5><p>When a pipeline is triggered by a tag (like <code>$CI_COMMIT_TAG</code>), the cache suffix (<code>-protected</code> or <code>-non_protected</code>)
is determined by the tag&rsquo;s protection status, not the branch where the pipeline executes.</p><p>This behavior ensures consistent security boundaries, because the triggering reference determines cache access permissions.</p><p>For example, with tags that trigger pipelines on different branches:</p><table><thead><tr><th>Trigger type</th><th>Tag protection</th><th>Branch</th><th>Cache suffix</th></tr></thead><tbody><tr><td>Tag <code>0.26.1</code> (unprotected)</td><td>Unprotected</td><td><code>main</code> (protected)</td><td><code>-non_protected</code></td></tr><tr><td>Tag <code>1.0.0</code> (protected)</td><td>Protected</td><td><code>main</code> (protected)</td><td><code>-protected</code></td></tr><tr><td>Tag <code>dev-123</code> (unprotected)</td><td>Unprotected</td><td><code>feature</code> (unprotected)</td><td><code>-non_protected</code></td></tr></tbody></table><h5 id=use-the-same-cache-for-all-branches>Use the same cache for all branches</h5><div class="collapsible-section gl-my-5"><button class="gl-align-middle gl-text-left gl-border-0 gl-pl-0" type=button aria-expanded=false aria-controls=collapsible-4 aria-label="Toggle section" data-toggle=collapse data-target=#collapsible-4>History<span class="gl-ml-2 icon"></span></button><div id=collapsible-4 class="collapsible-list collapse" aria-hidden=true><ul><li><a href=https://gitlab.com/gitlab-org/gitlab/-/issues/361643>Introduced</a> in GitLab 15.0.</li></ul></div></div><p>If you do not want to use <a href=/ci/caching/#cache-key-names>cache key names</a>,
you can have all branches (protected and unprotected) use the same cache.</p><p>The cache separation with <a href=/ci/caching/#cache-key-names>cache key names</a> is a security feature
and should only be disabled in an environment where all users with Developer role are highly trusted.</p><p>To use the same cache for all branches:</p><ol><li>On the left sidebar, select <strong>Search or go to</strong> and find your project. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</li><li>Select <strong>Settings</strong> > <strong>CI/CD</strong>.</li><li>Expand <strong>General pipelines</strong>.</li><li>Clear the <strong>Use separate caches for protected branches</strong> checkbox.</li><li>Select <strong>Save changes</strong>.</li></ol><h3 id=how-archiving-and-extracting-works>How archiving and extracting works</h3><p>This example shows two jobs in two consecutive stages:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>build-cache</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vendor/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>before_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;Hello&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job A</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>mkdir vendor/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;build&#34; &gt; vendor/hello.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>after_script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>echo &#34;World&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job B</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>cat vendor/hello.txt</span></span></span></code></pre></div></div><p>If one machine has one runner installed, then all jobs for your project
run on the same host:</p><ol><li>Pipeline starts.</li><li><code>job A</code> runs.</li><li>The cache is extracted (if found).</li><li><code>before_script</code> is executed.</li><li><code>script</code> is executed.</li><li><code>after_script</code> is executed.</li><li><code>cache</code> runs and the <code>vendor/</code> directory is zipped into <code>cache.zip</code>.
This file is then saved in the directory based on the
<a href=/ci/caching/#where-the-caches-are-stored>runner&rsquo;s setting</a> and the <code>cache: key</code>.</li><li><code>job B</code> runs.</li><li>The cache is extracted (if found).</li><li><code>before_script</code> is executed.</li><li><code>script</code> is executed.</li><li>Pipeline finishes.</li></ol><p>By using a single runner on a single machine, you don&rsquo;t have the issue where
<code>job B</code> might execute on a runner different from <code>job A</code>. This setup guarantees the
cache can be reused between stages. It only works if the execution goes from the <code>build</code> stage
to the <code>test</code> stage in the same runner/machine. Otherwise, the cache <a href=/ci/caching/#cache-mismatch>might not be available</a>.</p><p>During the caching process, there&rsquo;s also a couple of things to consider:</p><ul><li>If some other job, with another cache configuration had saved its
cache in the same zip file, it is overwritten. If the S3 based shared cache is
used, the file is additionally uploaded to S3 to an object based on the cache
key. So, two jobs with different paths, but the same cache key, overwrites
their cache.</li><li>When extracting the cache from <code>cache.zip</code>, everything in the zip file is
extracted in the job&rsquo;s working directory (usually the repository which is
pulled down), and the runner doesn&rsquo;t mind if the archive of <code>job A</code> overwrites
things in the archive of <code>job B</code>.</li></ul><p>It works this way because the cache created for one runner
often isn&rsquo;t valid when used by a different one. A different runner may run on a
different architecture (for example, when the cache includes binary files). Also,
because the different steps might be executed by runners running on different
machines, it is a safe default.</p><h2 id=clearing-the-cache>Clearing the cache</h2><p>Runners use <a href=/ci/yaml/#cache>cache</a> to speed up the execution
of your jobs by reusing existing data. This can sometimes lead to
inconsistent behavior.</p><p>There are two ways to start with a fresh copy of the cache.</p><h3 id=clear-the-cache-by-changing-cachekey>Clear the cache by changing <code>cache:key</code></h3><p>Change the value for <code>cache: key</code> in your <code>.gitlab-ci.yml</code> file.
The next time the pipeline runs, the cache is stored in a different location.</p><h3 id=clear-the-cache-manually>Clear the cache manually</h3><p>You can clear the cache in the GitLab UI:</p><ol><li>On the left sidebar, select <strong>Search or go to</strong> and find your project. If you&rsquo;ve <a href=/user/interface_redesign/#turn-new-navigation-on-or-off>turned on the new navigation</a>, this field is on the top bar.</li><li>Select <strong>Build</strong> > <strong>Pipelines</strong>.</li><li>In the upper-right corner, select <strong>Clear runner caches</strong>.</li></ol><p>On the next commit, your CI/CD jobs use a new cache.</p><div class="alert alert-type-note gl-rounded-lg"><div class=alert-icon></div><div class=gl-min-w-0><p>Each time you clear the cache manually, the <a href=/ci/caching/#where-the-caches-are-stored>internal cache name</a> is updated. The name uses the format <code>cache-&lt;index></code>, and the index increments by one. The old cache is not deleted. You can manually delete these files from the runner storage.</p></div></div><h2 id=troubleshooting>Troubleshooting</h2><h3 id=cache-mismatch>Cache mismatch</h3><p>If you have a cache mismatch, follow these steps to troubleshoot.</p><table><thead><tr><th>Reason for a cache mismatch</th><th>How to fix it</th></tr></thead><tbody><tr><td>You use multiple standalone runners (not in autoscale mode) attached to one project without a shared cache.</td><td>Use only one runner for your project or use multiple runners with distributed cache enabled.</td></tr><tr><td>You use runners in autoscale mode without a distributed cache enabled.</td><td>Configure the autoscale runner to use a distributed cache.</td></tr><tr><td>The machine the runner is installed on is low on disk space or, if you&rsquo;ve set up distributed cache, the S3 bucket where the cache is stored doesn&rsquo;t have enough space.</td><td>Make sure you clear some space to allow new caches to be stored. There&rsquo;s no automatic way to do this.</td></tr><tr><td>You use the same <code>key</code> for jobs where they cache different paths.</td><td>Use different cache keys so that the cache archive is stored to a different location and doesn&rsquo;t overwrite wrong caches.</td></tr><tr><td>You have not enabled the <a href=https://docs.gitlab.com/runner/configuration/autoscale.html#distributed-runners-caching>distributed runner caching on your runners</a>.</td><td>Set <code>Shared = false</code> and re-provision your runners.</td></tr></tbody></table><h4 id=cache-mismatch-example-1>Cache mismatch example 1</h4><p>If you have only one runner assigned to your project, the cache
is stored on the runner&rsquo;s machine by default.</p><p>If two jobs have the same cache key but a different path, the caches can be overwritten.
For example:</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job A</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>make build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>same-key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>public/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job B</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>make test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>same-key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vendor/</span></span></span></code></pre></div></div><ol><li><code>job A</code> runs.</li><li><code>public/</code> is cached as <code>cache.zip</code>.</li><li><code>job B</code> runs.</li><li>The previous cache, if any, is unzipped.</li><li><code>vendor/</code> is cached as <code>cache.zip</code> and overwrites the previous one.</li><li>The next time <code>job A</code> runs it uses the cache of <code>job B</code> which is different
and thus isn&rsquo;t effective.</li></ol><p>To fix this issue, use different <code>keys</code> for each job.</p><h4 id=cache-mismatch-example-2>Cache mismatch example 2</h4><p>In this example, you have more than one runner assigned to your
project, and distributed cache is not enabled.</p><p>The second time the pipeline runs, you want <code>job A</code> and <code>job B</code> to re-use their cache (which in this case
is different):</p><div class=codeblock-wrapper><div data-vue-app=codeblock-toolbar data-code-language=yaml class=codeblock-toolbar></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>stages</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job A</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>keyA</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vendor/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>job B</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>stage</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>script</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>keyB</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>paths</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>vendor/</span></span></span></code></pre></div></div><p>Even if the <code>key</code> is different, the cached files might get &ldquo;cleaned&rdquo; before each
stage if the jobs run on different runners in subsequent pipelines.</p><h3 id=concurrent-runners-missing-local-cache>Concurrent runners missing local cache</h3><p>If you have configured multiple concurrent runners with the Docker executor, locally cached files might
not be present for concurrently-running jobs as you expect. The names of cache volumes are constructed
uniquely for each runner instance, so files cached by one runner instance are not found in the cache by another runner
instance.</p><p>To share the cache between concurrent runners, you can either:</p><ul><li>Use the <code>[runners.docker]</code> section of the runners&rsquo; <code>config.toml</code> to configure a single mount point on the host that
is mapped to <code>/cache</code> in each container, such as <code>volumes = ["/mnt/gitlab-runner/cache-for-all-concurrent-jobs:/cache"]</code>.
This approach prevents the runner from creating unique volume names for concurrent jobs.</li><li>Use a distributed cache.</li></ul></div><div data-vue-app=back-to-top-button></div></div><div class="feedback gl-min-h-8" data-ga-section=feedback data-elastic-exclude><div data-component=docs-feedback></div></div></div><aside class=sidebar-right><div data-ga-section=toc data-vue-app=toc></div></aside></div></main><footer data-ga-section=footer><section data-ga-section=footer><div id=footer class="footer-section container gl-grid gl-grid-cols-2 gl-grid-rows-3 gl-grid-rows-auto gl-gap-8 lg:gl-grid-cols-5 lg:gl-grid-rows-1 lg:gl-justify-items-center gl-px-8 gl-py-8 lg:gl-py-10"><div class="gl-col-span-2 lg:gl-col-span-1 gl-row-start-1"><div class="docs-title gl-flex gl-items-center"><a href=/><img src=/gitlab-logo-footer.svg alt="GitLab Docs logo" class=logo width=176 height=24></a></div><ul class="docs-social gl-list-none gl-flex"><li><a href=https://www.facebook.com/gitlab class=facebook><span class=gl-sr-only>Facebook</span></a></li><li><a href=https://www.linkedin.com/company/gitlab-com class=linkedin><span class=gl-sr-only>LinkedIn</span></a></li><li><a href=https://twitter.com/gitlab class=twitter><span class=gl-sr-only>Twitter</span></a></li><li><a href=https://www.youtube.com/channel/UCnMGQ8QHMAnVIsI3xJrihhg class=youtube><span class=gl-sr-only>YouTube</span></a></li></ul><a href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel="license noopener noreferrer" class=gl-mt-0><img src=/by-sa.svg alt="Creative Commons License" width=80 height=15></a></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Company</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/company/>About GitLab</a></li><li><a href=https://about.gitlab.com/pricing/>View pricing</a></li><li><a href=https://about.gitlab.com/free-trial/>Try GitLab for free</a></li></ul></div><div class="gl-col-span-1 gl-row-start-2 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Feedback</div><ul class="gl-list-none gl-p-0"><li><a href=https://gitlab.com/gitlab-org/gitlab/-/blob/master/doc/ci/caching/_index.md>View page source</a></li><li><a href=https://gitlab.com/-/ide/project/gitlab-org/gitlab/edit/master/-/doc/ci/caching/_index.md>Edit in web IDE</a></li><li><a href=https://about.gitlab.com/community/contribute/>Contribute to GitLab</a></li><li><a href="https://gitlab.com/gitlab-org/gitlab/-/issues/new?issuable_template=Documentation">Suggest updates</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Help & Community</div><ul class="gl-list-none gl-p-0"><li><a href=https://university.gitlab.com/pages/certifications>Get certified</a></li><li><a href=https://about.gitlab.com/support/>Get support</a></li><li><a href="https://forum.gitlab.com/new-topic?title=topic%20title&amp;body=topic%20body&amp;tags=docs-feedback">Post on the GitLab forum</a></li></ul></div><div class="gl-col-span-1 gl-row-start-3 lg:gl-row-start-1"><div class="footer-section-title gl-heading-3">Resources</div><ul class="gl-list-none gl-p-0"><li><a href=https://about.gitlab.com/terms/>Terms</a></li><li><a href=https://about.gitlab.com/privacy/>Privacy statement</a></li><li><a href=/legal/use_generative_ai/>Use of generative AI</a></li><li><a href=/legal/licensing_policy/>Acceptable use of user licenses</a></li><li><button id=ot-sdk-btn class=ot-sdk-show-settings></button></li></ul></div></div></section></footer><script type=module src=/vite/main.js></script><script async>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-NJXWQL")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJXWQL" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async>(function(){var e,t=!1;function n(){t===!1&&(t=!0,Munchkin.init("194-VVC-221",{useBeaconAPI:!0}))}e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src="https://munchkin.marketo.net/munchkin.js",e.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&n()},e.onload=n,document.getElementsByTagName("head")[0].appendChild(e)})()</script><script async src=https://cdn.bizible.com/scripts/bizible.js></script><script async>_linkedin_partner_id="30694",window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[],window._linkedin_data_partner_ids.push(_linkedin_partner_id),function(){var t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://snap.licdn.com/li.lms-analytics/insight.min.js",t.parentNode.insertBefore(e,t)}()</script><noscript><img height=1 width=1 style=display:none alt src="https://dc.ads.linkedin.com/collect/?pid=30694&fmt=gif"></noscript></body></html>